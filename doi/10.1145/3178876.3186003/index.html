<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> <head>  <title>Estimating the Cardinality of Conjunctive Queries over RDF Data Using Graph Summarisation</title>  <!-- Copyright (c) 2010-2015 The MathJax Consortium --><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>  <meta name="viewport" content="width=device-width; initial-scale=1.0;"></meta>  <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>  <link media="screen, print" rel="stylesheet"    href="../../../data/dl.acm.org/pubs/lib/css/bootstrap.min.css"/><link media="screen, print" rel="stylesheet"    href="../../../data/dl.acm.org/pubs/lib/css/bootstrap-theme.min.css"/><link media="screen, print" rel="stylesheet"    href="../../../data/dl.acm.org/pubs/lib/css/main.css"/><script src="../../../data/dl.acm.org/pubs/lib/js/jquery.min.js" type="text/javascript"></script>  <script src="../../../data/dl.acm.org/pubs/lib/js/bootstrap.min.js" type="text/javascript"></script>  <script src="../../../data/dl.acm.org/pubs/lib/js/bibCit.js" type="text/javascript"></script>  <script src="../../../data/dl.acm.org/pubs/lib/js/divTab.js" type="text/javascript"></script>  <script type="text/javascript"    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML"></script>  <script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script> </head> <body id="main">
<div>
<p style='font-size: 75%; color #444'>
This is a web copy of <a href='https://doi.org/10.1145/3178876.3186003'>https://doi.org/10.1145/3178876.3186003</a> 
 Published in WWW2018 Proceedings Â© 2018 International World Wide Web Conference Committee, published under 
 <a rel='license' property='license' href='https://creativecommons.org/licenses/by/4.0/'>
 Creative Commons CC By 4.0 License</a>.
The <a href='https://github.com/usable-oa/thewebconf2018/tree/master/scripts'>modifications</a> 
from the original are solely to improve HTML aiming to make it Findable, Accessible, Interoperable and Reusable. 
augmenting HTML metadata and avoiding ACM trademark.
To reference this HTML version, use:
</p><p>
<strong>Permalink:</strong>
<a href='https://w3id.org/oa/10.1145/3178876.3186003'>https://w3id.org/oa/10.1145/3178876.3186003</a>
</p></div>
<hr>

  <section class="front-matter">   <section>    <header class="title-info">    <div class="journal-title">     <h1>      <span class="title">Estimating the Cardinality of Conjunctive Queries over RDF Data Using Graph Summarisation</span>      <br/>      <span class="subTitle"/>     </h1>    </div>    </header>    <div class="authorGroup">    <div class="author">     <span class="givenName">Giorgio</span>     <span class="surName">Stefanoni</span>,     Bloomberg L.P., London, UK    </div>    <div class="author">     <span class="givenName">Boris</span>     <span class="surName">Motik</span>,     University of Oxford, UK    </div>    <div class="author">     <span class="givenName">Egor V.</span>     <span class="surName">Kostylev</span>,     University of Oxford, UK    </div>    </div>    <br/>    <div class="pubInfo">    <p>DOI: <a href="https://doi.org/10.1145/3178876.3186003" target="_blank">https://doi.org/10.1145/3178876.3186003</a>     <br/>WWW '18: <a href="https://doi.org/10.1145/3178876" target="_blank">Proceedings of The Web Conference 2018</a>, Lyon, France, April 2018</p>    </div>    <div class="abstract">    <p>     <small>Estimating the cardinality (i.e., the number of answers) of conjunctive queries is particularly difficult in RDF systems: queries over RDF data are navigational and thus tend to involve many joins. We present a new, principled cardinality estimation technique based on graph summarisation. We interpret a summary of an RDF graph using a possible world semantics and formalise the estimation problem as computing the expected cardinality over all RDF graphs represented by the summary, and we present a closed-form formula for computing the expectation of arbitrary queries. We also discuss approaches to RDF graph summarisation. Finally, we show empirically that our cardinality technique is more accurate and more consistent, often by orders of magnitude, than the state of the art.</small>    </p>    </div>    <div class="classifications">    <div class="AcmReferenceFormat">     <p>      <small>       <span style="font-weight:bold;">ACM Reference Format:</span>       <br/>       Giorgio Stefanoni, Boris Motik, and Egor V. Kostylev. 2018. Estimating the Cardinality of Conjunctive Queries over RDF Data Using Graph Summarisation. In <em>WWW '18: The 2018 Web Conference,</em>       <em>April 23&#x2013;27, 2018,</em>       <em> Lyon, France. ACM, New York, NY, USA</em> 17 Pages. <a href="https://doi.org/10.1145/3178876.3186003" class="link-inline force-break"       target="_blank">https://doi.org/10.1145/3178876.3186003</a></small>     </p>    </div>    </div>   </section>  </section>  <section class="body">   <section id="sec-4">    <header>    <div class="title-info">     <h2>      <span class="section-number">1</span> Introduction</h2>    </div>    </header>    <p>The Resource Description Framework (RDF) [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0023">23</a>] data model is often used in applications where developing a rigid schema is either infeasible or undesirable. An RDF graph is a set of triples of the form &#x27E8;<em>s</em>, <em>p</em>, <em>o</em>&#x27E9;, where <em>s</em>, <em>p</em>, and <em>o</em> are objects called <em>resources</em>; by viewing triples as directed labelled edges, an RDF graph corresponds to an ordinary directed labelled graph. SPARQL [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0018">18</a>] is the standard RDF query language. <em>Conjunctive queries</em> (also known as <em>basic graph patterns</em>) are the basic type of SPARQL queries, and estimating their cardinality (i.e., the number of answers) is an important problem. For example, estimates are used to determine the cost of query plans, so estimation accuracy directly influences plan quality [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0026">26</a>]. Thus, cardinality estimators are key components of most RDF systems.</p>    <p>Cardinality estimation has a long tradition in databases. It is usually solved by summarising a database to different kinds of <em>synopses</em> that can be used to accurately estimate the cardinality of certain queries. One-dimensional synopses, such as one-dimensional histograms [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0020">20</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0033">33</a>] and wavelets [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0028">28</a>], can summarise one attribute of one relation, so they can be used on queries involving one selection on a single relation. Multidimensional synopses, such as multidimensional histograms [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0001">1</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0006">6</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0016">16</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0034">34</a>], multidimensional wavelets [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0008">8</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0013">13</a>], discrete cosine transforms [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0024">24</a>], and kernel methods [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0015">15</a>], can summarise several attributes of one relation, so they can be used on queries involving several selections on a single relation. Schema-level synopses, such as graphical models [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0014">14</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0040">40</a>], sampling [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0002">2</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0041">41</a>], TuG synopses [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0036">36</a>], and statistical views [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0005">5</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0011">11</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0038">38</a>] can summarise several attributes over different relations, but they often require a <em>join schema</em> that identifies the supported joins.</p>    <p>Queries whose cardinality cannot be estimated using the available synopses are typically broken into subqueries that can be estimated, and partial estimates are combined using ad hoc assumptions [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0004">4</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0012">12</a>]: the <em>independence assumption</em> assumes that each selection or join affects the query answers independently, the <em>preservation assumption</em> assumes that each attribute value of a relation participating in a join is present in the join result, and the <em>containment assumption</em> assumes that, for each pair of joined attributes, all values of one attribute are contained in the other attribute. However, these assumptions usually do not hold in practice and thus introduce estimation errors that compound exponentially with the number of joins&#x00A0;[<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0021">21</a>]. Due to the graph-like nature of RDF, queries in RDF often navigate over paths and thus contain many (self-)joins (ten or more are not rare). Techniques that aim to address these specifics of RDF either just adapt relational approaches [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0019">19</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0031">31</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0037">37</a>] or focus on particular types of queries (e.g., star or chain queries) [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0030">30</a>] and fall back to the ad hoc assumptions for other types of queries. Hence, as we show in Section&#x00A0;<a class="sec" href="#sec-14">6</a>, accurately estimating the cardinality of complex RDF queries remains challenging.</p>    <p>To address these issues, in Section&#x00A0;<a class="sec" href="#sec-6">3</a> we propose a new, principled technique for estimating the cardinality of conjunctive queries over RDF data. Our technique is based on graph summarisation&#x2014;the process of compressing a graph by merging its vertices. Summaries have already been used for graph exploration&#x00A0;[<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0029">29</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0039">39</a>], fast approximate graph analytics&#x00A0;[<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0025">25</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0035">35</a>], and query processing&#x00A0;[<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0007">7</a>]. In Section&#x00A0;<a class="sec" href="#sec-6">3</a>, we introduce a specific kind of summary that we use as a schema-level synopsis for RDF data. Following LeFevre and Terzi [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0025">25</a>], we interpret a summary using a <em>possible world semantics</em> as a family of RDF graphs represented by the summary. We formalise the cardinality estimation problem as computing the expectation of the query cardinality across this family, and so our approach does not require any ad hoc assumptions. Finally, we show how to determine the probability that the estimation error exceeds a given bound. To the best of our knowledge, this is the first approach that can provide such guarantees for arbitrary queries.</p>    <p>In Section&#x00A0;<a class="sec" href="#sec-7">4</a> we present formulas for computing the expected cardinality and its variance. Our formulas can handle queries of the form <tt>SELECT * WHERE { BGP }</tt> for <tt>BGP</tt> a basic graph pattern, which form the core of SPARQL. Note that, without <tt>DISTINCT</tt>, projecting variables in the <tt>SELECT</tt> clause does not affect the query cardinality.</p>    <p>To apply our framework in practice, effective graph summarisation algorithms are needed. Any summarisation algorithm can be used with our technique in principle, but some will fit our framework better than others: we intuitively expect that a good summary should merge vertices participating in similar connections. Hence, algorithms for unlabelled graphs [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0025">25</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0029">29</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0035">35</a>] are unlikely to work well on RDF, where links are inherently labelled. We experimented with an adaptation of the SNAP [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0039">39</a>] technique to RDF, but it produced very large summaries. A recently proposed RDF-specific summarisation technique seems very promising, but its computational complexity seems very high [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0007">7</a>]. Thus, in Section&#x00A0;<a class="sec" href="#sec-10">5</a> we present a new graph summarisation approach. In the first step, we use a simple notion of similarity based on the labels on the edges that resources occur in. If the resulting summary is not sufficiently small, in the second step we further merge resources based on the similarity of the connections resources participate in.</p>    <p>In Section&#x00A0;<a class="sec" href="#sec-14">6</a> we present the results of an extensive evaluation on LUBM, WatDiv, and DBLP benchmarks with 55&#x00A0;M to 109&#x00A0;M triples, and 15 to 103 queries. We compared the accuracy of our technique against RDF-3X [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0031">31</a>] and the <em>characteristic sets technique</em> [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0030">30</a>] (both specifically targeting RDF data), PostgreSQL (which uses one-dimensional histograms), and SystemX (a prominent commercial RDBMS that combines histograms with dynamic sampling); we considered both triple table and vertical partitioning for storing RDF in RDBMSs. We show that our technique is generally more accurate than the related approaches, often by orders of magnitude.</p>    <p>The proofs of all of our technical results are given in full in the appendices.</p>   </section>   <section id="sec-5">    <header>    <div class="title-info">     <h2>      <span class="section-number">2</span> Definitions and Notation</h2>    </div>    </header>    <p>We now recall the relevant definitions and notation. RDF vocabulary consist of <em>resources</em>, which are URIs (i.e., abstract entities) or <em>literals</em> (i.e., concrete values described by datatypes such as <em>xsd</em>: <em>string</em> or <em>xsd</em>: <em>integer</em>). A <em>term</em> is a resource or a variable. An <em>(RDF) atom</em> is a triple of the form &#x27E8;<em>s</em>, <em>p</em>, <em>o</em>&#x27E9;, where <em>s</em>, <em>p</em>, and <em>o</em> are terms called the <em>subject</em>, <em>predicate</em>, and <em>object</em>, respectively. An <em>(RDF) triple</em> is a variable-free atom. An <em>(RDF) graph</em> is a finite set of triples.</p>    <p>A <em>substitution &#x03C0;</em> is a mapping of variables to terms; the domain and range of <em>&#x03C0;</em> are <span class="inline-equation"><span class="tex">$\mathsf {dom}(\pi)$</span>    </span> and <span class="inline-equation"><span class="tex">$\mathsf {rng}(\pi)$</span>    </span>, respectively; <span class="inline-equation"><span class="tex">$\mathsf {varrng}(\pi)$</span>    </span> is the set of all variables in <span class="inline-equation"><span class="tex">$\mathsf {rng}(\pi)$</span>    </span>; and <em>&#x03C0;</em> is <em>empty</em> if <span class="inline-equation"><span class="tex">${\mathsf {dom}(\pi) = \emptyset }$</span>    </span>. Let <em>Z</em> be a term, an atom, or a set of atoms. Then, <em>&#x03C0;</em>(<em>Z</em>) is obtained from <em>Z</em> by replacing each occurrence of <span class="inline-equation"><span class="tex">${x \in \mathsf {dom}(\pi)}$</span>    </span> in <em>Z</em> with <em>&#x03C0;</em>(<em>x</em>); if <em>Z</em> is a set of atoms, then <em>&#x03C0;</em>(<em>Z</em>) is also a set and does not contain duplicates. Moreover, <span class="inline-equation"><span class="tex">$\mathsf {res}(Z)$</span>    </span>, <span class="inline-equation"><span class="tex">$\mathsf {var}(Z)$</span>    </span>, and <span class="inline-equation"><span class="tex">$\mathsf {term}(Z)$</span>    </span> are the sets of resources, variables, and terms occurring in <em>Z</em>, respectively.</p>    <p>SPARQL [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0018">18</a>] is a standard query language for RDF. Its syntax is very verbose, so we use a more compact notation that captures basic SPARQL queries of the form <span class="inline-equation"><span class="tex">${\texttt {SELECT * WHERE { BGP } }}$</span>    </span>. SPARQL variables are written as ?<em>x</em>, but we drop the question mark and reserve (possibly indexed) letters <em>x</em>, <em>y</em>, and <em>z</em> for variables. A <em>conjunctive query</em> (<em>CQ</em>) <em>q</em> is a finite set of atoms. A substitution <em>&#x03C0;</em> is an <em>answer</em> to <em>q</em> on an RDF graph <em>G</em> if <span class="inline-equation"><span class="tex">${\mathsf {dom}(\pi) = \mathsf {var}(q)}$</span>    </span> and <em>&#x03C0;</em>(<em>q</em>)&#x2286;<em>G</em>; moreover, <span class="inline-equation"><span class="tex">$[[ q ]] _{G}$</span>    </span> is the set of all answers to <em>q</em> on <em>G</em>, and the <em>cardinality</em> of <em>q</em> on <em>G</em> is the size of <span class="inline-equation"><span class="tex">$[[ q ]] _{G}$</span>    </span>. For technical reasons, we allow <em>q</em> to be empty, in which case <span class="inline-equation"><span class="tex">$[[ q ]] _{G}$</span>    </span> contains just one empty answer. These definitions are compatible with the ones by P&#x00E9;rez et&#x00A0;al. [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0032">32</a>]; however, since we consider only CQs without variable projection, we simplify the notation and treat the query as a finite set of atoms.</p>    <p>The q-error is often used to measure precision of cardinality estimates [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0030">30</a>]: if a query returns <em>N</em> answers and its cardinality is estimated as <em>E</em>, the <em>q-error</em> of the estimate is <em>e</em> = max&#x2009;(<em>N</em>&#x2032;/<em>E</em>&#x2032;, <em>E</em>&#x2032;/<em>N</em>&#x2032;), where <em>N</em>&#x2032; = max&#x2009;(<em>N</em>, 1) and <em>E</em>&#x2032; = max&#x2009;(<em>E</em>, 1). Intuitively, the q-error shows the difference in the orders of magnitude between a real cardinality <em>N</em> and its estimation <em>E</em>, regardless of whether <em>E</em> over- or undershoots <em>N</em>. We use <em>N</em>&#x2032; and <em>E</em>&#x2032; instead of <em>N</em> and <em>E</em> in the definition of q-error in order to avoid division by zero, as well as to prevent artificially high q-error values when <em>E</em> < 1.</p>    <p>Let <em>n</em> &#x2265; <em>m</em> > 0 be integers. Then, <span class="inline-equation"><span class="tex">$\binom{n}{m} = \frac{n!}{m! (n-m)!}$</span>    </span> is the <em>binomial coefficient</em>, (<em>n</em>)<sub>     <em>m</em>    </sub> = <em>n</em>(<em>n</em> &#x2212; 1)&#x2026;(<em>n</em> &#x2212; <em>m</em> + 1) is the <em>falling factorial</em>, and [<em>m</em>, <em>n</em>] is the set of all integers between <em>m</em> and <em>n</em> (inclusive).</p>   </section>   <section id="sec-6">    <header>    <div class="title-info">     <h2>      <span class="section-number">3</span> Cardinality Estimation Framework</h2>    </div>    </header>    <figure id="fig1">    <img src="../../../data/deliveryimages.acm.org/10.1145/3190000/3186003/images/www2018-12-fig1.svg" class="img-responsive" alt="Figure 1"      longdesc=""/>    <div class="figure-caption">     <span class="figure-number">Figure 1:</span>     <span class="figure-title">An example RDF graph <em>G</em> (a), its summary <em>S</em> (b), and example graphs <em>G</em>      <sub>1</sub> and <em>G</em>      <sub>2</sub> that also summarise as <em>S</em> (c).</span>    </div>    </figure>    <p>To estimate the cardinality of a query without ad hoc assumptions, we must &#x2018;compress&#x2019; our input RDF graph while preserving as much of its structure as possible. Graph summarisation has already been used to this end in related settings&#x00A0;[<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0007">7</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0025">25</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0029">29</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0035">35</a>, <a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0039">39</a>], and in our work we use it to estimate CQ cardinality in a principled way.</p>    <p>Consider the input graph <em>G</em> in Figure&#x00A0;<a class="fig" href="#fig1">1</a> where employees are connected to their cars and managers, and resources are assigned to classes (using the <em>rdf:type</em> predicate) as shown in the legend. A summary <em>S</em> of <em>G</em> is obtained by merging the resources of <em>G</em> into <em>buckets</em> as shown using dotted boxes; for example, employees <em>e</em>    <sub>1</sub> and <em>e</em>    <sub>2</sub> are replaced by bucket <em>b</em>    <sub>1</sub>, and <em>e</em>    <sub>3</sub> and <em>e</em>    <sub>4</sub> by another bucket <em>b</em>    <sub>3</sub>. In contrast to the existing approaches, in our approach each edge in <em>S</em> is labelled with the number of edges of <em>G</em> that collapse due to merging. For example, the <em>manages</em> edge from <em>e</em>    <sub>1</sub> to <em>e</em>    <sub>2</sub> collapses into a self-loop on <em>b</em>    <sub>1</sub> of weight 1, and the edges from <em>e</em>    <sub>1</sub> to <em>e</em>    <sub>3</sub> and from <em>e</em>    <sub>2</sub> to <em>e</em>    <sub>4</sub> collapse into an edge from <em>b</em>    <sub>1</sub> to <em>b</em>    <sub>3</sub> of weight 2.</p>    <p>Our objective is to estimate the cardinality of a CQ <em>q</em> on <em>G</em> using <em>S</em>, rather than <em>G</em>. To this end, we interpret <em>S</em> using the &#x2018;possible worlds&#x2019; semantics&#x00A0;[<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"     href="#BibPLXBIB0025">25</a>]: we assume that <em>S</em> represents with equal probability each graph <em>G</em>&#x2032; that summarises as <em>S</em>&#x2014;that is, if we replace the resources of <em>G</em>&#x2032; with buckets in the same way as when we constructed <em>S</em> from <em>G</em>, we obtain <em>S</em>. Thus, <em>S</em> represents the input graph <em>G</em>, but, due to the loss of information in summarisation, it represents other graphs as well. In Figure&#x00A0;<a class="fig" href="#fig1">1</a>, in addition to <em>G</em>, summary <em>S</em> also represents graphs <em>G</em>    <sub>1</sub> and <em>G</em>    <sub>2</sub>. We then estimate the cardinality of <em>q</em> on <em>G</em> as the expected cardinality of <em>q</em> over all graphs represented by <em>S</em>. Instead of the assumptions mentioned in Section&#x00A0;<a class="sec" href="#sec-4">1</a>, we thus use a consistent semantic interpretation of <em>S</em>.</p>    <p>We next formalise our notion of a summary. We do not talk of a &#x2018;summary of an input graph <em>G</em>&#x2019;: a summary is a synopsis that represents a family of graphs.</p>    <p>    <div class="definition" id="enc1">     <Label>Definition 3.1.</Label>     <p>      <em>A</em> summary<em>       <em>S</em> = &#x27E8;<em>H</em>, <em>w</em>, <em>&#x03BC;</em>&#x27E9; is a triple where <em>H</em> is an RDF graph called the</em> summarisation graph<em>, </em>      <span class="inline-equation"><span class="tex">${w: H\rightarrow \mathbb {N}}$</span>      </span>      <em> is a</em> weight function<em>assigning a positive natural number to each triple in <em>H</em>, and <em>&#x03BC;</em> is a surjective</em> summarisation function<em>from a finite set of resources </em>      <span class="inline-equation"><span class="tex">$\mathsf {dom}(\mu)$</span>      </span>      <em> to </em>      <span class="inline-equation"><span class="tex">$\mathsf {res}(H)$</span>      </span>      <em>. The resources of </em>      <span class="inline-equation"><span class="tex">${\mathsf {res}(H)}$</span>      </span>      <em> are called</em> buckets<em>.</em>     </p>     <p>      <em>For <em>Z</em> a term, an atom, or a set of atoms, <em>&#x03BC;</em>(<em>Z</em>) is obtained from <em>Z</em> by replacing each resource </em>      <span class="inline-equation"><span class="tex">${d\in \mathsf {res}(Z) \cap \mathsf {dom}(\mu)}$</span>      </span>      <em> with <em>&#x03BC;</em>(<em>d</em>); if <em>Z</em> is a set, then <em>&#x03BC;</em>(<em>Z</em>) is a set as well (i.e., duplicates are removed). The <em>S</em>-</em>size<em>of a bucket </em>      <span class="inline-equation"><span class="tex">${b \in \mathsf {res}(H)}$</span>      </span>      <em> is defined as </em>      <span class="inline-equation"><span class="tex">${s[b] = |\lbrace d\in \mathsf {dom}(\mu) \mid \mu (d) = b \rbrace |}$</span>      </span>      <em>, and the <em>S</em>-</em>size<em>of a triple </em>      <span class="inline-equation"><span class="tex">${\langle b_1,b_2,b_3 \rangle \in \mathsf {res}(H) \times \mathsf {res}(H) \times \mathsf {res}(H)}$</span>      </span>      <em> is defined as <em>s</em>[&#x27E8;<em>b</em>       <sub>1</sub>, <em>b</em>       <sub>2</sub>, <em>b</em>       <sub>3</sub>&#x27E9;] = <em>s</em>[<em>b</em>       <sub>1</sub>] &#x00D7; <em>s</em>[<em>b</em>       <sub>2</sub>] &#x00D7; <em>s</em>[<em>b</em>       <sub>3</sub>].</em>     </p>    </div>    </p>    <p>While buckets in histograms record value ranges, in our approach <em>&#x03BC;</em> explicitly associates buckets with resources; this is needed as there is no natural notion of a range of RDF resources. In Figure&#x00A0;<a class="fig" href="#fig1">1</a>, we have <em>&#x03BC;</em>(<em>e</em>    <sub>1</sub>) = <em>&#x03BC;</em>(<em>e</em>    <sub>2</sub>) = <em>b</em>    <sub>1</sub>, <em>&#x03BC;</em>(<em>c</em>    <sub>1</sub>) = <em>&#x03BC;</em>(<em>c</em>    <sub>2</sub>) = <em>b</em>    <sub>2</sub>, <em>&#x03BC;</em>(<em>e</em>    <sub>3</sub>) = <em>&#x03BC;</em>(<em>e</em>    <sub>4</sub>) = <em>b</em>    <sub>3</sub>, <em>&#x03BC;</em>(<em>c</em>    <sub>3</sub>) = <em>&#x03BC;</em>(<em>c</em>    <sub>4</sub>) = <em>b</em>    <sub>4</sub>, and <em>&#x03BC;</em> is identity on all remaining resources, all of which occur in <em>G</em> as a predicate or the object of a triple whose predicate is <em>rdf:type</em> (such as <em>owns</em>, <em>rdf:type</em>, or <em>Van</em>).</p>    <p>The size of a bucket <em>b</em> is the number of resources mapped to <em>b</em>; in our example, <em>s</em>[<em>b<sub>i</sub>    </em>] = 2 for <em>i</em> &#x2208; [1, 4], but <em>s</em>[<em>rdf:type</em>] = <em>s</em>[<em>Van</em>] = 1. For <em>f</em> &#x2208; <em>G</em> and <em>h</em> &#x2208; <em>H</em> where <em>&#x03BC;</em>(<em>f</em>) = <em>h</em>, we say that <em>f</em> is <em>summarised</em> as <em>h</em>, and that <em>h</em> can be <em>expanded into f</em>. Clearly, <em>h</em> can be expanded into at most <em>s</em>[<em>h</em>] triples. In our example, we have <div class="table-responsive">     <div class="display-equation">      <span class="tex mytex">\begin{eqnarray*} \begin{array}{@{}r@{\;}l@{\;}r@{\;}l@{}}s[\langle b_1, \mathit {manages}, b_1 \rangle ] &#x0026; = s[b_1] \times s[\mathit {manages}] \times s[b_1] &#x0026; = 4, \\s[\langle b_4, \mathit {rdf}\mathit {:}\mathit {type}, \mathit {Van} \rangle ] &#x0026; = s[b_4] \times s[\mathit {rdf}\mathit {:}\mathit {type}] \times s[\mathit {Van}] &#x0026; = 2. \\\end{array}\end{eqnarray*} </span>      <br/>     </div>    </div>    </p>    <p>Definition&#x00A0;<a class="enc" href="#enc2">3.2</a> formalises the &#x2018;possible worlds&#x2019; semantics of <em>S</em>.</p>    <p>    <div class="definition" id="enc2">     <Label>Definition 3.2.</Label>     <p>      <em>A summary <em>S</em> = &#x27E8;<em>H</em>, <em>w</em>, <em>&#x03BC;</em>&#x27E9;</em> represents<em>a graph <em>G</em> if (i)&#x00A0;</em>      <span class="inline-equation"><span class="tex">${\mathsf {res}(G) \subseteq \mathsf {dom}(\mu)}$</span>      </span>      <em>, (ii)&#x00A0;<em>H</em> = <em>&#x03BC;</em>(<em>G</em>), and (iii)&#x00A0;for each <em>h</em> &#x2208; <em>H</em>, it is the case that <em>w</em>[<em>h</em>] = |{<em>f</em> &#x2208; <em>G</em>&#x2223;<em>&#x03BC;</em>(<em>f</em>) = <em>h</em>}|. Moreover, <em>R<sub>S</sub>       </em> is the set of all graphs that <em>S</em> represents. Finally, summary <em>S</em> is</em> consistent<em>if <em>R<sub>S</sub>       </em> &#x2260; &#x2205;.</em>     </p>    </div>    </p>    <p>At most <em>s</em>[<em>h</em>] triples can be summarised as <em>h</em> &#x2208; <em>H</em>, so <em>w</em>[<em>h</em>] &#x2264; <em>s</em>[<em>h</em>] must hold for <em>S</em> to be consistent. Also, a graph in <em>R<sub>S</sub>    </em> is obtained by expanding each <em>h</em> &#x2208; <em>H</em> arbitrarily into <em>w</em>[<em>h</em>] triples if <em>w</em>[<em>h</em>] &#x2264; <em>s</em>[<em>h</em>] holds. Thus, we can check the consistency of <em>S</em> as in Proposition&#x00A0;<a class="enc" href="#enc3">3.3</a>.</p>    <p>    <div class="proposition" id="enc3">     <Label>Proposition 3.3.</Label>     <p> A summary <em>S</em> = &#x27E8;<em>H</em>, <em>w</em>, <em>&#x03BC;</em>&#x27E9; is consistent if and only if <em>w</em>[<em>h</em>] &#x2264; <em>s</em>[<em>h</em>] holds for each <em>h</em> &#x2208; <em>H</em>.</p>    </div>    </p>    <p>We now estimate the cardinality of a CQ <em>q</em> as the expected cardinality of <em>q</em> over all graphs represented by <em>S</em>. We also introduce the related, natural notion of cardinality variance.</p>    <p>    <div class="definition" id="enc4">     <Label>Definition 3.4.</Label>     <p>      <em>The</em> expectation<em>       <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub> and the</em> variance <span class="inline-equation"><span class="tex">$\sigma _{q, S}^2$</span>      </span>      <em> of the cardinality of a CQ <em>q</em> on a summary <em>S</em> are defined as</em>      <div class="table-responsive">       <div class="display-equation">       <span class="tex mytex">\begin{eqnarray*} E_{q, S} = \sum _{G\in R_S}\frac{|[[ q ]] _{G}|}{|R_S|} \;\; \text{and} \;\; \sigma _{q, S}^2 = \sum _{G\in R_S}\frac{(|[[ q ]] _{G}| - E_{q, S})^2}{|R_S|}.\end{eqnarray*} </span>       <br/>       </div>      </div>     </p>    </div>    </p>    <p>Please note that <em>E</em>    <sub>     <em>q</em>, <em>S</em>    </sub> is not necessarily a natural number. For example, if <em>q</em> is a variable-free query, then <span class="inline-equation"><span class="tex">$|[[ q ]] _{G}|$</span>    </span> is equal to the number of graphs in <em>R<sub>S</sub>    </em> that contain <em>q</em>; since <span class="inline-equation"><span class="tex">${|[[ q ]] _{G}| \le |R_S|}$</span>    </span> is always satisfied, <em>E</em>    <sub>     <em>q</em>, <em>S</em>    </sub> is a rational number satisfying 0 &#x2264; <em>E</em>    <sub>     <em>q</em>, <em>S</em>    </sub> &#x2264; 1.</p>    <p>Using <em>E</em>    <sub>     <em>q</em>, <em>S</em>    </sub> and <span class="inline-equation"><span class="tex">$\sigma _{q, S}^2$</span>    </span>, we can bound from above the probability <span class="inline-equation"><span class="tex">$\mathsf {P}\left(e\ge \varepsilon \right)$</span>    </span> that the q-error of the estimate exceeds a given amount &#x025B; as shown in Theorem&#x00A0;<a class="enc" href="#enc5">3.5</a>. Intuitively, for a graph <em>G</em>&#x2032; chosen from <em>R<sub>S</sub>    </em> uniformly at random, <span class="inline-equation"><span class="tex">$\mathsf {P}\left(e\ge \varepsilon \right)$</span>    </span> is the probability that <em>E</em>    <sub>     <em>q</em>, <em>S</em>    </sub> over- or underestimates <span class="inline-equation"><span class="tex">$|[[ q ]] _{G^{\prime }}|$</span>    </span> by a factor larger than &#x025B;; we can equivalently express this by saying that <span class="inline-equation"><span class="tex">${\mathsf {P}\left(e\ge \varepsilon \right) \cdot |R_S|}$</span>    </span> is the number of such graphs <em>G</em>&#x2032;. We show in Section&#x00A0;<a class="sec" href="#sec-20">6.6</a> that <span class="inline-equation"><span class="tex">$\mathsf {P}\left(e\ge \varepsilon \right)$</span>    </span> is often small even for &#x025B; as low as 10, so in such cases there is good chance that the cardinality of <em>q</em> on our input graph is close to <em>E</em>    <sub>     <em>q</em>, <em>S</em>    </sub>.</p>    <p>    <div class="theorem" id="enc5">     <Label>Theorem 3.5.</Label>     <p> Let <em>q</em> be a CQ and let <em>S</em> be a summary such that <em>E</em>      <sub>       <em>q</em>, <em>S</em>      </sub> &#x2265; 1. Then, for each &#x025B; > 1 and for <em>e</em> the q-error of estimating the cardinality of <em>q</em> as <em>E</em>      <sub>       <em>q</em>, <em>S</em>      </sub>, we have <div class="table-responsive">       <div class="display-equation">       <span class="tex mytex">\begin{eqnarray*} \mathsf {P}\left(e\ge \varepsilon \right) \le \left(\frac{\varepsilon \cdot \sigma _{q, S}}{(\varepsilon - 1) \cdot E_{q, S}}\right)^2.\end{eqnarray*} </span>       <br/>       </div>      </div> If &#x025B; &#x2265; <em>E</em>      <sub>       <em>q</em>, <em>S</em>      </sub> holds additionally, then the numerator &#x025B; &#x00B7; <em>&#x03C3;</em>      <sub>       <em>q</em>, <em>S</em>      </sub> on the right-hand side of the inequality can be replaced with <em>&#x03C3;</em>      <sub>       <em>q</em>, <em>S</em>      </sub>.</p>    </div>    </p>   </section>   <section id="sec-7">    <header>    <div class="title-info">     <h2>      <span class="section-number">4</span> Computing the Expectation</h2>    </div>    </header>    <p>Given a CQ <em>q</em> and a summary <em>S</em> = &#x27E8;<em>H</em>, <em>w</em>, <em>&#x03BC;</em>&#x27E9;, we can compute <em>E</em>    <sub>     <em>q</em>, <em>S</em>    </sub> by iterating over all graphs in <em>R<sub>S</sub>    </em>, but this is impractical since the number of such graphs is exponential in |<em>H</em>|. In this section, we present formulas that compute <em>E</em>    <sub>     <em>q</em>, <em>S</em>    </sub> in time polynomial in |<em>H</em>|.</p>    <section id="sec-8">    <header>     <div class="title-info">      <h3>       <span class="section-number">4.1</span> Intuition</h3>     </div>    </header>    <p>Our formulas are quite complex, so we first discuss the intuitions using the summary <em>S</em> for Figure&#x00A0;<a class="fig" href="#fig1">1</a> and several example queries.</p>    <p>We first explain how to compute <em>E</em>     <sub>      <em>q</em>, <em>S</em>     </sub> for variable-free queries, which is the basic element of our approach. Let <em>q</em>     <sub>1</sub> = {<em>f</em>     <sub>1</sub>, <em>f</em>     <sub>2</sub>} where <em>f</em>     <sub>1</sub> = &#x27E8;<em>e</em>     <sub>1</sub>, <em>manages</em>, <em>e</em>     <sub>3</sub>&#x27E9; and <em>f</em>     <sub>2</sub> = &#x27E8;<em>e</em>     <sub>3</sub>, <em>owns</em>, <em>c</em>     <sub>3</sub>&#x27E9;. Since <em>q</em>     <sub>1</sub> is variable-free, for each <em>G</em>&#x2032; &#x2208; <em>R<sub>S</sub>     </em>, the cardinality <span class="inline-equation"><span class="tex">${[[ q_1 ]] _{G^{\prime }}}$</span>     </span> of <em>q</em>     <sub>1</sub> on <em>G</em>&#x2032; is one if <em>q</em>     <sub>1</sub>&#x2286;<em>G</em>&#x2032;, and it is zero otherwise; thus, the numerator of <span class="inline-equation"><span class="tex">$E_{q_1, S}$</span>     </span> is equal to the number of graphs in <em>R<sub>S</sub>     </em> that contain all atoms of <em>q</em>     <sub>1</sub> (i.e., that contain <em>q</em>     <sub>1</sub> as a subset). Triples <em>f</em>     <sub>1</sub> and <em>f</em>     <sub>2</sub> of the query are summarised as <em>h</em>     <sub>1</sub> = &#x27E8;<em>b</em>     <sub>1</sub>, <em>manages</em>, <em>b</em>     <sub>3</sub>&#x27E9; and <em>h</em>     <sub>2</sub> = &#x27E8;<em>b</em>     <sub>3</sub>, <em>owns</em>, <em>b</em>     <sub>4</sub>&#x27E9;; for readability, let <em>w<sub>i</sub>     </em> = <em>w</em>[<em>h<sub>i</sub>     </em>] and <em>s<sub>i</sub>     </em> = <em>s</em>[<em>h<sub>i</sub>     </em>] for <em>i</em> &#x2208; {1, 2}. Now every expansion of <em>h</em>     <sub>1</sub> is determined by a choice of <em>w</em>     <sub>1</sub> triples from <em>s</em>     <sub>1</sub> possibilities, so there are a total of <span class="inline-equation"><span class="tex">${\binom{s_1}{w_1}}$</span>     </span> expansions of <em>h</em>     <sub>1</sub>. Moreover, each expansion of <em>h</em>     <sub>1</sub> that contains <em>f</em>     <sub>1</sub> is obtained by choosing <em>f</em>     <sub>1</sub> and the remaining <em>w</em>     <sub>1</sub> &#x2212; 1 triples from <em>s</em>     <sub>1</sub> &#x2212; 1 possibilities; thus, a total of <span class="inline-equation"><span class="tex">${\binom{s_1-1}{w_1-1}}$</span>     </span> expansions of <em>h</em>     <sub>1</sub> contain <em>f</em>     <sub>1</sub>. Analogously, <em>h</em>     <sub>2</sub> has <span class="inline-equation"><span class="tex">${\binom{s_2}{w_2}}$</span>     </span> expansions, of which <span class="inline-equation"><span class="tex">${\binom{s_2-1}{w_2-1}}$</span>     </span> contain <em>f</em>     <sub>2</sub>. Now a key observation is that <em>f</em>     <sub>1</sub> and <em>f</em>     <sub>2</sub> are summarised as distinct triples; consequently, the expansions of <em>h</em>     <sub>1</sub> and <em>h</em>     <sub>2</sub> are independent, and so the total number of expansions of <em>h</em>     <sub>1</sub> and <em>h</em>     <sub>2</sub>, and the number of expansions containing both <em>f</em>     <sub>1</sub> and <em>f</em>     <sub>2</sub>, are given by the product of the above factors. Finally, the expansions of each triple <em>h</em> &#x2208; <em>H</em>&#x2216;{<em>h</em>     <sub>1</sub>, <em>h</em>     <sub>2</sub>} are independent from and thus irrelevant to <em>q</em>     <sub>1</sub>, so they do not affect <span class="inline-equation"><span class="tex">$E_{q_1, S}$</span>     </span>. Hence, we get <div class="table-responsive">      <div class="display-equation">       <span class="tex mytex">\begin{eqnarray*} E_{q_1, S} = \frac{\binom{s_1-1}{w_1-1}}{\binom{s_1}{w_1}} \cdot \frac{\binom{s_2-1}{w_2-1}}{\binom{s_2}{w_2}} = \frac{w_1}{s_1} \cdot \frac{w_2}{s_2} = \frac{2}{2 \cdot 2} \cdot \frac{2}{2 \cdot 2} = 0.25.\end{eqnarray*} </span>       <br/>      </div>     </div>    </p>    <p>Next, we demonstrate how to handle queries with variables. Let <em>q</em>     <sub>2</sub> = {&#x27E8;<em>x</em>, <em>manages</em>, <em>y</em>&#x27E9;, &#x27E8;<em>y</em>, <em>owns</em>, <em>z</em>&#x27E9;}. For each <em>G</em>&#x2032; &#x2208; <em>R<sub>S</sub>     </em> and each <span class="inline-equation"><span class="tex">${\pi \in [[ q_2 ]] _{G^{\prime }}}$</span>     </span>, query <em>&#x03C0;</em>(<em>q</em>     <sub>2</sub>) does not contain variables, so we can compute <span class="inline-equation"><span class="tex">$E_{\pi (q_2), S}$</span>     </span> just as for <em>q</em>     <sub>1</sub>. We can thus compute <span class="inline-equation"><span class="tex">$E_{q_2, S}$</span>     </span> by summing the contribution of each such <em>&#x03C0;</em>, but enumerating all <em>&#x03C0;</em> would be inefficient. However, for each <span class="inline-equation"><span class="tex">${\pi \in [[ q_2 ]] _{G^{\prime }}}$</span>     </span>, there exists <span class="inline-equation"><span class="tex">${\tau \in [[ \mu (q_2) ]] _{H}}$</span>     </span> such that <em>&#x03BC;</em>(<em>&#x03C0;</em>(<em>x</em>)) = <em>&#x03C4;</em>(<em>x</em>) for all <span class="inline-equation"><span class="tex">${x \in \mathsf {dom}(\pi)}$</span>     </span>; we say that <em>&#x03C4; expands into &#x03C0;</em>. Thus, for each <em>&#x03C4;</em>, we can compute <span class="inline-equation"><span class="tex">$E_{\pi (q_2), S}$</span>     </span> for just one prototypical substitution <em>&#x03C0;</em> that <em>&#x03C4;</em> expands into, and multiply <span class="inline-equation"><span class="tex">$E_{\pi (q_2), S}$</span>     </span> by the number of the expansions of <em>&#x03C4;</em>. On our example, evaluating <em>&#x03BC;</em>(<em>q</em>     <sub>2</sub>) on <em>H</em> produces substitutions <em>&#x03C4;</em>     <sub>1</sub> = {<em>x</em>&#x21A6;<em>b</em>     <sub>1</sub>, <em>y</em>&#x21A6;<em>b</em>     <sub>3</sub>, <em>z</em>&#x21A6;<em>b</em>     <sub>4</sub>}, <em>&#x03C4;</em>     <sub>2</sub> = {<em>x</em>&#x21A6;<em>b</em>     <sub>1</sub>, <em>y</em>&#x21A6;<em>b</em>     <sub>1</sub>, <em>z</em>&#x21A6;<em>b</em>     <sub>2</sub>}, &#x00A0;&#x00A0;&#x00A0; <em>&#x03C4;</em>     <sub>3</sub> = {<em>x</em>&#x21A6;<em>b</em>     <sub>1</sub>, <em>y</em>&#x21A6;<em>b</em>     <sub>3</sub>, <em>z</em>&#x21A6;<em>b</em>     <sub>2</sub>}. For <em>&#x03C4;</em>     <sub>1</sub>, we can select, say, <em>&#x03C0;</em> = {<em>x</em>&#x21A6;<em>e</em>     <sub>1</sub>, <em>y</em>&#x21A6;<em>e</em>     <sub>3</sub>, <em>z</em>&#x21A6;<em>c</em>     <sub>3</sub>} as a prototypical expansion of <em>&#x03C4;</em>     <sub>1</sub>; then <em>&#x03C0;</em>(<em>q</em>     <sub>2</sub>) = <em>q</em>     <sub>1</sub>, and so <span class="inline-equation"><span class="tex">${E_{\pi (q_2), S} = 0.25}$</span>     </span>. Moreover, since <em>&#x03C4;</em>     <sub>1</sub> maps both atoms of <em>q</em>     <sub>2</sub> to distinct triples in <em>H</em>, each expansion <em>&#x03C0;</em> of <em>&#x03C4;</em>     <sub>1</sub> does the same; thus, we can obtain all such <em>&#x03C0;</em> by expanding each variable in <span class="inline-equation"><span class="tex">$\mathsf {dom}(\tau _1)$</span>     </span> independently, and so there are <em>s</em>[<em>&#x03C4;</em>     <sub>1</sub>(<em>x</em>)] &#x00B7; <em>s</em>[<em>&#x03C4;</em>     <sub>1</sub>(<em>y</em>)] &#x00B7; <em>s</em>[<em>&#x03C4;</em>     <sub>1</sub>(<em>z</em>)] = 2 &#x00B7; 2 &#x00B7; 2 = 8 expansions of <em>&#x03C4;</em>     <sub>1</sub>. Thus, <em>&#x03C4;</em>     <sub>1</sub> contributes to <span class="inline-equation"><span class="tex">$E_{q_2, S}$</span>     </span> by 8 &#x00B7; 0.25 = 2. We compute the contributions of <em>&#x03C4;</em>     <sub>2</sub> and <em>&#x03C4;</em>     <sub>3</sub> analogously as <span class="inline-equation"><span class="tex">${2^3 \cdot \frac{1 \cdot 1}{4 \cdot 4} = 0.5}$</span>     </span> and <span class="inline-equation"><span class="tex">${2^3 \cdot \frac{2 \cdot 1}{4 \cdot 4} = 1}$</span>     </span>. By summing all contributions, we get <span class="inline-equation"><span class="tex">${E_{q_2, S} = 2 + 0.5 + 1 = 3.5}$</span>     </span>.</p>    <p>Generalising to any CQ <em>q</em>, formula (<a class="eqn" href="#eq1">1</a>) sums the contribution of each <span class="inline-equation"><span class="tex">${\tau \in [[ \mu (q) ]] _{H}}$</span>     </span>: the first factor counts the expansions of <em>&#x03C4;</em> to a prototypical <em>&#x03C0;</em>, and the second one counts the contribution of <em>&#x03C0;</em>. <div class="table-responsive" id="eq1">      <div class="display-equation">       <span class="tex mytex">\begin{equation} E_{q, S} = \sum _{\tau \in [[ \mu (q) ]] _{H}} \ \prod _{x \in \mathsf {var}(q)} s[\tau (x)] \cdot \prod _{a\in q} \frac{w[\tau (\mu (a))]}{s[\tau (\mu (a))]} \end{equation} </span>       <br/>       <span class="equation-number">(1)</span>      </div>     </div> However, formula (<a class="eqn" href="#eq1">1</a>) is correct only if each answer to <em>&#x03BC;</em>(<em>q</em>) in <em>H</em> maps all atoms of <em>&#x03BC;</em>(<em>q</em>) to distinct triples in <em>H</em>. Consider a query <em>q</em>     <sub>3</sub> = {&#x27E8;<em>e</em>     <sub>3</sub>, <em>owns</em>, <em>x</em>&#x27E9;, &#x27E8;<em>e</em>     <sub>3</sub>, <em>owns</em>, <em>y</em>&#x27E9;}, so <span class="inline-equation"><span class="tex">$[[ \mu (q_3) ]] _{H}$</span>     </span> contains answers <div class="table-responsive">      <div class="display-equation">       <span class="tex mytex">\begin{eqnarray*} \begin{array}{@{}r@{\;}lr@{\;}l@{}}\tau _1 &#x0026; = \lbrace x \mapsto b_2, y \mapsto b_4 \rbrace , &#x0026; \tau _2 &#x0026; = \lbrace x \mapsto b_4, y \mapsto b_2 \rbrace , \\\tau _3 &#x0026; = \lbrace x \mapsto b_4, y \mapsto b_4 \rbrace , &#x0026; \tau _4 &#x0026; = \lbrace x \mapsto b_2, y \mapsto b_2 \rbrace . \end{array}\end{eqnarray*} </span>       <br/>      </div>     </div> Answers <em>&#x03C4;</em>     <sub>1</sub> and <em>&#x03C4;</em>     <sub>2</sub> map the atoms of <em>&#x03BC;</em>(<em>q</em>     <sub>3</sub>) to distinct triples in <em>H</em>, so their contributions are given by (<a class="eqn" href="#eq1">1</a>) as <span class="inline-equation"><span class="tex">${2 \cdot 2 \cdot \frac{2}{2 \cdot 2} \cdot \frac{1}{2 \cdot 2} = 0.5}$</span>     </span>. In contrast, <em>&#x03C4;</em>     <sub>3</sub> maps both atoms of <em>&#x03BC;</em>(<em>q</em>     <sub>3</sub>) to <em>h</em>     <sub>3</sub> = &#x27E8;<em>b</em>     <sub>3</sub>, <em>owns</em>, <em>b</em>     <sub>4</sub>&#x27E9;, so <em>&#x03C4;</em>     <sub>3</sub> expands into two kinds of <em>&#x03C0;</em>. First, <em>&#x03C0;</em> can map both atoms of <em>q</em>     <sub>3</sub> to the same triple (e.g., &#x27E8;<em>e</em>     <sub>3</sub>, <em>owns</em>, <em>c</em>     <sub>4</sub>&#x27E9; &#x2208; <em>G</em>     <sub>2</sub>). Then <em>&#x03C0;</em>(<em>q</em>     <sub>3</sub>) contains just one atom, so <span class="inline-equation"><span class="tex">$E_{\pi (q_3), S} = \text{$w[h_3]$} / \text{$s[h_3]$} = \text{$2$} / \text{$4$} = 0.5$</span>     </span>; also, <em>x</em> and <em>y</em> are mapped to the same value in each such <em>&#x03C0;</em>, so the number of such <em>&#x03C0;</em> is <em>N</em>     <sub>1</sub> = <em>s</em>[<em>&#x03C4;</em>     <sub>3</sub>(<em>x</em>)] = 2. Second, <em>&#x03C0;</em> can map the atoms of <em>q</em>     <sub>3</sub> to distinct triples. Then, each expansion of <em>h</em>     <sub>3</sub> containing <em>&#x03C0;</em>(<em>q</em>     <sub>3</sub>) corresponds to a choice of <em>w</em>[<em>h</em>     <sub>3</sub>] &#x2212; 2 triples out of <em>s</em>[<em>h</em>     <sub>3</sub>] &#x2212; 2 possibilities, so <div class="table-responsive">      <div class="display-equation">       <span class="tex mytex">\begin{eqnarray*} E_{\pi (q_3), S} = \frac{\binom{s[h_3]-2}{w[h_3]-2}}{\binom{s[h_3]}{w[h_3]}} = \frac{(w[h_3])_2}{(s[h_3])_2} = \frac{(2)_2}{(4)_2} = \frac{2 \cdot 1}{4 \cdot 3} \approx 0.167.\end{eqnarray*} </span>       <br/>      </div>     </div> Moreover, there are <em>N</em>     <sub>2</sub> = <em>s</em>[<em>&#x03C4;</em>     <sub>3</sub>(<em>x</em>)] &#x00B7; <em>s</em>[<em>&#x03C4;</em>     <sub>3</sub>(<em>y</em>)] = 2 &#x00B7; 2 = 4 expansions of <em>&#x03C4;</em>     <sub>3</sub>, and <em>N</em>     <sub>1</sub> = 2 of these map <em>x</em> and <em>y</em> to the same resource; thus, <em>N</em>     <sub>2</sub> &#x2212; <em>N</em>     <sub>1</sub> = 2 expansions of <em>&#x03C4;</em>     <sub>3</sub> map <em>x</em> and <em>y</em> to distinct resources; and so <em>&#x03C4;</em>     <sub>3</sub> contributes to <span class="inline-equation"><span class="tex">$E_{q_3, S}$</span>     </span> by <em>N</em>     <sub>1</sub> &#x00B7; 0.5 + (<em>N</em>     <sub>2</sub> &#x2212; <em>N</em>     <sub>1</sub>) &#x00B7; 0.167 = 1.33. Finally, answer <em>&#x03C4;</em>     <sub>4</sub> maps both atoms of <em>&#x03BC;</em>(<em>q</em>     <sub>3</sub>) to the same triple <em>h</em>     <sub>4</sub> = &#x27E8;<em>b</em>     <sub>3</sub>, <em>owns</em>, <em>b</em>     <sub>2</sub>&#x27E9;, but no expansion of <em>&#x03C4;</em>     <sub>4</sub> contains two triples since <em>w</em>[<em>h</em>     <sub>4</sub>] = 1; thus, we consider only <em>s</em>[<em>&#x03C4;</em>     <sub>4</sub>(<em>x</em>)] = 2 expansions <em>&#x03C0;</em> of <em>&#x03C4;</em>     <sub>4</sub>, each mapping both atoms of <em>q</em>     <sub>3</sub> to the same triple and thus contributing by <span class="inline-equation"><span class="tex">${E_{\pi (q_3), S} = \text{$1$} / \text{$2$} = 0.5}$</span>     </span>; hence, <em>&#x03C4;</em>     <sub>4</sub> contributes to <span class="inline-equation"><span class="tex">$E_{q_3, S}$</span>     </span> by 2 &#x00B7; 0.5 = 1. Finally, we get <span class="inline-equation"><span class="tex">${E_{q_3, S} \approx 0.5 + 0.5 + 1.33 + 1 = 3.33}$</span>     </span>.</p>    </section>    <section id="sec-9">    <header>     <div class="title-info">      <h3>       <span class="section-number">4.2</span> Formalisation</h3>     </div>    </header>    <p>For this section, we fix a consistent summary <em>S</em> = &#x27E8;<em>H</em>, <em>w</em>, <em>&#x03BC;</em>&#x27E9;, a CQ <em>q</em> with <span class="inline-equation"><span class="tex">${\mathsf {res}(q) \subseteq \mathsf {dom}(\mu)}$</span>     </span>, and an arbitrary total order &#x2264; on terms where <em>d</em> &#x2264; <em>x</em> holds for each resource <em>d</em> and each variable <em>x</em>.</p>    <p>We first introduce a notion of a partition of <em>q</em>. Intuitively, a partition groups the atoms of <em>q</em> into disjoint sets, and it describes the &#x2018;type&#x2019; of answer to <em>q</em> on graphs in <em>R<sub>S</sub>     </em> where all atoms from each such group are mapped to the same triple.</p>    <div class="definition" id="enc6">     <Label>Definition 4.1.</Label>     <p>      <em>A</em> partition<em>of <em>q</em> is a set <em>P</em> of mutually disjoint nonempty subsets <em>u<sub>i</sub>       </em> of <em>q</em> such that </em>      <span class="inline-equation"><span class="tex">${q = \bigcup _{u_i \in P} u_i}$</span>      </span>      <em>.</em>     </p>     <p>      <em>The</em> term graph <span class="inline-equation"><span class="tex">$\mathcal {G}_P$</span>      </span>      <em> for <em>P</em> contains all terms from </em>      <span class="inline-equation"><span class="tex">$\mathsf {term}(q)$</span>      </span>      <em> as vertices, and undirected edges between terms <em>s</em>       <sub>1</sub> and <em>s</em>       <sub>2</sub>, <em>p</em>       <sub>1</sub> and <em>p</em>       <sub>2</sub>, and <em>o</em>       <sub>1</sub> and <em>o</em>       <sub>2</sub> for each <em>u</em> &#x2208; <em>P</em> and all atoms &#x27E8;<em>s</em>       <sub>1</sub>, <em>p</em>       <sub>1</sub>, <em>o</em>       <sub>1</sub>&#x27E9; and &#x27E8;<em>s</em>       <sub>2</sub>, <em>p</em>       <sub>2</sub>, <em>o</em>       <sub>2</sub>&#x27E9; in <em>u</em>. Partition <em>P</em> is</em> unifiable<em>if no two distinct resources from </em>      <span class="inline-equation"><span class="tex">$\mathsf {res}(q)$</span>      </span>      <em> are reachable in </em>      <span class="inline-equation"><span class="tex">$\mathcal {G}_P$</span>      </span>      <em>, in which case substitution <em>&#x03B3;<sub>P</sub>       </em> maps each variable </em>      <span class="inline-equation"><span class="tex">${x \in \mathsf {var}(q)}$</span>      </span>      <em> to the &#x2264; -least term reachable from <em>x</em> in </em>      <span class="inline-equation"><span class="tex">$\mathcal {G}_P$</span>      </span>      <em>.</em>     </p>     <p>      <em>The</em> partition base<em>       <em>B</em>      </em> for<em>       <em>q</em> is the set of all unifiable partitions of <em>q</em>. The partial order &#x2AAF; on <em>B</em> is defined so that, for <em>P</em>, <em>P</em>&#x2032; &#x2208; <em>B</em>, relationship <em>P</em>&#x2AAF;<em>P</em>&#x2032; holds iff, for each <em>u</em> &#x2208; <em>P</em>, there exists <em>u</em>&#x2032; &#x2208; <em>P</em>&#x2032; with <em>u</em>&#x2286;<em>u</em>&#x2032;.</em>     </p>     <p>      <em>For <em>P</em>, <em>P</em>&#x2032; &#x2208; <em>B</em> with <em>P</em>&#x2AAF;<em>P</em>&#x2032;, a</em> chain from<em>       <em>P</em>      </em>to<em>       <em>P</em>&#x2032;</em> of length<em>&#x2113; &#x2265; 0 is a sequence <em>P</em> = <em>P</em>       <sub>0</sub>, &#x2026;, <em>P</em>       <sub>&#x2113;</sub> = <em>P</em>&#x2032; of partitions from <em>B</em> where <em>P</em>       <sub>       <em>i</em> &#x2212; 1</sub>&#x227A;<em>P<sub>i</sub>       </em> holds for <em>i</em> &#x2208; [1, &#x2113;]; moreover, </em>      <span class="inline-equation"><span class="tex">$C^{ {e}}(P,P^{\prime })$</span>      </span>      <em> and </em>      <span class="inline-equation"><span class="tex">$C^{ {o}}(P,P^{\prime })$</span>      </span>      <em> are the numbers of chains from <em>P</em> to <em>P</em>&#x2032; of even and odd length, respectively; finally, </em>      <span class="inline-equation"><span class="tex">${K(P,P^{\prime }) = C^{ {e}}(P,P^{\prime }) - C^{ {o}}(P,P^{\prime })}$</span>      </span>      <em>.</em>     </p>    </div>    <p>Note that &#x2205; is the only unifying partition of <em>q</em> = &#x2205;. Moreover, <span class="inline-equation"><span class="tex">${C^{ {e}}(P,P) = 1}$</span>     </span> and <span class="inline-equation"><span class="tex">${C^{ {o}}(P,P) = 0}$</span>     </span> for each <em>P</em> &#x2208; <em>B</em>, so <em>K</em>(<em>P</em>, <em>P</em>) = 1.</p>    <p>Let <em>q</em>     <sub>3</sub> = {<em>a</em>     <sub>1</sub>, <em>a</em>     <sub>2</sub>} for <em>a</em>     <sub>1</sub> = &#x27E8;<em>e</em>     <sub>3</sub>, <em>owns</em>, <em>x</em>&#x27E9; and <em>a</em>     <sub>2</sub> = &#x27E8;<em>e</em>     <sub>3</sub>, <em>owns</em>, <em>y</em>&#x27E9; be as in Section&#x00A0;<a class="sec" href="#sec-8">4.1</a>. Then, <em>P</em>     <sub>1</sub> = {{<em>a</em>     <sub>1</sub>}, {<em>a</em>     <sub>2</sub>}} and <em>P</em>     <sub>2</sub> = {{<em>a</em>     <sub>1</sub>, <em>a</em>     <sub>2</sub>}} are the unifiable partitions of <em>q</em>     <sub>3</sub>: partition <em>P</em>     <sub>1</sub> represents the answers to <em>q</em>     <sub>3</sub> on graphs in <em>R<sub>S</sub>     </em> that map <em>a</em>     <sub>1</sub> and <em>a</em>     <sub>2</sub> to distinct triples, and <em>P</em>     <sub>2</sub> represents the answers that map <em>a</em>     <sub>1</sub> and <em>a</em>     <sub>2</sub> to the same triple; the latter is captured by <span class="inline-equation"><span class="tex">${\gamma _{P_2} = \lbrace y \mapsto x \rbrace }$</span>     </span> (assuming <em>x</em> &#x2264; <em>y</em>). Also, <em>P</em>     <sub>1</sub>&#x227A;<em>P</em>     <sub>2</sub> and <em>K</em>(<em>P</em>     <sub>1</sub>, <em>P</em>     <sub>2</sub>) = &#x2212;1 show that the answers to <em>q</em>     <sub>3</sub> satisfying <em>P</em>     <sub>2</sub> are exactly the answers to <em>q</em>     <sub>3</sub> minus the answers to <em>q</em>     <sub>3</sub> that satisfy <em>P</em>     <sub>1</sub>.</p>    <p>For an answer <em>&#x03C4;</em> to <em>&#x03BC;</em>(<em>q</em>) on <em>H</em> and an appropriate partition <em>P</em>, we define coefficients <em>N<sub>&#x03C4;</sub>     </em>(<em>P</em>) and <em>F<sub>&#x03C4;</sub>     </em>(<em>P</em>) as follows.</p>    <div class="definition" id="enc7">     <Label>Definition 4.2.</Label>     <p>      <em>Let <em>&#x03C4;</em> be an answer to <em>&#x03BC;</em>(<em>q</em>) on <em>H</em>. A partition <em>P</em> &#x2208; <em>B</em> is</em> satisfied<em>by <em>&#x03C4;</em> if, for each </em>      <span class="inline-equation"><span class="tex">${x \in \mathsf {var}(q)}$</span>      </span>      <em>, (i)&#x00A0;</em>      <span class="inline-equation"><span class="tex">${\gamma _P(x) \in \mathsf {var}(q)}$</span>      </span>      <em> implies <em>&#x03C4;</em>(<em>x</em>) = <em>&#x03C4;</em>(<em>&#x03B3;<sub>P</sub>       </em>(<em>x</em>)), and (ii)&#x00A0; </em>      <span class="inline-equation"><span class="tex">${\gamma _P(x) \in \mathsf {res}(q)}$</span>      </span>      <em> implies <em>&#x03C4;</em>(<em>x</em>) = <em>&#x03BC;</em>(<em>&#x03B3;<sub>P</sub>       </em>(<em>x</em>)). Set <em>B<sub>&#x03C4;</sub>       </em> contains all partitions of <em>B</em> satisfied by <em>&#x03C4;</em>. For <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>       </em>, let </em>      <div class="table-responsive">       <div class="display-equation">       <span class="tex mytex">\begin{align*} N_{\tau }(P) &#x0026; = \prod _{x \in \mathsf {varrng}(\gamma _P)} s[\tau (x)] \qquad \qquad \text{and} \\[1ex] F_{\tau }(P) &#x0026; = {\left\lbrace \begin{array}{@{}l@{\quad }l@{}}\prod \limits _{h\in \tau (\mu (q))} \frac{(w[h])_{{h}}}{(s[h])_{{h}}} &#x0026; \text{if } {h} \le w[h] ~ \forall h\in \tau (\mu (q)) \\[1ex] 0 &#x0026; \text{otherwise} \end{array}\right.} \\ &#x0026; \hspace{42.67912pt} \text{where } {h} = |\lbrace u \in P \mid \tau (\mu (u)) = \lbrace h \rbrace \rbrace |.\end{align*} </span>       <br/>       </div>      </div>     </p>    </div>    <p>In our example, <span class="inline-equation"><span class="tex">${\gamma _{P_2}(x) = \gamma _{P_2}(y)}$</span>     </span> and <em>&#x03C4;</em>     <sub>1</sub>(<em>x</em>) &#x2260; <em>&#x03C4;</em>     <sub>1</sub>(<em>y</em>) imply that <em>P</em>     <sub>2</sub> is not satisfied by <em>&#x03C4;</em>     <sub>1</sub>, which intuitively means that no expansion of <em>&#x03C4;</em>     <sub>1</sub> can match the atoms of <em>q</em>     <sub>3</sub> as required by <em>P</em>     <sub>2</sub>. Moreover, <span class="inline-equation"><span class="tex">${N_{\tau _3}(P_1) = s[\tau _3(x)] \cdot s[\tau _3(y)] = 4}$</span>     </span> and <span class="inline-equation"><span class="tex">${N_{\tau _3}(P_2) = s[\tau _3(x)] = 2}$</span>     </span> count the expansions of <em>&#x03C4;</em>     <sub>3</sub> that comply with <span class="inline-equation"><span class="tex">$\gamma _{P_1}$</span>     </span> and <span class="inline-equation"><span class="tex">$\gamma _{P_2}$</span>     </span>, respectively; thus, the number of expansions of <em>&#x03C4;</em>     <sub>3</sub> complying with just <em>P</em>     <sub>1</sub> is <div class="table-responsive">      <div class="display-equation">       <span class="tex mytex">\begin{eqnarray*} K(P_1,P_1) \cdot N_{\tau _3}(P_1) + K(P_1,P_2) \cdot N_{\tau _3}(P_2) = 1 \cdot 4 - 1 \cdot 2 = 2.\end{eqnarray*} </span>       <br/>      </div>     </div> The contribution of each expansion of <em>&#x03C4;</em>     <sub>3</sub> matching the atoms of <em>q</em>     <sub>3</sub> to distinct triples is <span class="inline-equation"><span class="tex">$F_{\tau _3}(P_1)$</span>     </span>: set <em>&#x03C4;</em>     <sub>3</sub>(<em>&#x03BC;</em>(<em>u</em>)) contains just <em>h</em>     <sub>3</sub> for each <em>u</em> &#x2208; <em>P</em>     <sub>1</sub>, so <em>h</em>     <sub>3</sub> = 2, and <span class="inline-equation"><span class="tex">${F_{\tau _3}(P_1) \approx 0.167}$</span>     </span>.</p>    <p>Thus, to compute <em>E</em>     <sub>      <em>q</em>, <em>S</em>     </sub>, we evaluate <em>&#x03BC;</em>(<em>q</em>) in <em>H</em> and, for each answer <em>&#x03C4;</em>, we combine <em>F<sub>&#x03C4;</sub>     </em>(<em>P</em>) and <em>N<sub>&#x03C4;</sub>     </em>(<em>P</em>&#x2032;) as in Theorem&#x00A0;<a class="enc" href="#enc8">4.3</a>. Enumerating all <em>&#x03C4;</em> corresponds to query answering and is thus polynomial in |<em>H</em>|, and the size of <em>B<sub>&#x03C4;</sub>     </em> does not depend on <em>H</em>; hence <em>E</em>     <sub>      <em>q</em>, <em>S</em>     </sub> can be computed in time polynomial in |<em>H</em>|. Moreover, Theorem&#x00A0;<a class="enc" href="#enc9">4.4</a> shows how to compute the variance of the cardinality of <em>q</em>.</p>    <div class="theorem" id="enc8">     <Label>Theorem 4.3.</Label>     <p> The following identity holds: <div class="table-responsive">       <div class="display-equation">       <span class="tex mytex">\begin{align*} E_{q, S} = \sum _{\tau \in [[ \mu (q) ]] _{H}} \ \sum _{P \in B_\tau } F_{\tau }(P) \cdot \sum _{{{\scriptstyle {\begin{array}{*10c}P^{\prime } \in B_\tau , P \preceq P^{\prime }\end{array}}}}} K(P,P^{\prime }) \cdot N_{\tau }(P^{\prime }).\end{align*} </span>       <br/>       </div>      </div>     </p>    </div>    <div class="theorem" id="enc9">     <Label>Theorem 4.4.</Label>     <p> Identity <span class="inline-equation"><span class="tex">${\sigma _{q, S}^2 = E_{q \cup \rho (q), S} - E_{q, S}^2}$</span>      </span> holds, where <em>&#x03C1;</em> is a substitution mapping each variable in <span class="inline-equation"><span class="tex">$\mathsf {var}(q)$</span>      </span> to a fresh variable.</p>    </div>    <p>We next introduce the notion of <em>      <em>&#x03BC;</em>-unification-free queries</em>, where no two distinct atoms can ever be mapped to the same triple. Proposition&#x00A0;<a class="enc" href="#enc11">4.6</a> shows that, for such queries, the simpler formula (<a class="eqn" href="#eq1">1</a>) correctly computes the expectation <em>E</em>     <sub>      <em>q</em>, <em>S</em>     </sub>.</p>    <div class="definition" id="enc10">     <Label>Definition 4.5.</Label>     <p>      <em>Atoms <em>a</em>       <sub>1</sub> and <em>a</em>       <sub>2</sub> are</em> unifiable<em>if a substitution <em>&#x03BA;</em> exists such that <em>&#x03BA;</em>(<em>a</em>       <sub>1</sub>) = <em>&#x03BA;</em>(<em>a</em>       <sub>2</sub>). Query <em>q</em> is &#x03BC;</em>-unification-free<em>if no two distinct atoms of <em>&#x03BC;</em>(<em>q</em>) are unifiable; otherwise, query <em>q</em> is &#x03BC;</em>-unifiable<em>.</em>     </p>    </div>    <div class="proposition" id="enc11">     <Label>Proposition 4.6.</Label>     <p> Formula&#x00A0;(<a class="eqn" href="#eq1">1</a>) correctly computes <em>E</em>      <sub>       <em>q</em>, <em>S</em>      </sub> when <em>q</em> is a <em>&#x03BC;</em>-unification-free query.</p>    </div>    <p>Queries <em>q</em>     <sub>1</sub> and <em>q</em>     <sub>2</sub> from Section&#x00A0;<a class="sec" href="#sec-8">4.1</a> are <em>&#x03BC;</em>-unification-free, while <em>q</em>     <sub>3</sub> is not. Moreover, query <em>q</em>     <sub>4</sub> = {&#x27E8;<em>e</em>     <sub>3</sub>, <em>owns</em>, <em>x</em>&#x27E9;, &#x27E8;<em>e</em>     <sub>4</sub>, <em>owns</em>, <em>y</em>&#x27E9;} is also <em>not &#x03BC;</em>-unification-free: its atoms unify <em>after</em> applying <em>&#x03BC;</em> to <em>q</em>     <sub>4</sub>. Note that queries used in practice often consist of atoms of the form &#x27E8;<em>t</em>, <em>r</em>, <em>t</em>&#x2032;&#x27E9; and &#x27E8;<em>t</em>, <em>rdf:type</em>, <em>r</em>&#x27E9; where <em>t</em> and <em>t</em>&#x2032; are terms and <em>r</em> is a distinct resource; then, such queries are unification-free whenever each such resource <em>r</em> is assigned to a distinct bucket.</p>    <p>If <em>q</em> is <em>&#x03BC;</em>-unification-free, then <em>P</em> = {{<em>a<sub>i</sub>     </em>}&#x2223;<em>a<sub>i</sub>     </em> &#x2208; <em>q</em>} is the only unifiable partition of <em>q</em>, so the estimation formula simplifies to (<a class="eqn" href="#eq1">1</a>). In particular, <em>P</em>&#x2032; in the last sum in Theorem&#x00A0;<a class="enc" href="#enc8">4.3</a> can in such cases only be <em>P</em>, so the summation reduces to <em>N<sub>&#x03C4;</sub>     </em>(<em>P</em>)&#x2014;the first product of (<a class="eqn" href="#eq1">1</a>). Moreover, the atoms of <em>&#x03BC;</em>(<em>q</em>) cannot be equated, so <em>h</em> = 1 for each <em>h</em> &#x2208; <em>&#x03C4;</em>(<em>&#x03BC;</em>(<em>q</em>)); thus, <em>F<sub>&#x03C4;</sub>     </em>(<em>P</em>) reduces to the second product of (<a class="eqn" href="#eq1">1</a>).</p>    </section>   </section>   <section id="sec-10">    <header>    <div class="title-info">     <h2>      <span class="section-number">5</span> Summarising RDF Graphs</h2>    </div>    </header>    <p>As we have mentioned in Section&#x00A0;<a class="sec" href="#sec-4">1</a>, reusing existing graph summarisation techniques proved challenging: some produced summaries that did not lead to accurate cardinality estimates, and others could not be efficiently applied to large graphs. We thus developed a new summarisation approach consisting of two steps we describe next.</p>    <section id="sec-11">    <header>     <div class="title-info">      <h3>       <span class="section-number">5.1</span> Typed Summary</h3>     </div>    </header>    <p>To obtain a coarse measure of resource similarity, we assign to each resource <em>d</em> in an RDF graph <em>G</em> a <em>type</em>     <span class="inline-equation"><span class="tex">${\mathsf {t}_{d} = \langle C(d), O(d), I(d), P(d) \rangle }$</span>     </span>, which is a tuple consisting of four components described next.</p>    <p>The most important component of <span class="inline-equation"><span class="tex">$\mathsf {t}_{d}$</span>     </span> is the <em>class typeC</em>(<em>d</em>) of <em>d</em>, which is the set defined as follows: <div class="table-responsive">      <div class="display-equation">       <span class="tex mytex">\begin{eqnarray*} C(d) = {\left\lbrace \begin{array}{@{}l@{\quad }l@{}}\lbrace o \in \mathsf {res}(G) \mid \langle d, \mathit {rdf}\mathit {:}\mathit {type}, o \rangle \in G \rbrace &#x0026; \text{if } d\text{ is a URI}, \\\lbrace \text{the datatype of } d \rbrace &#x0026; \text{if } d\text{ is a literal}. \\\end{array}\right.}\end{eqnarray*} </span>       <br/>      </div>     </div> One can intuitively expect that a summary whose buckets contain, say, both people and cars, is unlikely to provide good cardinality estimates. Thus, our summarisation approaches will put resources <em>d</em>     <sub>1</sub> and <em>d</em>     <sub>2</sub> into the same bucket only if <em>C</em>(<em>d</em>     <sub>1</sub>) = <em>C</em>(<em>d</em>     <sub>2</sub>) holds. A similar idea has been used in query answering over ontologies [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0009">9</a>].</p>    <p>Sets <em>O</em>(<em>d</em>) and <em>I</em>(<em>d</em>) describe the outgoing and incoming connections of <em>d</em>. Let &#x27E8;<em>p</em>     <sub>1</sub>, &#x2026;, <em>p<sub>k</sub>     </em>&#x27E9; be an arbitrary ordering of the predicates in <em>G</em> different from <em>rdf:type</em>; then, we could capture the outgoing connections of <em>d</em> by a vector &#x27E8;<em>n</em>     <sub>1</sub>, &#x2026;, <em>n<sub>k</sub>     </em>&#x27E9;, where each <em>n<sub>i</sub>     </em> is the number of the outgoing connections from <em>d</em> for predicate <em>p<sub>i</sub>     </em>. This, however, is likely to create too many types: resources in an RDF graph are unlikely to have exactly the same outgoing connections with the same cardinalities. We thus represent the cardinality information using histograms. For each predicate <em>p<sub>i</sub>     </em>, we compute the set <span class="inline-equation"><span class="tex">$\mathit {out}_{p_i}$</span>     </span> that, for each resource <em>d<sub>j</sub>     </em> occurring in <em>G</em> in subject position, contains a pair <span class="inline-equation"><span class="tex">${\langle d_j, \, |\lbrace o \in \mathsf {res}(G) \text{ such that } \langle d_j, p_i, o \rangle \in G \rbrace | \, \rangle }$</span>     </span> associating <em>d<sub>j</sub>     </em> with the number of resources that <em>d<sub>j</sub>     </em> is connected to via property <em>p<sub>i</sub>     </em>. We sort the pairs in <span class="inline-equation"><span class="tex">$\mathit {out}_{p_i}$</span>     </span> by the value of their second component into a list &#x27E8;<em>d</em>     <sub>1</sub>, <em>n</em>     <sub>1</sub>&#x27E9;, &#x2026;, &#x27E8;<em>d<sub>N</sub>     </em>, <em>n<sub>N</sub>     </em>&#x27E9;. Finally, given a predetermined number <em>J<sub>i</sub>     </em> of histogram buckets (not to be confused with summary buckets) for <em>p<sub>i</sub>     </em>, we create a histogram for <span class="inline-equation"><span class="tex">$\mathit {out}_{p_i}$</span>     </span>: for <em>w</em> = &#x2308;<em>N</em>/<em>J<sub>i</sub>     </em>&#x2309;, the first bucket contains resources <em>d</em>     <sub>1</sub>, &#x2026;, <em>d<sub>w</sub>     </em> and has ID 1, the second bucket contains resources <em>d</em>     <sub>      <em>w</em> + 1</sub>, &#x2026;, <em>d</em>     <sub>2<em>w</em>     </sub> and has ID 2, and so on. Thus, each bucket contains resources with similar outgoing frequencies for <em>p<sub>i</sub>     </em>, and the difference between bucket IDs is indicative of the bucket similarity. Then, the <em>outgoing type O</em>(<em>d</em>) of a resource <em>d</em> is the vector &#x27E8;<em>O</em>     <sub>1</sub>, &#x2026;, <em>O<sub>k</sub>     </em>&#x27E9;, where each <em>O<sub>i</sub>     </em> is the ID of the bucket that <em>d</em> was assigned to in the histogram for <em>p<sub>i</sub>     </em>. The <em>incoming typeI</em>(<em>d</em>) of <em>d</em> is defined analogously. The numbers of buckets can be selected independently for each predicate and direction: it is reasonable to use a larger number of buckets if the relevant frequencies vary significantly across resources.</p>    <p>Finally, we also identify highly connected groups of resources: one can intuitively expect that such resources should be assigned to the same bucket. To this end, we divide the resources into a predetermined number of partitions of roughly the same size while minimising the number of edges between partitions using the algorithms by Karypis and Kumar [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0022">22</a>]. The <em>partition type P</em>(<em>d</em>) of a resource <em>d</em> is the partition to which <em>d</em> was assigned to.</p>    <p>Thus, if the types <span class="inline-equation"><span class="tex">$\mathsf {t}_{d_1}$</span>     </span> and <span class="inline-equation"><span class="tex">$\mathsf {t}_{d_2}$</span>     </span> of resources <em>d</em>     <sub>1</sub> and <em>d</em>     <sub>2</sub> are the same, then <em>d</em>     <sub>1</sub> and <em>d</em>     <sub>2</sub> occur in the same classes (or datatypes), have comparable outgoing and incoming frequencies for all predicates, and belong to the same highly connected component of the RDF graph; hence, we can expect <em>d</em>     <sub>1</sub> and <em>d</em>     <sub>2</sub> to be similar. Thus, we define the <em>typed summary S</em> = &#x27E8;<em>H</em>, <em>w</em>, <em>&#x03BC;</em>&#x27E9; of an RDF <em>G</em> as follows: for each resource <span class="inline-equation"><span class="tex">${d\in \mathsf {res}(G)}$</span>     </span>, if <em>d</em> occurs in <em>G</em> in triples of the form &#x27E8;<em>s</em>, <em>d</em>, <em>o</em>&#x27E9; or &#x27E8;<em>s</em>, <em>rdf:type</em>, <em>d</em>&#x27E9;, we let <em>&#x03BC;</em>(<em>d</em>) = <em>d</em>; otherwise, we let <span class="inline-equation"><span class="tex">${\mu (d) = b_{\mathsf {t}_{d}}}$</span>     </span>, where <span class="inline-equation"><span class="tex">$b_{\mathsf {t}_{d}}$</span>     </span> is a distinct bucket uniquely associated with the type <span class="inline-equation"><span class="tex">$\mathsf {t}_{d}$</span>     </span> of <em>d</em>. Finally, we define <em>H</em> = <em>&#x03BC;</em>(<em>G</em>) and adjust the function <em>w</em> accordingly.</p>    </section>    <section id="sec-12">    <header>     <div class="title-info">      <h3>       <span class="section-number">5.2</span> Summary Refinement by MinHashing</h3>     </div>    </header>    <p>If a typed summary is large, we compress it by merging similar buckets and types. To identify similar buckets, we define the <em>vicinity V<sub>S</sub>     </em>(<em>b</em>) of a bucket <span class="inline-equation"><span class="tex">${b \in \mathsf {res}(H)}$</span>     </span> as the union of the following sets: <div class="table-responsive">      <div class="display-equation">       <span class="tex mytex">\begin{align*} V_{S}^{\mathit {out}}(b) &#x0026; = \lbrace \langle b_p, b_o \rangle \mid \langle b, b_p, b_o \rangle \in H\wedge b_p \ne \mu (\mathit {rdf}\mathit {:}\mathit {type}) \rbrace , \\V_{S}^{\mathit {in}}(b) &#x0026; = \lbrace \langle b_i, b_p \rangle \mid \langle b_i, b_p, b \rangle \in H\wedge b_p \ne \mu (\mathit {rdf}\mathit {:}\mathit {type}) \rbrace .\end{align*} </span>       <br/>      </div>     </div> Since vicinity <em>V<sub>S</sub>     </em>(<em>b</em>) describes the connections of <em>b</em>, given buckets <span class="inline-equation"><span class="tex">${b_1,b_2 \in \mathsf {res}(H)}$</span>     </span>, the degree of commonality between <em>V<sub>S</sub>     </em>(<em>b</em>     <sub>1</sub>) and <em>V<sub>S</sub>     </em>(<em>b</em>     <sub>2</sub>) is indicative of the similarity of <em>b</em>     <sub>1</sub> and <em>b</em>     <sub>2</sub>. This is captured by the <em>Jaccard index</em> [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0027">27</a>] of <em>b</em>     <sub>1</sub> and <em>b</em>     <sub>2</sub>, which is defined as <div class="table-responsive">      <div class="display-equation">       <span class="tex mytex">\begin{eqnarray*} \mathcal {J}_{S}(b_1, b_2) = \frac{|V_{S}(b_1) \cap V_{S}(b_2)|}{|V_{S}(b_1) \cup V_{S}(b_2)|}\end{eqnarray*} </span>       <br/>      </div>     </div> if <em>V<sub>S</sub>     </em>(<em>b</em>     <sub>1</sub>)&#x222A;<em>V<sub>S</sub>     </em>(<em>b</em>     <sub>2</sub>) &#x2260; &#x2205;, and otherwise <span class="inline-equation"><span class="tex">${\mathcal {J}_{S}(b_1, b_2) = 1}$</span>     </span>. Thus, we can na&#x00EF;vely reduce the size of <em>S</em> by repeatedly merging the pair of buckets <em>b</em>     <sub>1</sub> and <em>b</em>     <sub>2</sub> with maximal <span class="inline-equation"><span class="tex">$\mathcal {J}_{S}(b_1, b_2)$</span>     </span>, but this is impractical for two reasons. First, computing <span class="inline-equation"><span class="tex">$\mathcal {J}_{S}(b_1, b_2)$</span>     </span> requires iterating over <em>V<sub>S</sub>     </em>(<em>b</em>     <sub>1</sub>) and <em>V<sub>S</sub>     </em>(<em>b</em>     <sub>2</sub>), which can be large. Second, the number of pairs of <em>b</em>     <sub>1</sub> and <em>b</em>     <sub>2</sub> can be large in even moderately sized summaries.</p>    <p>We address the first problems using MinHashing [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0027">27</a>], which uses fixed-sized signatures to approximate <span class="inline-equation"><span class="tex">$\mathcal {J}_{S}(b_1, b_2)$</span>     </span>. Given two integer parameters <em>m</em> and <em>n</em>, we generate a <em>MinHash scheme </em>     <span class="inline-equation"><span class="tex">$\mathcal {F}$</span>     </span>     <em> of size <em>m</em> &#x00D7; <em>n</em>     </em>, which is an <em>m</em> &#x00D7; <em>n</em> matrix of hash functions chosen uniformly at random with replacement. Each <span class="inline-equation"><span class="tex">$\mathcal {F}[i,j]$</span>     </span> maps elements of <em>V<sub>S</sub>     </em>(<em>b</em>) (i.e., pairs of resources) to natural numbers. The <em>signature</em> of a bucket <span class="inline-equation"><span class="tex">${b \in \mathsf {res}(H)}$</span>     </span> on <span class="inline-equation"><span class="tex">$\mathcal {F}$</span>     </span> and <em>S</em> is the <em>m</em> &#x00D7; <em>n</em> matrix <span class="inline-equation"><span class="tex">$\mathcal {M}^{b}$</span>     </span> where <div class="table-responsive">      <div class="display-equation">       <span class="tex mytex">\begin{eqnarray*} \mathcal {M}^{b}[i,j] = \min _{\alpha \in V_{S}(b)} \mathcal {F}[i,j](\alpha)\end{eqnarray*} </span>       <br/>      </div>     </div> if <em>V<sub>S</sub>     </em>(<em>b</em>) &#x2260; &#x2205;, and otherwise <span class="inline-equation"><span class="tex">${\mathcal {M}^{b}[i,j] = \infty }$</span>     </span>. It is known that <div class="table-responsive">      <div class="display-equation">       <span class="tex mytex">\begin{eqnarray*} \mathcal {\hat{J}}_{S}(b_1, b_2) = \dfrac{| \lbrace \langle i,j \rangle \mid \mathcal {M}^{b_1}[i,j] = \mathcal {M}^{b_2}[i,j] \rbrace |}{m\cdot n} \\\end{eqnarray*} </span>       <br/>      </div>     </div> is a good approximation of the Jaccard index of buckets <em>b</em>     <sub>1</sub> and <em>b</em>     <sub>2</sub> [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0027">27</a>]. For <em>i</em> &#x2208; [1, <em>m</em>], we write <span class="inline-equation"><span class="tex">$\mathcal {M}^{b}[i]$</span>     </span> for the <em>i</em>-th row of <span class="inline-equation"><span class="tex">$\mathcal {M}^{b}$</span>     </span>.</p>    <p>We address the second problem using locality sensitive hashing [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0027">27</a>]: we generate a hash function <em>lsh</em> for <span class="inline-equation"><span class="tex">$\mathcal {M}^{b}[i]$</span>     </span> and use it to assign each bucket <em>b</em> to a bin <span class="inline-equation"><span class="tex">$\mathit {Bins}[{lsh}{\mathcal {M}^{b}[i]}]$</span>     </span>. For each <em>Bin</em> &#x2208; <em>Bins</em> and all buckets <em>b</em>     <sub>1</sub>, <em>b</em>     <sub>2</sub> &#x2208; <em>Bin</em>, it is known that <span class="inline-equation"><span class="tex">$\mathcal {\hat{J}}_{S}(b_1, b_2)$</span>     </span> is likely to be high, so all pairs of buckets in <em>Bin</em> are likely to be similar&#x00A0;[<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0027">27</a>].</p>    <p>     <img src="../../../data/deliveryimages.acm.org/10.1145/3190000/3186003/images/www2018-12-img1.svg" class="img-responsive" alt=""      longdesc=""/>    </p>    <p>Algorithm&#x00A0;1 uses these ideas to compute a summary of a graph <em>G</em>. It takes as arguments a set of types <span class="inline-equation"><span class="tex">$\mathsf {T}$</span>     </span> covering all resources of <em>G</em>. The algorithm first converts <em>G</em> into a trivial summary <em>S</em> (line&#x00A0;3) where <em>H</em> = <em>G</em> and <em>&#x03BC;</em>(<em>d</em>) = <em>d</em> for each <span class="inline-equation"><span class="tex">${d\in \mathsf {res}(G)}$</span>     </span>, and then it computes the sets <span class="inline-equation"><span class="tex">$\mathcal {B}_{\mathsf {t}_{}}$</span>     </span> of buckets of type <span class="inline-equation"><span class="tex">$\mathsf {t}_{}$</span>     </span> for each <span class="inline-equation"><span class="tex">${\mathsf {t}_{} \in \mathsf {T}}$</span>     </span> (line&#x00A0;4). The algorithm next enters a loop (lines&#x00A0;5 &#x2013;21) that merges buckets of the same type. It returns <em>S</em> if the number of edges in <em>H</em> is in the required space budget (line&#x00A0;6); otherwise, it considers each type <span class="inline-equation"><span class="tex">${\mathsf {t}_{} \in \mathsf {T}}$</span>     </span> (lines&#x00A0;8 &#x2013;16) and computes the signature of each bucket <span class="inline-equation"><span class="tex">${b \in \mathcal {B}_{\mathsf {t}_{}}}$</span>     </span> (line&#x00A0;9). For each row <em>i</em> of the signature (lines&#x00A0;10 &#x2013;16), the algorithm applies locality sensitive hashing to each bucket <span class="inline-equation"><span class="tex">${b \in \mathcal {B}_{\mathsf {t}_{}}}$</span>     </span> (line&#x00A0;12) and adds <em>b</em> to a bin. The number of bins is not predetermined, which reduces collisions. Finally, for all bins containing at least two buckets, all buckets in the bin are scheduled to be merged into one designated bucket <em>b</em> (lines&#x00A0;13 &#x2013;16). Locality sensitive hashing ensures that similar buckets are likely to end in the same bin, but this is not guaranteed so the standard algorithm would merge <em>b</em>&#x2032; and <em>b</em> only if the estimate <span class="inline-equation"><span class="tex">$\mathcal {\hat{J}}_{S}(b, b^{\prime })$</span>     </span> is above a particular threshold. We skip this step for two reasons: the quadratic step of computing <span class="inline-equation"><span class="tex">$\mathcal {\hat{J}}_{S}(b, b^{\prime })$</span>     </span> for all pairs of buckets in a bin can be prohibitive, and the chance that dissimilar buckets are assigned to the same bin is small since we do not limit the number of bins. After all signature rows have been considered, the merges are applied to the summary (line&#x00A0;18). Finally, if the size of <em>S</em> has not been reduced sufficiently, then the types in <span class="inline-equation"><span class="tex">$\mathsf {T}$</span>     </span> are too specific to allow further merges, so the algorithm merges similar types in <span class="inline-equation"><span class="tex">$\mathsf {T}$</span>     </span> (line&#x00A0;20) to allow further reducing in the size of <em>S</em>.</p>    <p>Let <span class="inline-equation"><span class="tex">$\mathsf {t}_{}$</span>     </span> and <span class="inline-equation"><span class="tex">$\mathsf {t}_{}^{\prime }$</span>     </span> be types whose outgoing and incoming types are &#x27E8;<em>O</em>     <sub>1</sub>, &#x2026;, <em>O<sub>k</sub>     </em>&#x27E9; and <span class="inline-equation"><span class="tex">$\langle O_1^{\prime }, \dots , O_k^{\prime } \rangle$</span>     </span>, and &#x27E8;<em>I</em>     <sub>1</sub>, &#x2026;, <em>I<sub>k</sub>     </em>&#x27E9; and <span class="inline-equation"><span class="tex">$\langle I_1^{\prime }, \dots , I_k^{\prime } \rangle$</span>     </span>. Then, <span class="inline-equation"><span class="tex">$\mathsf {t}_{}$</span>     </span> and <span class="inline-equation"><span class="tex">$\mathsf {t}_{}^{\prime }$</span>     </span> can be similar only if their class and partition types coincide, and their similarity <span class="inline-equation"><span class="tex">$\mathcal {J}(\mathsf {t}_{},\mathsf {t}_{}^{\prime })$</span>     </span> is the average of the generalised Jaccard indexes [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0027">27</a>] of their outgoing and incoming types: <div class="table-responsive">      <div class="display-equation">       <span class="tex mytex">\begin{eqnarray*} \mathcal {J}(\mathsf {t}_{},\mathsf {t}_{}^{\prime }) = \frac{1}{2}\left(\sum _i\frac{\min (O_i,O_i^{\prime })}{\max (O_i,O_i^{\prime })} + \sum _i\frac{\min (I_i,I_i^{\prime })}{\max (I_i,I_i^{\prime })}\right).\end{eqnarray*} </span>       <br/>      </div>     </div> Merging <span class="inline-equation"><span class="tex">$\mathsf {t}_{}$</span>     </span> and <span class="inline-equation"><span class="tex">$\mathsf {t}_{}^{\prime }$</span>     </span> produces <span class="inline-equation"><span class="tex">$\mathsf {t}_{}^{\prime \prime }$</span>     </span> with the class and partition types same as <span class="inline-equation"><span class="tex">$\mathsf {t}_{}$</span>     </span> and <span class="inline-equation"><span class="tex">$\mathsf {t}_{}^{\prime }$</span>     </span>, outgoing type <span class="inline-equation"><span class="tex">${\langle (O_1 + O_1^{\prime })/2, \dots , (O_k + O_k^{\prime })/2 \rangle }$</span>     </span>, and an analogous incoming type; we also set <span class="inline-equation"><span class="tex">${\mathcal {B}_{\mathsf {t}_{}^{\prime \prime }} = \mathcal {B}_{\mathsf {t}_{}} \cup \mathcal {B}_{\mathsf {t}_{}^{\prime }}}$</span>     </span>.</p>    <p>To merge the types in line&#x00A0;20, the algorithm first groups the types by their class and partition type. Ideally, we would merge the most similar pairs within each such group, but computing the similarity of each pair in the group would be prohibitively expensive. Instead, the algorithm selects 500 pairs at random, computes their similarity, and merges the most similar pair if their similarity is at least 50%. This process is repeated until the size of <span class="inline-equation"><span class="tex">$\mathsf {T}$</span>     </span> is reduced by 20% (if possible), which then allows for further merging of buckets.</p>    </section>    <section id="sec-13">    <header>     <div class="title-info">      <h3>       <span class="section-number">5.3</span> Choosing the Parameters</h3>     </div>    </header>    <p>To recapitulate, our algorithm is parametrised by (i)&#x00A0;the number of buckets for the incoming and outgoing histograms per predicate, (ii)&#x00A0;the number of partitions, (iii)&#x00A0;the target size of the summary, and (iv)&#x00A0;the size of the MinHash scheme <em>m</em> &#x00D7; <em>n</em> (if used). Standard techniques can be used to choose the number of buckets, such as the Freedman&#x2013;Diaconis rule [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0010">10</a>]. We found it reasonable to partition a graph into 10 partitions, and fall back to just one partition if more than 20% of the edges are cut. We also identified <em>m</em> = 20, <em>n</em> = 2, and target sizes in the order of tens of thousands as reasonable defaults.</p>    </section>   </section>   <section id="sec-14">    <header>    <div class="title-info">     <h2>      <span class="section-number">6</span> Experimental Evaluation</h2>    </div>    </header>    <div class="table-responsive" id="tab1">    <div class="table-caption">     <span class="table-number">Table 1:</span>     <span class="table-title">Dataset, summary, and query statistics.</span>    </div> <style type="text/css"> .firstcol {  border-right: 1px solid #000; } .lastcol {  border-left: 1px solid #000; } th, td { 	border-collapse:collapse; 	border: 1px solid black; 	padding-top:0; 	padding-bottom:0; } </style>     <table class="table">     <thead>      <tr>       <th style="text-align:center;"/>       <th colspan="2" style="text-align:center;">Original graph <em>G</em>       </th>       <th colspan="4" style="text-align:center;">Summary <em>S</em>       </th>       <th colspan="16" style="text-align:center;">Queries by type       </th>      </tr>      <tr>       <th style="text-align:center;">Benchmark</th>       <th style="text-align:center;">Nr</th>       <th style="text-align:center;">Nr</th>       <th style="text-align:center;">Nr</th>       <th style="text-align:center;">Nr</th>       <th style="text-align:center;">Reduction</th>       <th style="text-align:center;">Construction</th>       <th colspan="4" style="text-align:center;">Linear       </th>       <th colspan="4" style="text-align:center;">Star       </th>       <th colspan="4" style="text-align:center;">Snowflake       </th>       <th colspan="4" style="text-align:center;">Complex       </th>      </tr>      <tr>       <th style="text-align:center;"/>       <th style="text-align:center;">resources</th>       <th style="text-align:center;">triples</th>       <th style="text-align:center;">buckets</th>       <th style="text-align:center;">triples</th>       <th style="text-align:center;">factor</th>       <th style="text-align:center;">time</th>       <th style="text-align:center;">total</th>       <th style="text-align:center;">       <em>&#x03BC;</em>-un.</th>       <th style="text-align:center;">min</th>       <th style="text-align:center;">max</th>       <th style="text-align:center;">total</th>       <th style="text-align:center;">       <em>&#x03BC;</em>-un.</th>       <th style="text-align:center;">min</th>       <th style="text-align:center;">max</th>       <th style="text-align:center;">total</th>       <th style="text-align:center;">       <em>&#x03BC;</em>-un.</th>       <th style="text-align:center;">min</th>       <th style="text-align:center;">max</th>       <th style="text-align:center;">total</th>       <th style="text-align:center;">       <em>&#x03BC;</em>-un.</th>       <th style="text-align:center;">min</th>       <th style="text-align:center;">max</th>      </tr>     </thead>     <tbody>      <tr>       <td style="text-align:center;">LUBM</td>       <td style="text-align:center;">16.4&#x00A0;M</td>       <td style="text-align:center;">&#x00A0; 91.1&#x00A0;M</td>       <td style="text-align:center;">313</td>       <td style="text-align:center;">14,926</td>       <td style="text-align:center;">6.1&#x00A0;k</td>       <td style="text-align:center;">6&#x00A0;min</td>       <td style="text-align:center;">16</td>       <td style="text-align:center;">3</td>       <td style="text-align:center;">1</td>       <td style="text-align:center;">6</td>       <td style="text-align:center;">2</td>       <td style="text-align:center;">0</td>       <td style="text-align:center;">4</td>       <td style="text-align:center;">10</td>       <td style="text-align:center;">6</td>       <td style="text-align:center;">0</td>       <td style="text-align:center;">4</td>       <td style="text-align:center;">10</td>       <td style="text-align:center;">14</td>       <td style="text-align:center;">2</td>       <td style="text-align:center;">4</td>       <td style="text-align:center;">9</td>      </tr>      <tr>       <td style="text-align:center;">WatDiv</td>       <td style="text-align:center;">10.2&#x00A0;M</td>       <td style="text-align:center;">108.9&#x00A0;M</td>       <td style="text-align:center;">5,504</td>       <td style="text-align:center;">43,350</td>       <td style="text-align:center;">2.5&#x00A0;k</td>       <td style="text-align:center;">2&#x00A0;h</td>       <td style="text-align:center;">30</td>       <td style="text-align:center;">0</td>       <td style="text-align:center;">2</td>       <td style="text-align:center;">3</td>       <td style="text-align:center;">40</td>       <td style="text-align:center;">0</td>       <td style="text-align:center;">2</td>       <td style="text-align:center;">9</td>       <td style="text-align:center;">30</td>       <td style="text-align:center;">0</td>       <td style="text-align:center;">5</td>       <td style="text-align:center;">9</td>       <td style="text-align:center;">3</td>       <td style="text-align:center;">0</td>       <td style="text-align:center;">6</td>       <td style="text-align:center;">10</td>      </tr>      <tr>       <td style="text-align:center;">DBLP</td>       <td style="text-align:center;">25.4&#x00A0;M</td>       <td style="text-align:center;">&#x00A0; 55.5&#x00A0;M</td>       <td style="text-align:center;">4,765</td>       <td style="text-align:center;">28,631</td>       <td style="text-align:center;">1.9&#x00A0;k</td>       <td style="text-align:center;">45&#x00A0;min</td>       <td style="text-align:center;">4</td>       <td style="text-align:center;">0</td>       <td style="text-align:center;">1</td>       <td style="text-align:center;">4</td>       <td style="text-align:center;">1</td>       <td style="text-align:center;">1</td>       <td style="text-align:center;">3</td>       <td style="text-align:center;">3</td>       <td style="text-align:center;">2</td>       <td style="text-align:center;">1</td>       <td style="text-align:center;">6</td>       <td style="text-align:center;">7</td>       <td style="text-align:center;">8</td>       <td style="text-align:center;">6</td>       <td style="text-align:center;">5</td>       <td style="text-align:center;">11</td>      </tr>     </tbody>    </table>    </div>    <div class="table-responsive" id="tab2">    <div class="table-caption">     <span class="table-number">Table 2:</span>     <span class="table-title">Estimates confidence for varying q-errors.</span>    </div>    <table class="table">     <thead>      <tr>       <th style="text-align:right;">Q-Error &#x025B;</th>       <th colspan="5" style="text-align:center;">10       </th>       <th colspan="5" style="text-align:center;">100       </th>       <th colspan="5" style="text-align:center;">1000       </th>      </tr>      <tr>       <th style="text-align:right;">The % bound on <span class="inline-equation"><span class="tex">$\mathsf {P}\left(e\ge \varepsilon \right)$</span>       </span> from Theorem&#x00A0;<a class="enc" href="#enc5">3.5</a>       </th>       <th style="text-align:right;">[0,1]</th>       <th style="text-align:right;">(1, 5]</th>       <th style="text-align:right;">(5, 10]</th>       <th style="text-align:right;">(10, 25]</th>       <th style="text-align:right;"> > 25</th>       <th style="text-align:right;">[0,1]</th>       <th style="text-align:right;">(1, 5]</th>       <th style="text-align:right;">(5, 10]</th>       <th style="text-align:right;">(10, 25]</th>       <th style="text-align:right;"> > 25</th>       <th style="text-align:right;">[0,1]</th>       <th style="text-align:right;">(1, 5]</th>       <th style="text-align:right;">(5, 10]</th>       <th style="text-align:right;">(10, 25]</th>       <th style="text-align:right;"> > 25</th>      </tr>     </thead>     <tbody>      <tr>       <td style="text-align:right;">LUBM (29)</td>       <td style="text-align:right;">20 (2)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">6 (1)</td>       <td style="text-align:right;">2 (0)</td>       <td style="text-align:right;">1 (0)</td>       <td style="text-align:right;">25 (3)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">4 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">28 (1)</td>       <td style="text-align:right;">1 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>      </tr>      <tr>       <td style="text-align:right;">WatDiv (48)</td>       <td style="text-align:right;">16 (1)</td>       <td style="text-align:right;">6 (1)</td>       <td style="text-align:right;">1 (0)</td>       <td style="text-align:right;">10 (2)</td>       <td style="text-align:right;">15 (3)</td>       <td style="text-align:right;">42 (0)</td>       <td style="text-align:right;">1 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">5 (0)</td>       <td style="text-align:right;">43 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">5 (0)</td>      </tr>      <tr>       <td style="text-align:right;">DBLP (3)</td>       <td style="text-align:right;">2 (0)</td>       <td style="text-align:right;">1 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">3 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">3 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>       <td style="text-align:right;">0 (0)</td>      </tr>     </tbody>    </table>    </div>    <figure id="fig2">    <img src="../../../data/deliveryimages.acm.org/10.1145/3190000/3186003/images/www2018-12-fig2.svg" class="img-responsive" alt=""      longdesc=""/>    <div class="figure-caption">     <span class="figure-number">Figure 2:</span>     <span class="figure-title">Histograms and box plots of the distribution of the q-error on test datasets.</span>    </div>    </figure>    <p>We implemented our techniques in a prototype system called <font style="font-variant: small-caps">SumRDF</font>.<a class="fn" href="#fn1" id="foot-fn1"><sup>1</sup></a> The system is written in Java. It evaluates queries over graphs stored in RAM using left-deep index nested loop joins. We evaluated our system with three distinct objectives. First, we compared the accuracy of the estimates produced by <font style="font-variant: small-caps">SumRDF</font> and several state-of-the-art RDF and relational systems. Second, we investigated the impact of the correct handling of <em>&#x03BC;</em>-unifiable queries; these correspond to self-joins and are difficult to estimate. Third, we evaluated the usefulness of the bounds provided by Theorem&#x00A0;<a class="enc" href="#enc5">3.5</a>. We ran our experiments on a Dell computer with 96&#x00A0;GB of RAM, Fedora 22, and two Xeon X5667 processors with 16 physical cores.</p>    <section id="sec-15">    <header>     <div class="title-info">      <h3>       <span class="section-number">6.1</span> Test Data</h3>     </div>    </header>    <p>We used three well-known RDF benchmarks shown in Table&#x00A0;<a class="tbl" href="#tab1">1</a>. We group queries by their shape as linear, star, snowflake (joined stars), and complex (e.g., cyclic). For each group, we show the number of all queries, the number of <em>&#x03BC;</em>-unifiable queries, and the minimal and maximal numbers of atoms in a query. Each query is assigned an ID. All datasets and queries are available on the <font style="font-variant: small-caps">SumRDF</font> Web site.</p>    <p>     <strong>LUBM</strong>&#x00A0;[<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0017">17</a>] is a synthetic benchmark comprising a data generator, an OWL&#x00A0;2&#x00A0;DL ontology, and 14 test queries. The ontology must be taken into account for the queries to produce results, so we generated an RDF graph with 500 universities and extended it with triples implied by the ontology, thus obtaining 91.1&#x00A0;M triples. The 14 queries are relatively simple, and are all <em>&#x03BC;</em>-unification-free, so we additionally handcrafted 24 queries, five of which are <em>&#x03BC;</em>-unifiable.</p>    <p>     <strong>WatDiv</strong>&#x00A0;[<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0003">3</a>] is another synthetic benchmark designed to stress-test RDF systems. We used its data generator to obtain an RDF graph with 108.9&#x00A0;M triples. The benchmark also includes three queries and 17 query templates with one parameter, and a generator that replaces the parameter with resources from the RDF graph. We instantiated each query template into five concrete queries and, if the parameter was not in the class position, we obtained one more query by replacing the parameter with a fresh variable. We thus obtained 103 queries overall, all of which are <em>&#x03BC;</em>-unification-free.</p>    <p>     <strong>DBLP</strong> is a bibliography database that was converted into an RDF graph of 55.5&#x00A0;M triples. We used six queries already been considered in the literature [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0042">42</a>], and we handcrafted nine additional queries. We thus obtained 15 queries, eight of which are <em>&#x03BC;</em>-unifiable.</p>    </section>    <section id="sec-16">    <header>     <div class="title-info">      <h3>       <span class="section-number">6.2</span> Constructing the Summaries</h3>     </div>    </header>    <p>LUBM can be easily partitioned into ten partitions, and the numbers of connections do not vary much across resources so we used just one bucket per histogram. The typed summary for LUBM contained fewer than 15,000 edges, so the refinement step was not needed. In contrast, WatDiv and DBLP could not be effectively partitioned, so we used just one partition type, and we manually selected between one and 64 histogram buckets per predicate. The typed summaries were large so we further refined them using <em>m</em> = 20, <em>n</em> = 2, and <em>target</em> of 45,000 for WatDiv and 30,000 for DBLP. Table&#x00A0;<a class="tbl" href="#tab1">1</a> shows that each graph was compressed by a factor more than 1,000.</p>    </section>    <section id="sec-17">    <header>     <div class="title-info">      <h3>       <span class="section-number">6.3</span> Comparison Systems</h3>     </div>    </header>    <p>We evaluated our system against a portfolio of the following four systems, which represent the state of the art in open-source and commercial (RDF) data management.</p>    <p>     <font style="font-variant: small-caps">      <strong>RDF-3X</strong>     </font> [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0031">31</a>] v0.3.7 is a state of the art RDF system whose cardinality estimator was specifically tailored to RDF and was shown to outperform the related approaches.</p>    <p>     <font style="font-variant: small-caps">      <strong>C-SET</strong>     </font> is the <em>characteristic sets</em> technique [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0030">30</a>] that specifically targets RDF and pays particular attention to star queries. There is no publicly available implementation of this technique, so we reimplemented it ourselves. It was shown to outperform the approach by Stocker et&#x00A0;al. [<a class="bib" data-trigger="hover" data-toggle="popover" data-placement="top"      href="#BibPLXBIB0037">37</a>], so we did not test the latter separately.</p>    <p>     <strong>PostgreSQL</strong> v9.4.5 uses a conventional cardinality estimator with one-dimensional histograms. Statistics collection was automatic.</p>    <p>     <strong>SystemX</strong> is a commercial RDBMS.<a class="fn" href="#fn2" id="foot-fn2"><sup>2</sup></a> Its highly tuned cardinality estimator operates in two modes: in the <em>static mode</em> the system uses statistics collected automatically prior to estimation, and in the <em>dynamic mode</em> it can sample the data during estimation if the estimate accuracy is low. We used the maximum sampling level.</p>    <p>To store RDF data into RDBMSs, we replaced all resources with unique integers, and then we considered two storage modes. First, we stored all triples in one ternary <em>triple table</em>, so all queries amount to self-joins over this table. Second, we <em>vertically partitioned</em> the data by storing &#x27E8;<em>s</em>, <em>rdf:type</em>, <em>o</em>&#x27E9; as tuple &#x27E8;<em>s</em>&#x27E9; in a unary relation <em>o</em>, and &#x27E8;<em>s</em>, <em>p</em>, <em>o</em>&#x27E9; with <em>p</em> &#x2260; <em>rdf:type</em> as tuple &#x27E8;<em>s</em>, <em>o</em>&#x27E9; in a binary relation <em>p</em>. Using multiple tables generally allows for more accurate statistics collection. We thus obtained a total of eight comparison systems: <font style="font-variant: small-caps">RDF-3X</font>, <font style="font-variant: small-caps">C-SET</font>, two (<font style="font-variant: small-caps">P-T</font> and <font style="font-variant: small-caps">P-V</font>) PostgreSQL variants, and two static (<font style="font-variant: small-caps">XS-T</font> and <font style="font-variant: small-caps">XS-V</font>) and two dynamic (<font style="font-variant: small-caps">XD-T</font> and <font style="font-variant: small-caps">XD-V</font>) SystemX variants. For systems other than <font style="font-variant: small-caps">C-SET</font>, we obtained their cardinality estimates using their <tt>EXPLAIN</tt> facility.</p>    </section>    <section id="sec-18">    <header>     <div class="title-info">      <h3>       <span class="section-number">6.4</span> Accuracy Experiments</h3>     </div>    </header>    <p>Figure&#x00A0;<a class="fig" href="#fig2">2</a> shows the q-error distribution per dataset and system, thus summarising the results of our accuracy experiments on all 156 test queries. Each bar chart shows the percentages of the queries with q-error in the intervals from the legend. Each box plot groups the q-errors per system: the box shows the lower and upper quartiles of the q-error, the line dividing the box shows the median, the line whiskers show the minimum and maximum, and the diamond mark shows the average. Please note that the maximum q-errors sometimes fall beyond the shown portion of the <em>y</em> axis.</p>    <p>As one can see from the figure, <font style="font-variant: small-caps">SumRDF</font> outperforms the other systems by several orders of magnitude on LUBM and WatDiv. On DBLP, it exhibits the best maximum and average q-errors, and SystemX with dynamic sampling is the only system that provides comparable performance. We conjecture the latter to be due to selections in queries: if a query contains a resource that has not been captured accurately using histograms, more accurate statistics are obtained on demand. Overall, our technique considerably improves the state of the art in cardinality estimation of RDF queries.</p>    <p>We noticed no pattern in the systems&#x2019; behaviour on queries with q-error above 10: each system undershoots on some, but overshoots on other queries. Different variants of the same system often differ greatly on the same query; for example, <font style="font-variant: small-caps">P-T</font> might overshoot while <font style="font-variant: small-caps">P-V</font> would undershoot, and similarly for SystemX. Also, for each dataset and system, there is a query where the system is most accurate, but <font style="font-variant: small-caps">SumRDF</font> is never the least accurate.</p>    <p>Atoms of the form &#x27E8;<em>x</em>, <em>rdf:type</em>, <em>C</em>&#x27E9;, whose presence in the query does not affect the query answers, were a common source of estimation errors. In <font style="font-variant: small-caps">C-SET</font>, <font style="font-variant: small-caps">P-T</font>, and <font style="font-variant: small-caps">XS-T</font>, such atoms impose a selection on the <em>rdf:type</em> property that is combined using independence assumption, which usually leads to a significant underestimation.</p>    <p>We further analysed <em>difficult queries</em>, where <font style="font-variant: small-caps">SumRDF</font> exhibited a q-error above 10. Five queries of LUBM have q-errors between 750 and 1,000; three are triangular and two are cyclic. Nine queries of WatDiv have q-error between 10 to 20, and all of these contain one or two selections. Finally, on DBLP, three queries have q-errors between 10 and 20, and additional five have q-errors above 20; all are either cyclic or have up to three selections. Thus, queries containing cycles and/or selections are sometimes hard for <font style="font-variant: small-caps">SumRDF</font>. However, most systems exhibited a q-error above 10 on these queries as well. SystemX with dynamic sampling performed better on acyclic queries with selections: the system would additionally sample whenever the statistics were insufficiently precise.</p>    </section>    <section id="sec-19">    <header>     <div class="title-info">      <h3>       <span class="section-number">6.5</span> Impact of <em>&#x03BC;</em>-Unification</h3>     </div>    </header>    <div class="table-responsive" id="tab3">     <div class="table-caption">      <span class="table-number">Table 3:</span>      <span class="table-title">The q-error for <em>&#x03BC;</em>-unifiable queries.</span>     </div>     <table class="table">      <thead>       <tr>       <th style="text-align:right;"/>       <th style="text-align:center;">ID</th>       <th style="text-align:center;">Eq. (<a class="eqn" href="#eq1">1</a>)</th>       <th style="text-align:center;">        <font style="font-variant: small-caps">SumRDF</font>        </th>       <th style="text-align:center;">        <font style="font-variant: small-caps">RDF-3X</font>        </th>       <th style="text-align:center;">        <font style="font-variant: small-caps">C-SET</font>        </th>       <th style="text-align:center;">        <font style="font-variant: small-caps">P-T</font>        </th>       <th style="text-align:center;">        <font style="font-variant: small-caps">P-V</font>        </th>       <th style="text-align:center;">        <font style="font-variant: small-caps">XS-T</font>        </th>       <th style="text-align:center;">        <font style="font-variant: small-caps">XS-V</font>        </th>       <th style="text-align:center;">        <font style="font-variant: small-caps">XD-T</font>        </th>       <th style="text-align:center;">        <font style="font-variant: small-caps">XD-V</font>        </th>       </tr>     </thead>     <tbody>       <tr>       <td style="text-align:right;">LUBM</td>       <td style="text-align:right;">U1</td>       <td style="text-align:right;">1.4&#x00A0;k</td>       <td style="text-align:right;">769.8</td>       <td style="text-align:right;">71.3&#x00A0;</td>       <td style="text-align:right;">205.2&#x00A0;k</td>       <td style="text-align:right;">3.5&#x00A0;T</td>       <td style="text-align:right;">122.5&#x00A0;</td>       <td style="text-align:right;">26.3&#x00A0;G</td>       <td style="text-align:right;">2.6&#x00A0;k</td>       <td style="text-align:right;">17.5&#x00A0;k</td>       <td style="text-align:right;">3.4&#x00A0;k</td>       </tr>       <tr>       <td style="text-align:right;"/>       <td style="text-align:right;">U2</td>       <td style="text-align:right;">111.0&#x00A0;k</td>       <td style="text-align:right;">926.3</td>       <td style="text-align:right;">111.0&#x00A0;k</td>       <td style="text-align:right;">111.0&#x00A0;k</td>       <td style="text-align:right;">7.9&#x00A0;T</td>       <td style="text-align:right;">111.0&#x00A0;k</td>       <td style="text-align:right;">12.3&#x00A0;M</td>       <td style="text-align:right;">111.0&#x00A0;k</td>       <td style="text-align:right;">982.0&#x00A0;</td>       <td style="text-align:right;">111.0&#x00A0;k</td>       </tr>       <tr>       <td style="text-align:right;"/>       <td style="text-align:right;">U3</td>       <td style="text-align:right;">1.1&#x00A0;</td>       <td style="text-align:right;">1.4</td>       <td style="text-align:right;">254.5&#x00A0;</td>       <td style="text-align:right;">67.5&#x00A0;k</td>       <td style="text-align:right;">25&#x00A0;G</td>       <td style="text-align:right;">2.7&#x00A0;</td>       <td style="text-align:right;">87.3&#x00A0;M</td>       <td style="text-align:right;">1.2&#x00A0;</td>       <td style="text-align:right;">4.8&#x00A0;k</td>       <td style="text-align:right;">1.0&#x00A0;</td>       </tr>       <tr>       <td style="text-align:right;"/>       <td style="text-align:right;">U4</td>       <td style="text-align:right;">1.2&#x00A0;</td>       <td style="text-align:right;">1.8</td>       <td style="text-align:right;">455.4&#x00A0;</td>       <td style="text-align:right;">763.9&#x00A0;k</td>       <td style="text-align:right;">650&#x00A0;G</td>       <td style="text-align:right;">9.8&#x00A0;</td>       <td style="text-align:right;">49.2&#x00A0;M</td>       <td style="text-align:right;">1.1&#x00A0;</td>       <td style="text-align:right;">2.7&#x00A0;k</td>       <td style="text-align:right;">1.2&#x00A0;</td>       </tr>       <tr>       <td style="text-align:right;"/>       <td style="text-align:right;">U5</td>       <td style="text-align:right;">1.1&#x00A0;</td>       <td style="text-align:right;">1.0</td>       <td style="text-align:right;">5.9&#x00A0;</td>       <td style="text-align:right;">1.3&#x00A0;</td>       <td style="text-align:right;">11.2&#x00A0;k</td>       <td style="text-align:right;">1.6&#x00A0;</td>       <td style="text-align:right;">10.2&#x00A0;k</td>       <td style="text-align:right;">1.5&#x00A0;</td>       <td style="text-align:right;">12.2&#x00A0;k</td>       <td style="text-align:right;">1.5&#x00A0;</td>       </tr>       <tr>       <td style="text-align:right;">DBLP</td>       <td style="text-align:right;">D1</td>       <td style="text-align:right;">1.2&#x00A0;</td>       <td style="text-align:right;">1.2</td>       <td style="text-align:right;">9.9&#x00A0;k</td>       <td style="text-align:right;">440.8&#x00A0;k</td>       <td style="text-align:right;">106.3&#x00A0;</td>       <td style="text-align:right;">3.4&#x00A0;</td>       <td style="text-align:right;">220.4&#x00A0;k</td>       <td style="text-align:right;">1.4&#x00A0;</td>       <td style="text-align:right;">2.8&#x00A0;</td>       <td style="text-align:right;">2.8&#x00A0;</td>       </tr>       <tr>       <td style="text-align:right;"/>       <td style="text-align:right;">D2</td>       <td style="text-align:right;">2.1&#x00A0;</td>       <td style="text-align:right;">2.1</td>       <td style="text-align:right;">1.0&#x00A0;M</td>       <td style="text-align:right;">1.0&#x00A0;M</td>       <td style="text-align:right;">23.2&#x00A0;k</td>       <td style="text-align:right;">40.0&#x00A0;</td>       <td style="text-align:right;">1.0&#x00A0;M</td>       <td style="text-align:right;">8.8&#x00A0;</td>       <td style="text-align:right;">15.2&#x00A0;</td>       <td style="text-align:right;">3.2&#x00A0;</td>       </tr>       <tr>       <td style="text-align:right;"/>       <td style="text-align:right;">D3</td>       <td style="text-align:right;">238.0&#x00A0;</td>       <td style="text-align:right;">19.9</td>       <td style="text-align:right;">11.9&#x00A0;k</td>       <td style="text-align:right;">238.0&#x00A0;</td>       <td style="text-align:right;">45.4&#x00A0;</td>       <td style="text-align:right;">238.0&#x00A0;</td>       <td style="text-align:right;">238.0&#x00A0;</td>       <td style="text-align:right;">238.0&#x00A0;</td>       <td style="text-align:right;">79.3&#x00A0;</td>       <td style="text-align:right;">238.0&#x00A0;</td>       </tr>       <tr>       <td style="text-align:right;"/>       <td style="text-align:right;">D4</td>       <td style="text-align:right;">320.2&#x00A0;</td>       <td style="text-align:right;">320.2</td>       <td style="text-align:right;">3.9&#x00A0;k</td>       <td style="text-align:right;">29.7&#x00A0;k</td>       <td style="text-align:right;">432.1&#x00A0;</td>       <td style="text-align:right;">1.0&#x00A0;k</td>       <td style="text-align:right;">213.5&#x00A0;k</td>       <td style="text-align:right;">5.5&#x00A0;k</td>       <td style="text-align:right;">6.3&#x00A0;k</td>       <td style="text-align:right;">55.8&#x00A0;</td>       </tr>       <tr>       <td style="text-align:right;"/>       <td style="text-align:right;">D5</td>       <td style="text-align:right;">721.3&#x00A0;</td>       <td style="text-align:right;">721.3</td>       <td style="text-align:right;">313.3&#x00A0;</td>       <td style="text-align:right;">4.1&#x00A0;k</td>       <td style="text-align:right;">3.9&#x00A0;</td>       <td style="text-align:right;">344.4&#x00A0;</td>       <td style="text-align:right;">4.1&#x00A0;k</td>       <td style="text-align:right;">4.1&#x00A0;k</td>       <td style="text-align:right;">2.0&#x00A0;</td>       <td style="text-align:right;">4.1&#x00A0;k</td>       </tr>       <tr>       <td style="text-align:right;"/>       <td style="text-align:right;">D6</td>       <td style="text-align:right;">57.0&#x00A0;</td>       <td style="text-align:right;">57.0</td>       <td style="text-align:right;">57.0&#x00A0;</td>       <td style="text-align:right;">57.0&#x00A0;</td>       <td style="text-align:right;">2.7&#x00A0;</td>       <td style="text-align:right;">57.0&#x00A0;</td>       <td style="text-align:right;">57.0&#x00A0;</td>       <td style="text-align:right;">57.0&#x00A0;</td>       <td style="text-align:right;">57.0&#x00A0;</td>       <td style="text-align:right;">57.0&#x00A0;</td>       </tr>       <tr>       <td style="text-align:right;"/>       <td style="text-align:right;">D7</td>       <td style="text-align:right;">210.3&#x00A0;</td>       <td style="text-align:right;">210.3</td>       <td style="text-align:right;">10.1&#x00A0;k</td>       <td style="text-align:right;">10.1&#x00A0;k</td>       <td style="text-align:right;">10.1&#x00A0;k</td>       <td style="text-align:right;">561.3&#x00A0;</td>       <td style="text-align:right;">10.1&#x00A0;k</td>       <td style="text-align:right;">76.5&#x00A0;</td>       <td style="text-align:right;">10.1&#x00A0;k</td>       <td style="text-align:right;">8.2&#x00A0;</td>       </tr>       <tr>       <td style="text-align:right;"/>       <td style="text-align:right;">D8</td>       <td style="text-align:right;">817.0&#x00A0;</td>       <td style="text-align:right;">817.0</td>       <td style="text-align:right;">817.0&#x00A0;</td>       <td style="text-align:right;">817.0&#x00A0;</td>       <td style="text-align:right;">38.9&#x00A0;</td>       <td style="text-align:right;">817.0&#x00A0;</td>       <td style="text-align:right;">817.0&#x00A0;</td>       <td style="text-align:right;">817.0&#x00A0;</td>       <td style="text-align:right;">817.0&#x00A0;</td>       <td style="text-align:right;">817.0&#x00A0;</td>       </tr>       <tr>       <td colspan="2" style="text-align:center;">min       </td>       <td style="text-align:right;">1.1&#x00A0;</td>       <td style="text-align:right;">1.0</td>       <td style="text-align:right;">5.9&#x00A0;</td>       <td style="text-align:right;">1.3&#x00A0;</td>       <td style="text-align:right;">2.7&#x00A0;</td>       <td style="text-align:right;">1.6&#x00A0;</td>       <td style="text-align:right;">57.0&#x00A0;</td>       <td style="text-align:right;">1.1&#x00A0;</td>       <td style="text-align:right;">2.0&#x00A0;</td>       <td style="text-align:right;">1.0&#x00A0;</td>       </tr>       <tr>       <td colspan="2" style="text-align:center;">med       </td>       <td style="text-align:right;">210.3&#x00A0;</td>       <td style="text-align:right;">57.0</td>       <td style="text-align:right;">817.0&#x00A0;</td>       <td style="text-align:right;">29.7&#x00A0;k</td>       <td style="text-align:right;">10.1&#x00A0;k</td>       <td style="text-align:right;">122.5&#x00A0;</td>       <td style="text-align:right;">213.5&#x00A0;k</td>       <td style="text-align:right;">76.6&#x00A0;</td>       <td style="text-align:right;">982.1&#x00A0;</td>       <td style="text-align:right;">55.8&#x00A0;</td>       </tr>       <tr>       <td colspan="2" style="text-align:center;">avg       </td>       <td style="text-align:right;">8.8&#x00A0;k</td>       <td style="text-align:right;">296.1</td>       <td style="text-align:right;">90.1&#x00A0;k</td>       <td style="text-align:right;">204.3&#x00A0;k</td>       <td style="text-align:right;">940.8&#x00A0;G</td>       <td style="text-align:right;">8.8&#x00A0;k</td>       <td style="text-align:right;">31.8&#x00A0;M</td>       <td style="text-align:right;">9.5&#x00A0;k</td>       <td style="text-align:right;">4.3&#x00A0;k</td>       <td style="text-align:right;">9.2&#x00A0;k</td>       </tr>       <tr>       <td colspan="2" style="text-align:center;">max       </td>       <td style="text-align:right;">111.0&#x00A0;k</td>       <td style="text-align:right;">926.2</td>       <td style="text-align:right;">1.0&#x00A0;M</td>       <td style="text-align:right;">1.0&#x00A0;M</td>       <td style="text-align:right;">7.9&#x00A0;T</td>       <td style="text-align:right;">111.0&#x00A0;k</td>       <td style="text-align:right;">263.4&#x00A0;M</td>       <td style="text-align:right;">111.0&#x00A0;k</td>       <td style="text-align:right;">17.6&#x00A0;k</td>       <td style="text-align:right;">111.0&#x00A0;k</td>       </tr>      </tbody>     </table>    </div>    <p>Formula (<a class="eqn" href="#eq1">1</a>) for <em>&#x03BC;</em>-unification-free queries does not require computing the partition base for the query, so the formula should be easier to evaluate than the general formula from Theorem&#x00A0;<a class="enc" href="#enc8">4.3</a>. Hence, we investigated whether using the general formula improves estimation accuracy. Table&#x00A0;<a class="tbl" href="#tab3">3</a> compares the q-error of the estimate computed using formula (<a class="eqn" href="#eq1">1</a>) with the q-errors of all other systems (including <font style="font-variant: small-caps">SumRDF</font>) for all <em>&#x03BC;</em>-unifiable queries. WatDiv does not occur in the table since all of its queries are <em>&#x03BC;</em>-unification-free.</p>    <p>As one can see, <em>&#x03BC;</em>-unifiable queries tend to be difficult: for each query, at least one system exhibits a q-error above 900. However, handling <em>&#x03BC;</em>-unifiable queries correctly reduces the maximum error by two orders of magnitude, and it also considerably improves the median and the average. Finally, <font style="font-variant: small-caps">SumRDF</font> considerably outperforms all other systems on all aggregate metrics, apart from the median of <font style="font-variant: small-caps">XD-V</font>, whereas the aggregate metrics of formula (<a class="eqn" href="#eq1">1</a>) seem similar to <font style="font-variant: small-caps">P-V</font>. Thus, our principled approach to <em>&#x03BC;</em>-unifiable queries contributes substantially to estimation accuracy.</p>    </section>    <section id="sec-20">    <header>     <div class="title-info">      <h3>       <span class="section-number">6.6</span> Probabilistic Error Bounds</h3>     </div>    </header>    <p>For &#x025B; equal to 10, 100, and 1,000, Table&#x00A0;<a class="tbl" href="#tab2">2</a> shows the bound on the probability of q-error exceeding &#x025B; computed as stated in Theorem&#x00A0;<a class="enc" href="#enc5">3.5</a>. The probabilities (expressed as percentages) are grouped into five intervals. Each table cell shows the number of queries in the interval, and in parentheses the number of queries where the q-error indeed exceeds &#x025B;. For example, on LUBM, there are 20 queries for which the probability of q-error being larger than 10 is less than 1%, and for two of these the q-error is larger than 10.</p>    <p>We could not compute <em>&#x03C3;</em>     <sub>      <em>q</em>, <em>S</em>     </sub> in several cases: query <em>q</em>&#x222A;<em>&#x03C1;</em>(<em>q</em>) from Theorem&#x00A0;<a class="enc" href="#enc9">4.4</a> is always <em>&#x03BC;</em>-unifiable and tends to be very complex. Moreover, Theorem&#x00A0;<a class="enc" href="#enc5">3.5</a> does not apply to queries with <em>E</em>     <sub>      <em>q</em>, <em>S</em>     </sub> < 1. The numbers in parentheses next to each dataset name show the number of queries on which we could compute <span class="inline-equation"><span class="tex">$\mathsf {P}\left(e\ge \varepsilon \right)$</span>     </span>.</p>    <p>Already for &#x025B; = 10, we can correctly bound with 99% certainty the estimates for 18 out of 29 LUBM queries, 15 out of 48 WatDiv queries, and two out of three DBLP queries. With &#x025B; = 100, we cover 75% of LUBM, 87% of WatDiv, and all of the DBLP queries. These results suggest that the confidence bounds provided by Theorem&#x00A0;<a class="enc" href="#enc5">3.5</a> are indeed very useful. In our future work, we shall incorporate them into query planning algorithms so that a planner can prefer plans with higher confidence cardinality estimates.</p>    </section>   </section>   <section id="sec-21">    <header>    <div class="title-info">     <h2>      <span class="section-number">7</span> Conclusion and Outlook</h2>    </div>    </header>    <p>We presented a new approach for estimating the cardinality of CQs on RDF graphs. Our approach is based on graph summarisation and it formalises the estimation problem based on a precise &#x2018;possible worlds&#x2019; semantics. Our technique can also provide statistical confidence for an estimate, even for arbitrarily shaped, complex CQs. Finally, we showed experimentally that our approach outperforms state of the art RDF and relational cardinality estimators.</p>    <p>We see many exciting opportunities for future work. On the theoretical side, supporting range queries should be easy, but adding <tt>DISTINCT</tt> and aggregation is likely to be more involved. We shall also try to incorporate further information about the data and thus reduce the number of graphs represented by a summary. On the practical side, we shall further analyse the sources of errors and develop ways of computing more precise summaries, possibly by incorporating variants of dynamic sampling. We shall also investigate how to update the summary without recomputing it from scratch when the underlying graph is updated.</p>   </section>  </section>  <section class="back-matter">   <section id="sec-22">    <header>    <div class="title-info">     <h2>ACKNOWLEDGMENTS</h2>    </div>    </header>    <p>The research presented in this paper was supported by the EPSRC EPSRC <a href="http://www.epsrc.ac.uk/" target="_blank">http://www.epsrc.ac.uk/</a> projects MaSI<sup>3</sup> (EP/P025943/1 EPSRC), DBOnto (EP/L012138/1 EPSRC), and ED<sup>3</sup> (EP/N014359/1 EPSRC).</p>   </section>   <Appendix>    <section id="sec-23">    <header>     <div class="title-info">      <h2>       <span class="section-number">A</span> Proof for Section 3</h2>     </div>    </header>    <p>In this appendix, we prove Proposition <a class="enc" href="#enc3">3.3</a> and Theorem <a class="enc" href="#enc5">3.5</a>.</p>    <section id="sec-24">     <header>      <div class="title-info">       <h3>       <span class="section-number">A.1</span> Proof of Proposition <a class="enc" href="#enc3">3.3</a>       </h3>      </div>     </header>     <p>To prove Proposition <a class="enc" href="#enc3">3.3</a>, we start by defining the inverse of the summarisation function <em>&#x03BC;</em> in a summary <em>S</em> = &#x27E8;<em>H</em>, <em>w</em>, <em>&#x03BC;</em>&#x27E9;.</p>     <div class="definition" id="enc12">      <Label>Definition A.1.</Label>      <p>       <em>For <em>S</em> = &#x27E8;<em>H</em>, <em>w</em>, <em>&#x03BC;</em>&#x27E9; a summary, the</em> inverse function<em>       <em>&#x03BC;</em>       <sup>&#x2212;</sup> of <em>&#x03BC;</em> maps each bucket </em>       <span class="inline-equation"><span class="tex">${b \in \mathsf {res}(H)}$</span>       </span>       <em> and each triple <em>h</em> &#x2208; <em>H</em> as follows:</em>       <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{align*} \mu ^{-}(b) &#x0026; = \lbrace d\in \mathsf {dom}(\mu) \mid \mu (d) = b \rbrace ,\\\mu ^{-}(h) &#x0026; = \lbrace f\in \mathsf {dom}(\mu) \times \mathsf {dom}(\mu) \times \mathsf {dom}(\mu) \mid \mu (f) = h \rbrace .\end{align*} </span>        <br/>       </div>       </div>      </p>     </div>     <p>Please note that, by Definition <a class="enc" href="#enc1">3.1</a> of size <em>s</em>[ &#x00B7; ], we have that <em>s</em>[<em>b</em>] = |<em>&#x03BC;</em>      <sup>&#x2212;</sup>(<em>b</em>)| and <em>s</em>[<em>h</em>] = |<em>&#x03BC;</em>      <sup>&#x2212;</sup>(<em>h</em>)|, for each <span class="inline-equation"><span class="tex">$b \in \mathsf {res}(H)$</span>      </span> and each <em>h</em> &#x2208; <em>H</em>. The next lemma shows that the consistency of a summary can be determined as described in Proposition <a class="enc" href="#enc3">3.3</a>; in addition, it shows how to count the number of graphs represented by a consistent summary.</p>     <div class="lemma" id="enc13">      <Label>Lemma A.2.</Label>      <p> For <em>S</em> = &#x27E8;<em>H</em>, <em>w</em>, <em>&#x03BC;</em>&#x27E9; a summary, <em>S</em> is consistent if and only if <em>w</em>[<em>h</em>] &#x2264; <em>s</em>[<em>h</em>] for each <em>h</em> &#x2208; <em>H</em>. Furthermore, when <em>S</em> is consistent, the following holds: <div class="table-responsive" id="eq2">       <div class="display-equation">        <span class="tex mytex">\begin{equation} |R_S| = \prod _{h\in H} \binom{s[h]}{w[h]}. \end{equation} </span>        <br/>        <span class="equation-number">(2)</span>       </div>       </div>      </p>     </div>     <div class="proof" id="proof1">      <Label>Proof.</Label>      <p> Let <em>S</em> = &#x27E8;<em>H</em>, <em>w</em>, <em>&#x03BC;</em>&#x27E9; be a summary. Then, by Definition <a class="enc" href="#enc2">3.2</a> of a graph represented by <em>S</em> and by Definition <a class="enc" href="#enc12">A.1</a> of <em>&#x03BC;</em>       <sup>&#x2212;</sup>, for each graph <em>G</em>, we have that <em>G</em> &#x2208; <em>R<sub>S</sub>       </em> if and only if</p>      <p>       <ol class="list-no-style">       <li id="list1" label="(a)"> <span class="inline-equation"><span class="tex">$G\subseteq \bigcup _{h\in H} \mu ^{-}(h)$</span>        </span>, and<br/></li>       <li id="list2" label="(b)"><em>w</em>[<em>h</em>] = |<em>&#x03BC;</em>        <sup>&#x2212;</sup>(<em>h</em>)&#x2229;<em>G</em>| for each <em>h</em> &#x2208; <em>H</em>.<br/></li>       </ol>      </p>      <p>We next show that <em>S</em> is consistent if and only if <em>w</em>[<em>h</em>] &#x2264; <em>s</em>[<em>h</em>] for each <em>h</em> &#x2208; <em>H</em>.</p>      <p>(&#x21D2;)&#x2009; Assume that <em>S</em> is consistent, and so <em>R<sub>S</sub>       </em> &#x2260; &#x2205;. Consider an arbitrary RDF graph <em>G</em> &#x2208; <em>R<sub>S</sub>       </em> and an arbitrary triple <em>h</em> &#x2208; <em>H</em>. Then, <em>w</em>[<em>h</em>] is the number of triples in <em>&#x03BC;</em>       <sup>&#x2212;</sup>(<em>h</em>) that occur in <em>G</em>. Since <em>s</em>[<em>h</em>] = |<em>&#x03BC;</em>       <sup>&#x2212;</sup>(<em>h</em>)|, we have that <em>w</em>[<em>h</em>] &#x2264; <em>s</em>[<em>h</em>].</p>      <p>(&#x21D0;) Assume that <em>w</em>[<em>h</em>] &#x2264; <em>s</em>[<em>h</em>] for each <em>h</em> &#x2208; <em>H</em>. Then, for each <em>h</em> &#x2208; <em>H</em>, let <em>G<sub>h</sub>       </em> be an arbitrary, but fixed subset of <em>&#x03BC;</em>       <sup>&#x2212;</sup>(<em>h</em>) of size <em>w</em>[<em>h</em>]; since <em>w</em>[<em>h</em>] &#x2264; <em>s</em>[<em>h</em>], such <em>G<sub>h</sub>       </em> exists. Finally, let <span class="inline-equation"><span class="tex">$G = \bigcup _{h\in H} G_{h}$</span>       </span>. By properties <a class="lst" href="#list1">(a)</a> and <a class="lst" href="#list2">(b)</a>, we have that <em>G</em> &#x2208; <em>R<sub>S</sub>       </em>.</p>      <p>Therefore, <em>S</em> is consistent if and only if <em>w</em>[<em>h</em>] &#x2264; <em>s</em>[<em>h</em>] for each <em>h</em> &#x2208; <em>H</em>. To conclude the proof, we assume that <em>S</em> is consistent and show that Equation (<a class="eqn" href="#eq2">2</a>) holds. By properties <a class="lst" href="#list1">(a)</a> and <a class="lst" href="#list2">(b)</a>, each graph <em>G</em> &#x2208; <em>R<sub>S</sub>       </em> can be generated by independently choosing, for each triple <em>h</em> &#x2208; <em>H</em>, a set <em>G<sub>h</sub>       </em> of atoms of size <em>w</em>[<em>h</em>] such that <em>G<sub>h</sub>       </em>&#x2286;<em>&#x03BC;</em>       <sup>&#x2212;</sup>(<em>h</em>). For each <em>h</em> &#x2208; <em>H</em>, there are precisely <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} \binom{s[h]}{w[h]}\end{eqnarray*} </span>        <br/>       </div>       </div> distinct such sets <em>G<sub>h</sub>       </em>. So, we can count the total number of RDF graphs in <em>R<sub>S</sub>       </em> as shown in Equation (<a class="eqn" href="#eq2">2</a>).</p>     </div>    </section>    <section id="sec-25">     <header>      <div class="title-info">       <h3>       <span class="section-number">A.2</span> Proof of Theorem <a class="enc" href="#enc5">3.5</a>       </h3>      </div>     </header>    <p>    <div class="theorem" id="enc5">     <Label>Theorem 3.5.</Label>     <p> Let <em>q</em> be a CQ and let <em>S</em> be a summary such that <em>E</em>      <sub>       <em>q</em>, <em>S</em>      </sub> &#x2265; 1. Then, for each &#x025B; > 1 and for <em>e</em> the q-error of estimating the cardinality of <em>q</em> as <em>E</em>      <sub>       <em>q</em>, <em>S</em>      </sub>, we have <div class="table-responsive">       <div class="display-equation">       <span class="tex mytex">\begin{eqnarray*} \mathsf {P}\left(e\ge \varepsilon \right) \le \left(\frac{\varepsilon \cdot \sigma _{q, S}}{(\varepsilon - 1) \cdot E_{q, S}}\right)^2.\end{eqnarray*} </span>       <br/>       </div>      </div> If &#x025B; &#x2265; <em>E</em>      <sub>       <em>q</em>, <em>S</em>      </sub> holds additionally, then the numerator &#x025B; &#x00B7; <em>&#x03C3;</em>      <sub>       <em>q</em>, <em>S</em>      </sub> on the right-hand side of the inequality can be replaced with <em>&#x03C3;</em>      <sub>       <em>q</em>, <em>S</em>      </sub>.</p>    </div>    </p>     <div class="proof" id="proof2">      <Label>Proof.</Label>      <p> First, note that since &#x025B; > 1, <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\[ \frac{\varepsilon \cdot \sigma _{q, S}}{(\varepsilon - 1) \cdot E_{q, S}} {\gt} \frac{\sigma _{q, S}}{(\varepsilon - 1) \cdot E_{q, S}}, \] </span>        <br/>       </div>       </div> so the additional inequality implies the main one. Therefore, it is enough to prove the first bound for the case when <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub> > &#x025B; > 1 and the second bound for the case when &#x025B; &#x2265; <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub> &#x2265; 1. We do this in the rest of the proof.</p>      <p>Let <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub> > &#x025B; > 1. The inequality <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} e= \max \left(\frac{ \max (|[[ q ]] _{G}|, 1)}{\max (E_{q, S}, 1)}, \frac{\max (E_{q, S}, 1)}{ \max (|[[ q ]] _{G}|, 1)}\right) {\lt} \varepsilon\end{eqnarray*} </span>        <br/>       </div>       </div> is equivalent to <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\[ \frac{\max (E_{q, S}, 1)}{\varepsilon } {\lt} \max (|[[ q ]] _{G}|, 1) {\lt} \varepsilon \cdot \max (E_{q, S}, 1) \] </span>        <br/>       </div>       </div> and, since <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub> > &#x025B; > 1, to <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\[ \frac{E_{q, S}}{\varepsilon } {\lt} |[[ q ]] _{G}| {\lt} \varepsilon \cdot E_{q, S}. \] </span>        <br/>       </div>       </div> Therefore, since &#x025B; &#x00B7; <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub> &#x2212; <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub> > <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub> &#x2212; <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub>/&#x025B;, <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{multline*} \mathsf {P}\left(e{\lt} \varepsilon \right) = \mathsf {P}\left(\frac{E_{q, S}}{\varepsilon } {\lt} |[[ q ]] _{G}| {\lt} \varepsilon \cdot E_{q, S} \right) = \mathsf {P}\left(\frac{E_{q, S}}{\varepsilon } - E_{q, S} {\lt} |[[ q ]] _{G}| - E_{q, S} {\lt} \varepsilon \cdot E_{q, S} - E_{q, S}\right) {\gt} {} \\ \mathsf {P}\left(\frac{E_{q, S}}{\varepsilon } - E_{q, S} {\lt} |[[ q ]] _{G}| - E_{q, S} {\lt} E_{q, S} - \frac{E_{q, S}}{\varepsilon }\right) = \mathsf {P}\left(\left| |[[ q ]] _{G}| - E_{q, S} \right| {\lt} E_{q, S} - \frac{E_{q, S}}{\varepsilon }\right) = \mathsf {P}\left(\left| |[[ q ]] _{G}| - E_{q, S} \right| {\lt} \frac{(\varepsilon - 1) \cdot E_{q, S}}{\varepsilon }\right) {\gt} \\ 1 - \left(\frac{\varepsilon \cdot \sigma _{q, S}}{(\varepsilon - 1) \cdot E_{q, S}}\right)^2.\end{multline*} </span>        <br/>       </div>       </div> The last step follows from Chebyshev&#x0027;s inequality <span class="inline-equation"><span class="tex">${\mathsf {P}\left(\big | |[[ q ]] _{G}| - E_{q, S}\big | \ge k \cdot \sigma _{q, S}\right) \le \frac{1}{k^2}}$</span>       </span> for <span class="inline-equation"><span class="tex">$k = \frac{(\varepsilon - 1) \cdot E_{q, S}}{\varepsilon \cdot \sigma _{q, S}}$</span>       </span>. This immediately implies the required bound <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\[ {\mathsf {P}\left(e\ge \varepsilon \right) \le \left(\frac{\varepsilon \cdot \sigma _{q, S}}{(\varepsilon - 1) \cdot E_{q, S}}\right)^2}. \] </span>        <br/>       </div>       </div>      </p>      <p>Let now &#x025B; &#x2265; <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub> &#x2265; 1. The inequality <em>e</em> < &#x025B; is again equivalent to <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\[ \frac{\max (E_{q, S}, 1)}{\varepsilon } {\lt} \max (|[[ q ]] _{G}|, 1) {\lt} \varepsilon \cdot \max (E_{q, S}, 1) \] </span>        <br/>       </div>       </div> and, since &#x025B; &#x2265; <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub> &#x2265; 1, to <span class="inline-equation"><span class="tex">$|[[ q ]] _{G}| {\lt} \varepsilon \cdot E_{q, S}$</span>       </span>. Therefore, <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{multline*} \mathsf {P}\left(e{\lt} \varepsilon \right) = \mathsf {P}\left(|[[ q ]] _{G}| {\lt} \varepsilon \cdot E_{q, S} \right) = \mathsf {P}\left(|[[ q ]] _{G}| - E_{q, S} {\lt} \varepsilon \cdot E_{q, S} - E_{q, S}\right) \ge {} \\ \mathsf {P}\left(E_{q, S} - \varepsilon \cdot E_{q, S} {\lt} |[[ q ]] _{G}| - E_{q, S} {\lt} \varepsilon \cdot E_{q, S} - E_{q, S}\right) = \mathsf {P}\left(\left| |[[ q ]] _{G}| - E_{q, S} \right| {\lt} \varepsilon \cdot E_{q, S} - E_{q, S}\right) = \mathsf {P}\left(\left| |[[ q ]] _{G}| - E_{q, S} \right| {\lt} (\varepsilon - 1) \cdot E_{q, S}\right) {\gt} \\ 1 - \left(\frac{\sigma _{q, S}}{(\varepsilon - 1) \cdot E_{q, S}}\right)^2.\end{multline*} </span>        <br/>       </div>       </div> The last step follows from Chebyshev&#x0027;s inequality for <span class="inline-equation"><span class="tex">$k = \frac{(\varepsilon - 1) \cdot E_{q, S}}{\sigma _{q, S}}$</span>       </span>. This immediately implies the required bound <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\[ {\mathsf {P}\left(e\ge \varepsilon \right) \le \left(\frac{\sigma _{q, S}}{(\varepsilon - 1) \cdot E_{q, S}}\right)^2}. \] </span>        <br/>       </div>       </div> This concludes the proof of the theorem.</p>     </div>    </section>    </section>    <section id="sec-26">    <header>     <div class="title-info">      <h2>       <span class="section-number">B</span> Proofs for Section 4</h2>     </div>    </header>    <p>In this appendix, we prove Theorems <a class="enc" href="#enc8">4.3</a> and <a class="enc" href="#enc9">4.4</a>, and Proposition <a class="enc" href="#enc11">4.6</a>. For the rest of this section, we fix an arbitrary consistent summary <em>S</em> = &#x27E8;<em>H</em>, <em>w</em>, <em>&#x03BC;</em>&#x27E9; and a CQ <em>q</em> such that <span class="inline-equation"><span class="tex">${\mathsf {res}(q) \subseteq \mathsf {dom}(\mu)}$</span>     </span>.</p>    <section id="sec-27">     <header>      <div class="title-info">       <h3>       <span class="section-number">B.1</span> Properties of the Partition Base</h3>      </div>     </header>     <p>We start by formalising the properties of the unifiable partitions of <em>q</em> that were intuitively outlined in Section <a class="sec" href="#sec-8">4.1</a>. To this end, we first define the notion of an expansion w.r.t. a partition <em>P</em> of an answer <em>&#x03C4;</em> to <em>&#x03BC;</em>(<em>q</em>) over <em>H</em>.</p>     <div class="definition" id="enc14">      <Label>Definition B.1.</Label>      <p>       <em>Let <em>&#x03C4;</em> be an answer to <em>&#x03BC;</em>(<em>q</em>) on <em>H</em> and let <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>       </em> be a partition. A substitution <em>&#x03C0;</em> with </em>       <span class="inline-equation"><span class="tex">$\mathsf {dom}(\pi) = \mathsf {var}(q)$</span>       </span>       <em> and </em>       <span class="inline-equation"><span class="tex">$\mathsf {rng}(\pi) \subseteq \mathsf {dom}(\mu)$</span>       </span>       <em> is a &#x03C4;</em>-expansion<em>to <em>P</em> if, for each </em>       <span class="inline-equation"><span class="tex">${x \in \mathsf {var}(q)}$</span>       </span>       <em>,</em>      </p>      <p>       <ol class="list-no-style">       <li id="list3" label="(1)"><em>         <em>&#x03C0;</em>(<em>x</em>) &#x2208; <em>&#x03BC;</em>         <sup>&#x2212;</sup>(<em>&#x03C4;</em>(<em>x</em>)),</em>        <br/></li>       <li id="list4" label="(2)"> <span class="inline-equation"><span class="tex">$\gamma _{P}(x) \in \mathsf {var}(q)$</span>        </span>        <em> implies that <em>&#x03C0;</em>(<em>x</em>) = <em>&#x03C0;</em>(<em>&#x03B3;<sub>P</sub>         </em>(<em>x</em>)),</em>        <br/></li>       <li id="list5" label="(3)"> <span class="inline-equation"><span class="tex">$\gamma _{P}(x) \in \mathsf {res}(q)$</span>        </span>        <em> implies that <em>&#x03C0;</em>(<em>x</em>) = <em>&#x03B3;<sub>P</sub>         </em>(<em>x</em>).</em>        <br/></li>       </ol>      </p>      <p>       <em>Then, </em>       <span class="inline-equation"><span class="tex">$\mathsf {exp}_{\tau }(P)$</span>       </span>       <em> contains each <em>&#x03C4;</em>-expansion to <em>P</em>, and </em>       <span class="inline-equation"><span class="tex">$\mathsf {exp}^{\prec }_{\tau }(P)$</span>       </span>       <em> contains each </em>       <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}_{\tau }(P)}$</span>       </span>       <em> for which no <em>P</em>&#x2032; &#x2208; <em>B<sub>&#x03C4;</sub>       </em> exists such that <em>P</em>&#x227A;<em>P</em>&#x2032; and </em>       <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}_{\tau }(P^{\prime })}$</span>       </span>       <em>.</em>      </p>     </div>     <div class="proposition" id="enc15">      <Label>Proposition B.2.</Label>      <p> For each answer <em>&#x03C4;</em> to <em>&#x03BC;</em>(<em>q</em>) on <em>H</em> and each partition <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>       </em>, the following properties hold:</p>      <p>       <ol class="list-no-style">       <li id="list6" label="(P1)">for each <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}_{\tau }(P)}$</span>        </span>, exactly one partition <em>P</em>&#x2032; &#x2208; <em>B<sub>&#x03C4;</sub>        </em> exists such that <em>P</em>&#x2AAF;<em>P</em>&#x2032; and <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}^{\prec }_{\tau }(P^{\prime })}$</span>        </span>,<br/></li>       <li id="list7" label="(P2)">for each <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}^{\prec }_{\tau }(P)}$</span>        </span> and all atoms <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>q</em>, there exists <em>u</em> &#x2208; <em>P</em> with <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>u</em> if and only if <em>&#x03C0;</em>(<em>a</em>) = <em>&#x03C0;</em>(<em>a</em>&#x2032;).<br/></li>       </ol>      </p>     </div>     <div class="proof" id="proof3">      <Label>Proof.</Label>      <p> For the rest of this proof, we let <em>&#x03C4;</em> be an arbitrary answer to <em>&#x03BC;</em>(<em>q</em>) on <em>H</em>.</p>      <p>       <em>Property <a class="lst" href="#list6">(P1)</a>       </em>&#x00A0;&#x00A0;Since <em>B<sub>&#x03C4;</sub>       </em> is finite and &#x2AAF; is a partial order on <em>B<sub>&#x03C4;</sub>       </em>, for each <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>       </em> and each <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}_{\tau }(P)}$</span>       </span>, there exists a partition <em>P</em>&#x2032; &#x2208; <em>B<sub>&#x03C4;</sub>       </em> such that <em>P</em>&#x2AAF;<em>P</em>&#x2032; and <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}^{\prec }_{\tau }(P^{\prime })}$</span>       </span>. Hence, we next show that <span class="inline-equation"><span class="tex">${\mathsf {exp}^{\prec }_{\tau }(P_1) \cap \mathsf {exp}^{\prec }_{\tau }(P_2) = \emptyset }$</span>       </span> for all distinct partitions <em>P</em>       <sub>1</sub>, <em>P</em>       <sub>2</sub> &#x2208; <em>B<sub>&#x03C4;</sub>       </em>.</p>      <p>Consider two arbitrary distinct partitions <em>P</em>       <sub>1</sub>, <em>P</em>       <sub>2</sub> &#x2208; <em>B<sub>&#x03C4;</sub>       </em>. By the definition of <span class="inline-equation"><span class="tex">$\mathsf {exp}^{\prec }_{\tau }(P_1)$</span>       </span> and <span class="inline-equation"><span class="tex">$\mathsf {exp}^{\prec }_{\tau }(P_2)$</span>       </span>, if <em>P</em>       <sub>1</sub>&#x227A;<em>P</em>       <sub>2</sub> or <em>P</em>       <sub>2</sub>&#x227A;<em>P</em>       <sub>1</sub> holds, we then have <span class="inline-equation"><span class="tex">${\mathsf {exp}^{\prec }_{\tau }(P_1) \cap \mathsf {exp}^{\prec }_{\tau }(P_2) = \emptyset }$</span>       </span>. Thus, in the rest of this proof, we consider the case in which <span class="inline-equation"><span class="tex">${P_1 \not\prec P_2}$</span>       </span> and <span class="inline-equation"><span class="tex">${P_2 \not\prec P_1}$</span>       </span>.</p>      <p>Let &#x2248; be the smallest equivalence relation on (the atoms of) <em>q</em> such that <em>a</em> &#x2248; <em>a</em>&#x2032; for all atoms <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>q</em> such that <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>u</em> for <em>u</em> &#x2208; <em>P<sub>i</sub>       </em> with <em>i</em> &#x2208; [1, 2]. Then, let <em>P</em> be the set of all the equivalence classes of &#x2248; . Since <em>P</em>       <sub>1</sub> and <em>P</em>       <sub>2</sub> are partitions of <em>q</em> and &#x2248; is an equivalence relation on the atoms of <em>q</em>, we have that <em>P</em> is a partition of <em>q</em> as well. By the definition of &#x2248; , for each <em>i</em> &#x2208; [1, 2] and each <em>u</em> &#x2208; <em>P<sub>i</sub>       </em>, there exists an equivalence class of &#x2248; that contains each atom in <em>u</em>; thus, we have that <em>P<sub>i</sub>       </em>&#x2AAF;<em>P</em>. By the initial assumptions, we have that <em>P</em>       <sub>1</sub> &#x2260; <em>P</em>       <sub>2</sub>, <span class="inline-equation"><span class="tex">${P_1 \not\prec P_2}$</span>       </span>, and <span class="inline-equation"><span class="tex">${P_2 \not\prec P_1}$</span>       </span>; therefore, we also have that <em>P</em>       <sub>1</sub>&#x227A;<em>P</em> and <em>P</em>       <sub>2</sub>&#x227A;<em>P</em>. We next show that <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>       </em> and, for each <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}_{\tau }(P_1) \cap \mathsf {exp}_{\tau }(P_2)}$</span>       </span>, we have that <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}_{\tau }(P)}$</span>       </span>. Please note that this suffices to show that <span class="inline-equation"><span class="tex">${\mathsf {exp}^{\prec }_{\tau }(P_1) \cap \mathsf {exp}^{\prec }_{\tau }(P_2) = \emptyset }$</span>       </span> since <em>P</em>       <sub>1</sub>&#x227A;<em>P</em> and <em>P</em>       <sub>2</sub>&#x227A;<em>P</em>.</p>      <p>Consider an arbitrary substitution <em>&#x03C0;</em> with <span class="inline-equation"><span class="tex">${\mathsf {dom}(\pi) = \mathsf {var}(q)}$</span>       </span> and <span class="inline-equation"><span class="tex">${\mathsf {rng}(\pi) \subseteq \mathsf {dom}(\mu)}$</span>       </span> such that <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}_{\tau }(P_1) \cap \mathsf {exp}_{\tau }(P_2)}$</span>       </span>. Since <em>&#x03C0;</em> is a <em>&#x03C4;</em>-expansion to <em>P</em>       <sub>1</sub> and <em>P</em>       <sub>2</sub>, for each <span class="inline-equation"><span class="tex">$x \in \mathsf {var}(q)$</span>       </span>, we have that <em>&#x03C4;</em>(<em>x</em>) = <em>&#x03BC;</em>(<em>&#x03C0;</em>(<em>x</em>)). Next, let <span class="inline-equation"><span class="tex">$\mathcal {G}_P$</span>       </span> be the term graph for <em>P</em> defined in Definition&#x00A0;<a class="enc" href="#enc6">4.1</a>. To prove that <em>&#x03C0;</em> is a <em>&#x03C4;</em>-expansion to <em>P</em>, we first show that, for all terms <span class="inline-equation"><span class="tex">$s, t \in \mathsf {term}(q)$</span>       </span> such that <em>s</em> reaches <em>t</em> in <span class="inline-equation"><span class="tex">$\mathcal {G}_{P}$</span>       </span>, we have that <em>&#x03C0;</em>(<em>s</em>) = <em>&#x03C0;</em>(<em>t</em>). To this end, we show that the following property holds for all atoms <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>q</em>:</p>      <p>       <ol class="list-no-style">       <li id="list8" label="(A1)"><em>a</em> &#x2248; <em>a</em>&#x2032; implies that <em>&#x03C0;</em>(<em>a</em>) = <em>&#x03C0;</em>(<em>a</em>&#x2032;).<br/></li>       </ol>      </p>      <p>To prove auxiliary property <a class="lst" href="#list8">(A1)</a>, we proceed by induction on the number of steps required to derive <em>a</em> &#x2248; <em>a</em>&#x2032;. For the base case, the empty relation &#x2248; <sub>0</sub> clearly satisfies the property. For the inductive step, consider an arbitrary relation &#x2248; <sub>       <em>n</em>       </sub> obtained in <em>n</em> steps that satisfies the property; we show that the same holds for all the equivalences derivable from &#x2248; <sub>       <em>n</em>       </sub>. Since the equality relation = is reflexive, symmetric, and transitive, the derivation of <em>a</em> &#x2248; <sub>       <em>n</em> + 1</sub>       <em>a</em>&#x2032; due to reflexivity, symmetry, or transitivity clearly preserves the required property. So, we next consider an arbitrary <em>i</em> &#x2208; [1, 2], a set <em>u</em> &#x2208; <em>P<sub>i</sub>       </em>, and two atoms <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>u</em>, so that we derive <em>a</em> &#x2248; <sub>       <em>n</em> + 1</sub>       <em>a</em>&#x2032;. Let <em>a</em> = &#x27E8;<em>s</em>, <em>p</em>, <em>o</em>&#x27E9; and let <em>a</em>&#x2032; = &#x27E8;<em>s</em>&#x2032;, <em>p</em>&#x2032;, <em>o</em>&#x2032;&#x27E9;. Then, by the definition of <span class="inline-equation"><span class="tex">$\mathcal {G}_{P_i}$</span>       </span>, terms <em>s</em>, <em>p</em>, and <em>o</em> reach <em>s</em>&#x2032;, <em>p</em>&#x2032;, and <em>o</em>&#x2032; in <span class="inline-equation"><span class="tex">$\mathcal {G}_{P_i}$</span>       </span>, respectively. Thus, by the definition of <span class="inline-equation"><span class="tex">$\gamma _{P_i}$</span>       </span>, we also have that <span class="inline-equation"><span class="tex">${\gamma _{P_i}(s) = \gamma _{P_i}(s^{\prime })}$</span>       </span>, <span class="inline-equation"><span class="tex">${\gamma _{P_i}(p) = \gamma _{P_i}(p^{\prime })}$</span>       </span>, and <span class="inline-equation"><span class="tex">${\gamma _{P_i}(o) = \gamma _{P_i}(o^{\prime })}$</span>       </span>. By properties <a class="lst" href="#list4">(2)</a> and <a class="lst" href="#list5">(3)</a> in Definition&#x00A0;<a class="enc" href="#enc14">B.1</a>, we have that <em>&#x03C0;</em>(<em>a</em>) = <em>&#x03C0;</em>(<em>a</em>&#x2032;), as required.</p>      <p>Please note that <span class="inline-equation"><span class="tex">$\mathcal {G}_P$</span>       </span> is obtained by adding an undirected edge between <em>s</em>       <sub>1</sub> and <em>s</em>       <sub>2</sub>, <em>p</em>       <sub>1</sub> and <em>p</em>       <sub>2</sub>, and <em>o</em>       <sub>1</sub> and <em>o</em>       <sub>2</sub> for each <em>u</em> &#x2208; <em>P</em> and all atoms &#x27E8;<em>s</em>       <sub>1</sub>, <em>p</em>       <sub>1</sub>, <em>o</em>       <sub>1</sub>&#x27E9;, &#x27E8;<em>s</em>       <sub>2</sub>, <em>p</em>       <sub>2</sub>, <em>o</em>       <sub>2</sub>&#x27E9; &#x2208; <em>u</em>. By the definition of <em>P</em>, we have that &#x27E8;<em>s</em>       <sub>1</sub>, <em>p</em>       <sub>1</sub>, <em>o</em>       <sub>1</sub>&#x27E9; &#x2248; &#x27E8;<em>s</em>       <sub>2</sub>, <em>p</em>       <sub>2</sub>, <em>o</em>       <sub>2</sub>&#x27E9; for each such pair of atoms. So, because the equality relation = is reflexive, symmetric, and transitive, property <a class="lst" href="#list8">(A1)</a> implies that <em>&#x03C0;</em>(<em>s</em>) = <em>&#x03C0;</em>(<em>t</em>) for all terms that are reachable in <span class="inline-equation"><span class="tex">$\mathcal {G}_P$</span>       </span>.</p>      <p>Since <em>&#x03C0;</em>(<em>s</em>) = <em>&#x03C0;</em>(<em>t</em>) for all <span class="inline-equation"><span class="tex">$s, t \in \mathsf {term}(q)$</span>       </span> such that <em>s</em> reaches <em>t</em> in <span class="inline-equation"><span class="tex">$\mathcal {G}_P$</span>       </span>, partition <em>P</em> is unifiable, and so <em>P</em> &#x2208; <em>B</em>. We next show that <em>P</em> is satisfied by <em>&#x03C4;</em> and that <em>&#x03C0;</em> satisfies conditions <a class="lst" href="#list4">(2)</a> and <a class="lst" href="#list5">(3)</a> in Definition&#x00A0;<a class="enc" href="#enc14">B.1</a>. For <span class="inline-equation"><span class="tex">$x \in \mathsf {var}(q)$</span>       </span> a variable, we next consider two cases.</p>      <p>       <ul class="list-no-style">       <li id="list9" label="&#x2022;">Assume that <em>&#x03B3;<sub>P</sub>        </em>(<em>x</em>) is a variable <span class="inline-equation"><span class="tex">$y \in \mathsf {var}(q)$</span>        </span>. By the definition of <em>&#x03B3;<sub>P</sub>        </em>, we have that <em>x</em> reaches <em>y</em> in <span class="inline-equation"><span class="tex">$\mathcal {G}_P$</span>        </span>, and so <em>&#x03C0;</em>(<em>x</em>) = <em>&#x03C0;</em>(<em>y</em>). Since <em>&#x03C4;</em>(<em>x</em>) = <em>&#x03BC;</em>(<em>&#x03C0;</em>(<em>x</em>)) and <em>&#x03C4;</em>(<em>y</em>) = <em>&#x03BC;</em>(<em>&#x03C0;</em>(<em>y</em>)), we conclude that <em>&#x03C4;</em>(<em>x</em>) = <em>&#x03C4;</em>(<em>y</em>).<br/></li>       <li id="list10" label="&#x2022;">Assume that <em>&#x03B3;<sub>P</sub>        </em>(<em>x</em>) is a resource <span class="inline-equation"><span class="tex">$d\in \mathsf {res}(q)$</span>        </span>. By the definition of <em>&#x03B3;<sub>P</sub>        </em>, we have that <em>x</em> reaches <em>d</em> in <span class="inline-equation"><span class="tex">$\mathcal {G}_P$</span>        </span>, and so <em>&#x03C0;</em>(<em>x</em>) = <em>d</em>. Since <em>&#x03C4;</em>(<em>x</em>) = <em>&#x03BC;</em>(<em>&#x03C0;</em>(<em>x</em>)), we conclude that <em>&#x03C4;</em>(<em>x</em>) = <em>&#x03BC;</em>(<em>d</em>).<br/></li>       </ul>      </p>      <p>Therefore, <em>P</em> is satisfied by <em>&#x03C4;</em> and <em>&#x03C0;</em> satisfies conditions <a class="lst" href="#list4">(2)</a> and <a class="lst" href="#list5">(3)</a> in Definition&#x00A0;<a class="enc" href="#enc14">B.1</a>; thus, <em>&#x03C0;</em> is a <em>&#x03C4;</em>-expansion to <em>P</em>, as required.</p>      <p>       <em>Property <a class="lst" href="#list7">(P2)</a>       </em>&#x00A0;&#x00A0; Let <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>       </em> be a partition and let <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}^{\prec }_{\tau }(P)}$</span>       </span> be a <em>&#x03C4;</em>-expansion; we show that, for all <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>q</em>, there exists <em>u</em> &#x2208; <em>P</em> with <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>u</em> if and only if <em>&#x03C0;</em>(<em>a</em>) = <em>&#x03C0;</em>(<em>a</em>&#x2032;).</p>      <p>(&#x21D2;)&#x00A0;By properties <a class="lst" href="#list4">(2)</a> and <a class="lst" href="#list5">(3)</a> in Definition <a class="enc" href="#enc14">B.1</a> and by Definition <a class="enc" href="#enc6">4.1</a> of <em>&#x03B3;<sub>P</sub>       </em>, we have that <em>&#x03C0;</em>(<em>a</em>) = <em>&#x03C0;</em>(<em>a</em>&#x2032;) for each <em>u</em> &#x2208; <em>P</em> and all <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>u</em>, as required.</p>      <p>(&#x21D0;) For the sake of a contradiction, assume that two atoms <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>q</em> exist such that <em>&#x03C0;</em>(<em>a</em>) = <em>&#x03C0;</em>(<em>a</em>&#x2032;), but no <em>u</em> &#x2208; <em>P</em> exists such that <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>u</em>. Then, let <em>P</em>&#x2032; be the partition of <em>q</em> such that, for all <em>a</em>       <sub>1</sub>, <em>a</em>       <sub>2</sub> &#x2208; <em>q</em>, there exists <em>u</em>&#x2032; &#x2208; <em>P</em>&#x2032; such that <em>a</em>       <sub>1</sub>, <em>a</em>       <sub>2</sub> &#x2208; <em>u</em>&#x2032; if and only if <em>&#x03C0;</em>(<em>a</em>       <sub>1</sub>) = <em>&#x03C0;</em>(<em>a</em>       <sub>2</sub>). Please note that, by the definition of <em>P</em>&#x2032;, a set <em>u</em>&#x2032; &#x2208; <em>P</em>&#x2032; exists such that <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>u</em>&#x2032;.</p>      <p>We first show that <em>P</em>&#x227A;<em>P</em>&#x2032;. To this end, consider an arbitrary <em>u</em> &#x2208; <em>P</em> and two arbitrary atoms <em>a</em>       <sub>1</sub>, <em>a</em>       <sub>2</sub> &#x2208; <em>u</em>. Because <em>&#x03C0;</em> is a <em>&#x03C4;</em>-expansion to <em>P</em>, we have that <em>&#x03C0;</em>(<em>a</em>) = <em>&#x03C0;</em>(<em>a</em>&#x2032;), and so a set <em>u</em>&#x2032; &#x2208; <em>P</em>&#x2032; exists such that <em>a</em>       <sub>1</sub>, <em>a</em>       <sub>2</sub> &#x2208; <em>u</em>&#x2032;. Thus, we have that <em>P</em>&#x2AAF;<em>P</em>&#x2032;. Furthermore, by the initial assumption, there exists no <em>u</em> &#x2208; <em>P</em> such that <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>u</em>; hence, we also have that <em>P</em>&#x227A;<em>P</em>&#x2032;.</p>      <p>By the construction of <em>P</em>&#x2032;, we have that <em>&#x03C0;</em>(<em>s</em>) = <em>&#x03C0;</em>(<em>t</em>) for all terms <span class="inline-equation"><span class="tex">$s, t \in \mathsf {term}(q)$</span>       </span> such that <em>s</em> reaches <em>t</em> in <span class="inline-equation"><span class="tex">$\mathcal {G}_{P^{\prime }}$</span>       </span>. So, <em>P</em>&#x2032; is a unifiable partition of <em>q</em> and satisfies properties <a class="lst" href="#list4">(2)</a> and <a class="lst" href="#list5">(3)</a> of Definition <a class="enc" href="#enc14">B.1</a>. Since <em>&#x03C0;</em> is a <em>&#x03C4;</em>-expansion to <em>P</em>, we have that <em>&#x03C4;</em>(<em>x</em>) = <em>&#x03BC;</em>(<em>&#x03C0;</em>(<em>x</em>)) for each <span class="inline-equation"><span class="tex">$x \in \mathsf {var}(q)$</span>       </span>; thus, <em>P</em>&#x2032; is satisfied by <em>&#x03C4;</em> and <em>&#x03C0;</em> is a <em>&#x03C4;</em>-expansion to <em>P</em>&#x2032;. This is a contradiction, since <em>P</em>&#x227A;<em>P</em>&#x2032; and <span class="inline-equation"><span class="tex">$\pi \in \mathsf {exp}^{\prec }_{\tau }(P)$</span>       </span>.</p>     </div>    </section>    <section id="sec-28">     <header>      <div class="title-info">       <h3>       <span class="section-number">B.2</span> Counting Expansions</h3>      </div>     </header>     <p>We next show how one can effectively count, given an answer <em>&#x03C4;</em> to <em>&#x03BC;</em>(<em>q</em>) over <em>H</em> and a partition <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>      </em>, the number of <em>&#x03C4;</em>-expansions to <em>P</em>. To this end, we first an auxiliary lemma.</p>     <div class="lemma" id="enc16">      <Label>Lemma B.3.</Label>      <p> For all partitions <em>P</em>, <em>P</em>&#x2032; &#x2208; <em>B</em> with <em>P</em>&#x227A;<em>P</em>&#x2032;, <div class="table-responsive" id="eq3">       <div class="display-equation">        <span class="tex mytex">\begin{equation} - K(P,P^{\prime }) ~~ = \sum _{P \prec P^{\prime \prime } \preceq P^{\prime }} K(P^{\prime \prime },P^{\prime }). \end{equation} </span>        <br/>        <span class="equation-number">(3)</span>       </div>       </div>      </p>     </div>     <div class="proof" id="proof4">      <Label>Proof.</Label>      <p> Let <em>P</em> and <em>P</em>&#x2032; be as specified in the lemma. By Definition <a class="enc" href="#enc6">4.1</a>, we have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} - K(P,P^{\prime }) \ \ =\ \ -(C^{ {e}}(P,P^{\prime }) - C^{ {o}}(P,P^{\prime })) \ \ = \ \ C^{ {o}}(P,P^{\prime }) - C^{ {e}}(P,P^{\prime }).\end{eqnarray*} </span>        <br/>       </div>       </div> Because <em>P</em> and <em>P</em>&#x2032; are distinct partitions, by Definition <a class="enc" href="#enc6">4.1</a> of a chain from <em>P</em> to <em>P</em>&#x2032;, the number of even chains from <em>P</em> to <em>P</em>&#x2032; in <em>B</em> can be computed by summing, for each <em>P</em>&#x2032;&#x2032; &#x2208; <em>B</em> with <em>P</em>&#x227A;<em>P</em>&#x2032;&#x2032; and <em>P</em>&#x2032;&#x2032;&#x2AAF;<em>P</em>&#x2032;, the number of odd chains from <em>P</em>&#x2032;&#x2032; to <em>P</em>&#x2032; in <em>B</em>. Similarly, the number of odd chains from <em>P</em> to <em>P</em>&#x2032; in <em>B</em> can be computed by summing, for each <em>P</em>&#x2032;&#x2032; &#x2208; <em>B</em> with <em>P</em>&#x227A;<em>P</em>&#x2032;&#x2032; and <em>P</em>&#x2032;&#x2032;&#x2AAF;<em>P</em>&#x2032;, the number of even chains from <em>P</em>&#x2032;&#x2032; to <em>P</em>&#x2032; in <em>B</em>. Hence, we have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{align*} C^{ {e}}(P,P^{\prime }) &#x0026;~~= \sum _{P \prec P^{\prime \prime } \preceq P^{\prime }} C^{ {o}}(P^{\prime \prime },P^{\prime }), \text{ and}\\C^{ {o}}(P,P^{\prime }) &#x0026;~~= \sum _{P \prec P^{\prime \prime } \preceq P^{\prime }} C^{ {e}}(P^{\prime \prime },P^{\prime }).\end{align*} </span>        <br/>       </div>       </div> Therefore, we have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{align*} - K(P,P^{\prime }) &#x0026;= C^{ {o}}(P,P^{\prime }) - C^{ {e}}(P,P^{\prime }) = \left(\sum _{P \prec P^{\prime \prime } \preceq P^{\prime }} C^{ {e}}(P^{\prime \prime },P^{\prime })\right) - \left(\sum _{P \prec P^{\prime \prime } \preceq P^{\prime }} C^{ {o}}(P^{\prime \prime },P^{\prime })\right) \\[1em] &#x0026;= \sum _{{{\scriptstyle {\begin{array}{*10c}P \prec P^{\prime \prime } \preceq P^{\prime }\end{array}}}}} \left(C^{ {e}}(P^{\prime \prime },P^{\prime }) - C^{ {o}}(P^{\prime \prime },P^{\prime })\right) = \sum _{{{\scriptstyle {\begin{array}{*10c}P \prec P^{\prime \prime } \preceq P^{\prime }\end{array}}}}} K(P^{\prime \prime },P^{\prime }).\end{align*} </span>        <br/>       </div>       </div>      </p>     </div>     <div class="proposition" id="enc17">      <Label>Proposition B.4.</Label>      <p> The following equations hold for each answer <em>&#x03C4;</em> to <em>&#x03BC;</em>(<em>q</em>) on <span class="inline-equation"><span class="tex">$\mathsf {res}(H)$</span>       </span> and each <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>       </em>: <div class="table-responsive" id="eq4">       <div class="display-equation">        <span class="tex mytex">\begin{align} |\mathsf {exp}_{\tau }(P)| &#x0026;~~~=~~~ N_{\tau }(P),\end{align} </span>        <br/>        <span class="equation-number">(4)</span>       </div>       </div>       <div class="table-responsive" id="eq5">       <div class="display-equation">        <span class="tex mytex">\begin{align} |\mathsf {exp}^{\prec }_{\tau }(P)| &#x0026;~~~= \sum _{P^{\prime }\in B_\tau , P \preceq P^{\prime }} K(P,P^{\prime }) \cdot N_{\tau }(P^{\prime }). \end{align} </span>        <br/>        <span class="equation-number">(5)</span>       </div>       </div>      </p>     </div>     <div class="proof" id="proof5">      <Label>Proof.</Label>      <p> Let <em>&#x03C4;</em> be as specified in the lemma, and let &#x2AAF;<sub>       <em>&#x03C4;</em>       </sub> be the restriction of &#x2AAF; to <em>B<sub>&#x03C4;</sub>       </em>.</p>      <p>We first prove Equation (<a class="eqn" href="#eq4">4</a>). To this end, consider a partition <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>       </em>. By Definition <a class="enc" href="#enc14">B.1</a> of a <em>&#x03C4;</em>-expansion to <em>P</em>, each <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}_{\tau }(P)}$</span>       </span> can vary only on the variables occurring in the range of <em>&#x03B3;<sub>P</sub>       </em>. Furthermore, for each <span class="inline-equation"><span class="tex">$x \in \mathsf {varrng}(\gamma _P)$</span>       </span>, we have that <em>&#x03C0;</em>(<em>x</em>) &#x2208; <em>&#x03BC;</em>       <sup>&#x2212;</sup>(<em>&#x03C4;</em>(<em>x</em>)) and |<em>&#x03BC;</em>       <sup>&#x2212;</sup>(<em>&#x03C4;</em>(<em>x</em>))| = <em>s</em>[<em>&#x03C4;</em>(<em>x</em>)]; thus, there are <span class="inline-equation"><span class="tex">${N_{\tau }(P) = \prod _{x \in \mathsf {varrng}(\gamma _{P})} s[\tau (x)]}$</span>       </span> distinct <em>&#x03C4;</em>-expansions to <em>P</em>.</p>      <p>We next prove Equation (<a class="eqn" href="#eq5">5</a>) by induction on &#x2AAF;<sub>       <em>&#x03C4;</em>       </sub>.</p>      <p>       <em>Base case.</em> Consider an arbitrary partition <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>       </em> that is &#x2AAF;<sub>       <em>&#x03C4;</em>       </sub>-maximal. We then have that <span class="inline-equation"><span class="tex">${\mathsf {exp}^{\prec }_{\tau }(P) = \mathsf {exp}_{\tau }(P)}$</span>       </span>; furthermore, by Equation (<a class="eqn" href="#eq4">4</a>), we have that <span class="inline-equation"><span class="tex">${|\mathsf {exp}_{\tau }(P)| = N_{\tau }(P)}$</span>       </span>. In addition, we have that <span class="inline-equation"><span class="tex">${\sum _{P \preceq _\tau P^{\prime }} K(P,P^{\prime }) \cdot N_{\tau }(P^{\prime }) = K(P,P) \cdot N_{\tau }(P)}$</span>       </span>. Finally, by Definition <a class="enc" href="#enc6">4.1</a> of <em>K</em>, we have that <em>K</em>(<em>P</em>, <em>P</em>) = 1; so, Equation (<a class="eqn" href="#eq5">5</a>) holds.</p>      <p>       <em>Inductive Step.</em> Consider an arbitrary <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>       </em> and assume that, for each <em>P</em>&#x2032;&#x2032; &#x2208; <em>B<sub>&#x03C4;</sub>       </em> with <em>P</em>&#x227A;<sub>       <em>&#x03C4;</em>       </sub>       <em>P</em>&#x2032;&#x2032;, we have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} |\mathsf {exp}^{\prec }_{\tau }(P^{\prime \prime })| ~= \sum _{P^{\prime \prime } \preceq _\tau P^{\prime }} K(P^{\prime \prime },P^{\prime }) \cdot N_{\tau }(P^{\prime });\end{eqnarray*} </span>        <br/>       </div>       </div> we show that the same holds for <em>P</em>. By the definition of <span class="inline-equation"><span class="tex">$\mathsf {exp}^{\prec }_{\tau }(P)$</span>       </span>, we have that <span class="inline-equation"><span class="tex">${\mathsf {exp}^{\prec }_{\tau }(P) = \mathsf {exp}_{\tau }(P) \setminus \bigcup _{P \prec _\tau P^{\prime \prime }} \mathsf {exp}_{\tau }(P^{\prime \prime })}$</span>       </span>. By Proposition <a class="enc" href="#enc15">B.2</a>, for each <span class="inline-equation"><span class="tex">${\pi \in \bigcup _{P \prec _\tau P^{\prime \prime }} \mathsf {exp}_{\tau }(P^{\prime \prime })}$</span>       </span>, exactly one partition <em>P</em>&#x2032;&#x2032; &#x2208; <em>B<sub>&#x03C4;</sub>       </em> exists such that <em>P</em>&#x227A;<sub>       <em>&#x03C4;</em>       </sub>       <em>P</em>&#x2032;&#x2032; and <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}^{\prec }_{\tau }(P^{\prime \prime })}$</span>       </span>. Therefore, we have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{align*} \mathsf {exp}^{\prec }_{\tau }(P) &#x0026;~=~ \mathsf {exp}_{\tau }(P) \setminus \bigcup _{P \prec _\tau P^{\prime \prime }} \mathsf {exp}^{\prec }_{\tau }(P^{\prime \prime })\text{, and}\\ |\mathsf {exp}^{\prec }_{\tau }(P)| &#x0026;~=~ |\mathsf {exp}_{\tau }(P)| - \sum _{P \prec _\tau P^{\prime \prime }} |\mathsf {exp}^{\prec }_{\tau }(P^{\prime \prime })|.\end{align*} </span>        <br/>       </div>       </div> By Equation (<a class="eqn" href="#eq4">4</a>), we have that <span class="inline-equation"><span class="tex">${|\mathsf {exp}_{\tau }(P)| = N_{\tau }(P)}$</span>       </span>. So, by the inductive hypothesis, we can compute <span class="inline-equation"><span class="tex">${|\mathsf {exp}^{\prec }_{\tau }(P)|}$</span>       </span> as follows. <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} |\mathsf {exp}^{\prec }_{\tau }(P)| = N_{\tau }(P) - \sum _{P \prec _\tau P^{\prime \prime }} \left(\sum _{P^{\prime \prime } \preceq _\tau P^{\prime }} K(P^{\prime \prime },P^{\prime }) \cdot N_{\tau }(P^{\prime })\right) = N_{\tau }(P) - \sum _{P \prec _\tau P^{\prime }} N_{\tau }(P^{\prime }) \cdot \left(\sum _{P \prec _\tau P^{\prime \prime } \preceq _\tau P^{\prime }} K(P^{\prime \prime },P^{\prime })\right).\end{eqnarray*} </span>        <br/>       </div>       </div> By Lemma <a class="enc" href="#enc16">B.3</a>, for each <em>P</em>&#x2032; &#x2208; <em>B<sub>&#x03C4;</sub>       </em> with <em>P</em>&#x227A;<sub>       <em>&#x03C4;</em>       </sub>       <em>P</em>&#x2032;, we have that <span class="inline-equation"><span class="tex">$\sum _{P \prec _\tau P^{\prime \prime } \preceq _\tau P^{\prime }} K(P^{\prime \prime },P^{\prime }) = -K(P,P^{\prime })$</span>       </span>; thus, we have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{align*} |\mathsf {exp}^{\prec }_{\tau }(P)| &#x0026;= N_{\tau }(P) - \sum _{P \prec _\tau P^{\prime }} N_{\tau }(P^{\prime }) \cdot \left(\sum _{P \prec _\tau P^{\prime \prime } \preceq _\tau P^{\prime }} K(P^{\prime \prime },P^{\prime })\right) \\[1em] &#x0026;= N_{\tau }(P) - \left(\sum _{P \prec _\tau P^{\prime }} - N_{\tau }(P^{\prime }) \cdot K(P,P^{\prime })\right) = N_{\tau }(P) + \left(\sum _{P \prec _\tau P^{\prime }} N_{\tau }(P^{\prime }) \cdot K(P,P^{\prime })\right).\end{align*} </span>        <br/>       </div>       </div> Finally, by Definition <a class="enc" href="#enc6">4.1</a> of <em>K</em>, we have that <em>K</em>(<em>P</em>, <em>P</em>) is 1, so the following holds: <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{align*} |\mathsf {exp}^{\prec }_{\tau }(P)| &#x0026;= N_{\tau }(P) + \left(\sum _{P \prec _\tau P^{\prime }} N_{\tau }(P^{\prime }) \cdot K(P,P^{\prime })\right)\\[1em] &#x0026;= K(P,P) \cdot N_{\tau }(P) + \left(\sum _{P \prec _\tau P^{\prime }} K(P,P^{\prime })\cdot N_{\tau }(P^{\prime }) \right) = \sum _{P \preceq _\tau P^{\prime }} K(P,P^{\prime })\cdot N_{\tau }(P^{\prime }).\end{align*} </span>        <br/>       </div>       </div>      </p>     </div>    </section>    <section id="sec-29">     <header>      <div class="title-info">       <h3>       <span class="section-number">B.3</span> Proofs of Theorem <a class="enc" href="#enc8">4.3</a> and Proposition <a class="enc" href="#enc11">4.6</a>       </h3>      </div>     </header>     <p>We are now ready to prove the correctness of the formulae for computing <em>E</em>      <sub>       <em>q</em>, <em>S</em>      </sub> given in Theorem <a class="enc" href="#enc8">4.3</a> and Proposition <a class="enc" href="#enc11">4.6</a>.</p>     <div class="lemma" id="enc18">      <Label>Lemma B.5.</Label>      <p> For all <span class="inline-equation"><span class="tex">$n, k, m \in \mathbb {N}$</span>       </span> with <em>n</em> &#x2265; <em>m</em> &#x2265; <em>k</em> > 0, <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} \frac{\binom{n-k}{m-k}}{\binom{n}{m}} = \frac{(m)_k}{(n)_{k}}.\end{eqnarray*} </span>        <br/>       </div>       </div>      </p>     </div>     <div class="proof" id="proof6">      <Label>Proof.</Label>      <p> Let <em>n</em>, <em>k</em>, <em>m</em> be natural numbers as specified in the lemma. By the definition of binomial coefficient, we have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{align*} \binom{n}{m} &#x0026;= \frac{n!}{m!\cdot (n-m)!}, \text{ and}\\\binom{n-k}{m-k} &#x0026;= \frac{(n-k)!}{(m-k)!\cdot (n-k - (m-k))!} = \frac{(n-k)!}{(m-k)!\cdot (n-m)!}.\end{align*} </span>        <br/>       </div>       </div> By using the standard laws of arithmetics, we then have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} \frac{\binom{n-k}{m-k}}{\binom{n}{m}} = \frac{\frac{(n-k)!}{(m-k)!\cdot (n-m)!}}{\frac{n!}{m!\cdot (n-m)!}} = \frac{(n-k)! \cdot m!}{n! \cdot (m-k)!} = \frac{m\cdots (m-k+1)}{n\cdots (n-k+1)} = \frac{(m)_k}{(n)_k}.\end{eqnarray*} </span>        <br/>       </div>       </div>      </p>     </div>     <div class="lemma" id="enc19">      <Label>Lemma B.6.</Label>      <p> Let <em>&#x03C4;</em> be an answer to <em>&#x03BC;</em>(<em>q</em>) over <em>H</em> and let <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>       </em> be a partition. The following holds for each <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}^{\prec }_{\tau }(P)}$</span>       </span>: <div class="table-responsive" id="eq6">       <div class="display-equation">        <span class="tex mytex">\begin{equation} F_{\tau }(P) = E_{\pi (q), S}. \end{equation} </span>        <br/>        <span class="equation-number">(6)</span>       </div>       </div>      </p>     </div>     <div class="proof" id="proof7">      <Label>Proof.</Label>      <p> Let <em>&#x03C4;</em> and <em>P</em> be as specified in the lemma. Consider an arbitrary substitution <span class="inline-equation"><span class="tex">${\pi \in \mathsf {exp}^{\prec }_{\tau }(P)}$</span>       </span> and let <em>q<sub>&#x03C0;</sub>       </em> = <em>&#x03C0;</em>(<em>q</em>); we show that <span class="inline-equation"><span class="tex">${F_{\tau }(P) = E_{q_\pi , S}}$</span>       </span>. Note that, for each <em>a</em> &#x2208; <em>q<sub>&#x03C0;</sub>       </em>, we have that <span class="inline-equation"><span class="tex">$\mathsf {var}(a) = \emptyset$</span>       </span> and <span class="inline-equation"><span class="tex">$\mathsf {res}(a) \subseteq \mathsf {dom}(\mu)$</span>       </span>.</p>      <p>By the definition of <em>&#x03C4;</em>-expansion, we have that <em>&#x03C4;</em>(<em>x</em>) = <em>&#x03BC;</em>(<em>&#x03C0;</em>(<em>x</em>)) for each <span class="inline-equation"><span class="tex">$x \in \mathsf {var}(q)$</span>       </span>, and so <em>&#x03BC;</em>(<em>q<sub>&#x03C0;</sub>       </em>) = <em>&#x03C4;</em>(<em>&#x03BC;</em>(<em>q</em>)). Because <em>P</em> is satisfied by <em>&#x03C4;</em>, for each <em>u</em> &#x2208; <em>P</em> and all atoms <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>u</em>, we have that <em>&#x03C4;</em>(<em>&#x03BC;</em>(<em>a</em>)) = <em>&#x03C4;</em>(<em>&#x03BC;</em>(<em>a</em>&#x2032;)); so, <em>&#x03C4;</em>(<em>&#x03BC;</em>(<em>u</em>)) is a set consisting of a single triple from <em>H</em>. In the following, for each triple <em>h</em> &#x2208; <em>&#x03C4;</em>(<em>&#x03BC;</em>(<em>q</em>)), let <span class="inline-equation"><span class="tex">${{h} \in \mathbb {N}}$</span>       </span> be as specified in Definition <a class="enc" href="#enc7">4.2</a>.</p>      <p>By property <a class="lst" href="#list7">(P2)</a> of Proposition <a class="enc" href="#enc15">B.2</a>, for all atoms <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>q</em>, we have that <em>&#x03C0;</em>(<em>a</em>) = <em>&#x03C0;</em>(<em>a</em>&#x2032;) if and only if there exists <em>u</em> &#x2208; <em>P</em> with <em>a</em>, <em>a</em>&#x2032; &#x2208; <em>u</em>. That is, there is a one-to-one correspondence between the triples in <em>q<sub>&#x03C0;</sub>       </em> and the sets in <em>P</em>. So, for each triple <em>h</em> &#x2208; <em>&#x03C4;</em>(<em>&#x03BC;</em>(<em>q</em>)), we have that <div class="table-responsive" id="eq7">       <div class="display-equation">        <span class="tex mytex">\begin{equation} {h} ~~=~~ |\lbrace u \in P \mid \tau (\mu (u)) = \lbrace h \rbrace \rbrace | ~~=~~ |\lbrace f\in q_\pi \mid \mu (f) = h \rbrace |. \end{equation} </span>        <br/>        <span class="equation-number">(7)</span>       </div>       </div> By Definition <a class="enc" href="#enc4">3.4</a> of expectation, we have that <div class="table-responsive" id="eq8">       <div class="display-equation">        <span class="tex mytex">\begin{equation} E_{q_\pi , S} ~= \sum _{G\in R_S} \frac{|[[ q_\pi ]] _{G}|}{|R_S|}. \end{equation} </span>        <br/>        <span class="equation-number">(8)</span>       </div>       </div> By the initial assumption, <em>S</em> is consistent; so, |<em>R<sub>S</sub>       </em>| > 0 and <span class="inline-equation"><span class="tex">$E_{q_\pi , S}$</span>       </span> is well-defined. Next, let <span class="inline-equation"><span class="tex">${\mathcal {N} = \sum _{G\in R_S} |[[ q_\pi ]] _{G}|}$</span>       </span>. Since <em>q<sub>&#x03C0;</sub>       </em> is a variable-free, <span class="inline-equation"><span class="tex">${|[[ q_\pi ]] _{G}|}$</span>       </span> is either 0 or 1; thus, <span class="inline-equation"><span class="tex">${\mathcal {N}}$</span>       </span> is the number of graphs <em>G</em> &#x2208; <em>R<sub>S</sub>       </em> with <em>q<sub>&#x03C0;</sub>       </em>&#x2286;<em>G</em>. By Definition <a class="enc" href="#enc2">3.2</a> of a graph represented by <em>S</em>, for each graph <em>G</em>, we have that <em>G</em> &#x2208; <em>R<sub>S</sub>       </em> and <em>q<sub>&#x03C0;</sub>       </em>&#x2286;<em>G</em> if and only if</p>      <p>       <ol class="list-no-style">       <li id="list11" label="(A)"> <span class="inline-equation"><span class="tex">$G\subseteq \bigcup _{h\in H} \mu ^{-}(h)$</span>        </span>,<br/></li>       <li id="list12" label="(B)">for each <em>h</em> &#x2208; <em>H</em>, the set <em>&#x03BC;</em>        <sup>&#x2212;</sup>(<em>h</em>)&#x2229;<em>G</em> contains each <em>f</em> &#x2208; <em>q<sub>&#x03C0;</sub>        </em> with <em>&#x03BC;</em>(<em>f</em>) = <em>h</em>, and<br/></li>       <li id="list13" label="(C)"><em>w</em>[<em>h</em>] = |<em>&#x03BC;</em>        <sup>&#x2212;</sup>(<em>h</em>)&#x2229;<em>G</em>| for each <em>h</em> &#x2208; <em>H</em>.<br/></li>       </ol>      </p>      <p>To prove the lemma, we next consider two alternative cases.</p>      <p>       <em>(Case 1)</em>&#x00A0; Assume that a triple <em>h</em> &#x2208; <em>&#x03C4;</em>(<em>&#x03BC;</em>(<em>q</em>)) exists such that |<em>h</em>| > <em>w</em>[<em>h</em>]; so <em>F<sub>&#x03C4;</sub>       </em>(<em>P</em>) = 0. By Equation (<a class="eqn" href="#eq7">7</a>), <em>h</em> is the number of triples in <em>q<sub>&#x03C0;</sub>       </em> that <em>&#x03BC;</em> maps onto <em>h</em>. So, there is no graph <em>G</em> that satisfies both properties <a class="lst" href="#list12">(B)</a> and <a class="lst" href="#list13">(C)</a> above, and thus <span class="inline-equation"><span class="tex">${\mathcal {N} = 0}$</span>       </span> and <span class="inline-equation"><span class="tex">${E_{q_\pi , S}} = 0$</span>       </span>. Therefore, <span class="inline-equation"><span class="tex">${F_{\tau }(P) = E_{q_\pi , S}}$</span>       </span> and the lemma holds.</p>      <p>       <em>(Case 2)</em>&#x00A0; Assume that <em>h</em> &#x2264; <em>w</em>[<em>h</em>] for each <em>h</em> &#x2208; <em>&#x03C4;</em>(<em>&#x03BC;</em>(<em>q</em>)); so <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} F_{\tau }(P) = \prod _{h\in \tau (\mu (q))}\frac{(w[h])_{{h}}}{(s[h])_{{h}}}.\end{eqnarray*} </span>        <br/>       </div>       </div> Each graph <em>G</em> &#x2208; <em>R<sub>S</sub>       </em> with <em>q<sub>&#x03C0;</sub>       </em>&#x2286;<em>G</em> can be generated by independently choosing, for each <em>h</em> &#x2208; <em>H</em>, a subset <em>G<sub>h</sub>       </em> of <em>&#x03BC;</em>       <sup>&#x2212;</sup>(<em>h</em>) such that |<em>G<sub>h</sub>       </em>| = <em>w</em>[<em>h</em>] and <em>G<sub>h</sub>       </em> contains each <em>f</em> &#x2208; <em>q<sub>&#x03C0;</sub>       </em> with <em>&#x03BC;</em>(<em>f</em>) = <em>h</em>. Please recall that <em>s</em>[<em>h</em>] is the size of <em>&#x03BC;</em>       <sup>&#x2212;</sup>(<em>h</em>). Next, we show how to compute, for each <em>h</em> &#x2208; <em>H</em>, the number <span class="inline-equation"><span class="tex">$\mathcal {N}_h$</span>       </span> of distinct such sets by considering two alternative cases.</p>      <p>       <ul class="list-no-style">       <li id="list14" label="&#x2022;">Assume that <em>h</em> &#x2208; <em>&#x03C4;</em>(<em>&#x03BC;</em>(<em>q</em>)). By Equation (<a class="eqn" href="#eq7">7</a>), there are precisely <em>h</em> distinct triples <em>f</em> &#x2208; <em>q<sub>&#x03C0;</sub>        </em> such that <em>&#x03BC;</em>(<em>f</em>) = <em>h</em>, and so <div class="table-responsive">         <div class="display-equation">          <span class="tex mytex">\begin{eqnarray*} \mathcal {N}_h= \binom{s[h] - {h}}{w[h] - {h}}.\end{eqnarray*} </span>          <br/>         </div>        </div>        <br/></li>       <li id="list15" label="&#x2022;">Assume that <span class="inline-equation"><span class="tex">${h \not\in \tau (\mu (q))}$</span>        </span>. Hence, no triple <em>f</em> &#x2208; <em>q<sub>&#x03C0;</sub>        </em> exists such that <em>&#x03BC;</em>(<em>f</em>) = <em>h</em>. So, we have that <div class="table-responsive">         <div class="display-equation">          <span class="tex mytex">\begin{eqnarray*} \mathcal {N}_h= \binom{s[h]}{w[h]}.\end{eqnarray*} </span>          <br/>         </div>        </div>        <br/></li>       </ul>      </p>      <p>Therefore, we can compute <span class="inline-equation"><span class="tex">$\mathcal {N}$</span>       </span> as follows: <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} \mathcal {N} \ \ = \sum _{G\in R_S} |[[ q_\pi ]] _{G}| \ = \ \prod _{h\in H} \mathcal {N}_h\ \ = \prod _{h\in \tau (\mu (q))} \binom{s[h] - {h}}{w[h] - {h}} \ \ \cdot \prod _{h\in (H\setminus \tau (\mu (q)))}\binom{s[h]}{w[h]}.\end{eqnarray*} </span>        <br/>       </div>       </div> By the definition of expected answer, we then have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} E_{q_\pi , S} \ \ = \sum _{G\in R_S} \frac{|[[ q_\pi ]] _{G}|}{|R_S|} \ \ = \ \ \frac{\mathcal {N}}{|R_S|} \ \ = \ \ \frac{\prod _{h\in \tau (\mu (q))} \binom{s[h] - {h}}{w[h] - {h}} \cdot \prod _{h\in (H\setminus \tau (\mu (q)))}\binom{s[h]}{w[h]}}{|R_S|}.\end{eqnarray*} </span>        <br/>       </div>       </div> By using the formula for computing |<em>R<sub>S</sub>       </em>| from Lemma <a class="enc" href="#enc13">A.2</a>, we obtain the following: <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{align*} E_{q_\pi , S} &#x0026;~=~ \frac{\prod _{h\in \tau (\mu (q))} \binom{s[h] - {h}}{w[h] - {h}} \cdot \prod _{h\in (H\setminus \tau (\mu (q)))}\binom{s[h]}{w[h]}}{|R_S|} \ \ = \ \ \frac{\prod _{h\in \tau (\mu (q))} \binom{s[h] - {h}}{w[h] - {h}} \cdot \prod _{h\in (H\setminus \tau (\mu (q)))}\binom{s[h]}{w[h]}}{\prod _{h\in H} \binom{s[h]}{w[h]}}\\[1em] &#x0026;~=~ \frac{\prod _{h\in \tau (\mu (q))} \binom{s[h] - {h}}{w[h] - {h}} \cdot \prod _{h\in (H\setminus \tau (\mu (q)))}\binom{s[h]}{w[h]}}{\prod _{h\in \tau (\mu (q))} \binom{s[h]}{w[h]} \cdot \prod _{h\in (H\setminus \tau (\mu (q)))} \binom{s[h]}{w[h]}} \ \ = \prod _{h\in \tau (\mu (q))} \frac{\binom{s[h] - {h}}{w[h] - {h}}}{\binom{s[h]}{w[h]}}.\end{align*} </span>        <br/>       </div>       </div> Finally, by Lemma <a class="enc" href="#enc18">B.5</a>, we have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} E_{q_\pi , S} \ \ = \prod _{h\in \tau (\mu (q))} \frac{\binom{s[h] - {h}}{w[h] - {h}}}{\binom{s[h]}{w[h]}} \ \ = \prod _{h\in \tau (\mu (q))}\frac{(w[h])_{{h}}}{(s[h])_{{h}}} \ \ = \ \ F_{\tau }(P).\end{eqnarray*} </span>        <br/>       </div>       </div>      </p>     </div>     <p>We are now ready to prove Theorem <a class="enc" href="#enc8">4.3</a>.</p>         <div class="theorem" id="enc8">     <Label>Theorem 4.3.</Label>     <p> The following identity holds: <div class="table-responsive">       <div class="display-equation">       <span class="tex mytex">\begin{align*} E_{q, S} = \sum _{\tau \in [[ \mu (q) ]] _{H}} \ \sum _{P \in B_\tau } F_{\tau }(P) \cdot \sum _{{{\scriptstyle {\begin{array}{*10c}P^{\prime } \in B_\tau , P \preceq P^{\prime }\end{array}}}}} K(P,P^{\prime }) \cdot N_{\tau }(P^{\prime }).\end{align*} </span>       <br/>       </div>      </div>     </p>    </div>     <div class="proof" id="proof8">      <Label>Proof.</Label>      <p> In the rest of this proof, for each substitution <em>&#x03C0;</em> with <span class="inline-equation"><span class="tex">$\mathsf {dom}(\pi) = \mathsf {var}(q)$</span>       </span> and <span class="inline-equation"><span class="tex">$\mathsf {rng}(\pi) \subseteq \mathsf {dom}(\mu)$</span>       </span>, we let <em>q<sub>&#x03C0;</sub>       </em> = <em>&#x03C0;</em>(<em>q</em>); furthermore, let <em>P</em>       <sub>0</sub> = {{<em>a</em>}&#x2223;<em>a</em> &#x2208; <em>q</em>} be a partition of <em>q</em>. By Definition <a class="enc" href="#enc6">4.1</a> of partition base, we have that <em>P</em>       <sub>0</sub> &#x2208; <em>B</em>; in addition, for each answer <em>&#x03C4; &#x03BC;</em>(<em>q</em>) on <em>H</em>, we have that <em>P</em>       <sub>0</sub> &#x2208; <em>B<sub>&#x03C4;</sub>       </em>; finally, for each <em>P</em> &#x2208; <em>B</em>, we have that <em>P</em>       <sub>0</sub>&#x2AAF;<em>P</em>.</p>      <p>Consider an arbitrary <em>G</em> &#x2208; <em>R<sub>S</sub>       </em>; because <em>S</em> is consistent, such <em>G</em> exists. Then, <span class="inline-equation"><span class="tex">$|[[ q ]] _{G}|$</span>       </span> is the number of substitutions <em>&#x03C0;</em> with <span class="inline-equation"><span class="tex">$\mathsf {dom}(\pi) = \mathsf {var}(q)$</span>       </span> and <span class="inline-equation"><span class="tex">$\mathsf {rng}(\pi) \subseteq \mathsf {dom}(\mu)$</span>       </span> such that <em>q<sub>&#x03C0;</sub>       </em>&#x2286;<em>G</em>. Since <em>G</em> &#x2208; <em>R<sub>S</sub>       </em>, for each such <em>&#x03C0;</em>, the substitution <em>&#x03C4;</em> such that <em>&#x03C4;</em>(<em>x</em>) = <em>&#x03BC;</em>(<em>&#x03C0;</em>(<em>x</em>)), for each <span class="inline-equation"><span class="tex">$x \in \mathsf {dom}(\pi)$</span>       </span>, is an answer to <em>&#x03BC;</em>(<em>q</em>) on <em>H</em>. In addition, we have that <span class="inline-equation"><span class="tex">$\pi \in \mathsf {exp}_{\tau }(P_0)$</span>       </span>. So, by Definition&#x00A0;<a class="enc" href="#enc4">3.4</a> of expected number of answers, the following holds: <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} E_{q, S} \ = \sum _{G\in R_S} \frac{|[[ q ]] _{G}|}{|R_S|} \ = \sum _{G\in R_S} \sum _{\tau \in [[ \mu (q) ]] _{H}} \sum _{\pi \in \mathsf {exp}_{\tau }(P_0)} \frac{|[[ q_\pi ]] _{G}|}{|R_S|}.\end{eqnarray*} </span>        <br/>       </div>       </div> By Proposition <a class="enc" href="#enc15">B.2</a>, we have that <span class="inline-equation"><span class="tex">$\mathsf {exp}_{\tau }(P_0) = \bigcup _{P \in B_\tau , P_0 \preceq P} \mathsf {exp}^{\prec }_{\tau }(P)$</span>       </span>. Then, because <em>P</em>       <sub>0</sub>&#x2AAF;<em>P</em> for each <em>P</em> &#x2208; <em>B<sub>&#x03C4;</sub>       </em>, we have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} E_{q, S} \ = \sum _{G\in R_S} \sum _{\tau \in [[ \mu (q) ]] _{H}} \sum _{\pi \in \mathsf {exp}_{\tau }(P_0)} \frac{|[[ q_\pi ]] _{G}|}{|R_S|} \ \ = \sum _{G\in R_S} \sum _{\tau \in [[ \mu (q) ]] _{H}} \sum _{P \in B_\tau } \sum _{\pi \in \mathsf {exp}^{\prec }_{\tau }(P)} \frac{|[[ q_\pi ]] _{G}|}{|R_S|}.\end{eqnarray*} </span>        <br/>       </div>       </div> So, by the definition of <span class="inline-equation"><span class="tex">$E_{q_\pi , S}$</span>       </span>, we can compute <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub> as follows: <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} E_{q, S} \ = \sum _{\tau \in [[ \mu (q) ]] _{H}} \sum _{P \in B_\tau } \sum _{\pi \in \mathsf {exp}^{\prec }_{\tau }(P)} \sum _{G\in R_S} \frac{|[[ q_\pi ]] _{G}|}{|R_S|} \ \ = \sum _{\tau \in [[ \mu (q) ]] _{H}} \sum _{P \in B_\tau } \sum _{\pi \in \mathsf {exp}^{\prec }_{\tau }(P)} E_{q_\pi , S}.\end{eqnarray*} </span>        <br/>       </div>       </div> By Lemma <a class="enc" href="#enc19">B.6</a>, we then have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} E_{q, S} = \sum _{\tau \in [[ \mu (q) ]] _{H}} \sum _{P \in B_\tau } \sum _{\pi \in \mathsf {exp}^{\prec }_{\tau }(P)} F_{\tau }(P).\end{eqnarray*} </span>        <br/>       </div>       </div> Finally, Proposition <a class="enc" href="#enc17">B.4</a> shows how to count the number of &#x2AAF;-maximal <em>&#x03C4;</em>-expansions, so we can rewrite <em>E</em>       <sub>       <em>q</em>, <em>S</em>       </sub> as follows: <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} E_{q, S} = \sum _{\tau \in [[ \mu (q) ]] _{H}} \sum _{P \in B_\tau } F_{\tau }(P) \ \ \cdot \sum _{P^{\prime } \in B_\tau , P \preceq P^{\prime }} K(P,P^{\prime }) \cdot N_{\tau }(P^{\prime }).\end{eqnarray*} </span>        <br/>       </div>       </div>      </p>     </div>     <p>As pointed out in Section <a class="sec" href="#sec-9">4.2</a>, Proposition <a class="enc" href="#enc11">4.6</a> follows immediately from Theorem <a class="enc" href="#enc8">4.3</a>.</p>    <div class="proposition" id="enc11">     <Label>Proposition 4.6.</Label>     <p> Formula&#x00A0;(<a class="eqn" href="#eq1">1</a>) correctly computes <em>E</em>      <sub>       <em>q</em>, <em>S</em>      </sub> when <em>q</em> is a <em>&#x03BC;</em>-unification-free query.</p>    </div>    </section>    <section id="sec-30">     <header>      <div class="title-info">       <h3>       <span class="section-number">B.4</span> Proof of Theorem <a class="enc" href="#enc9">4.4</a>       </h3>      </div>     </header>     <p>We next show that our method for computing <em>&#x03C3;</em>      <sub>       <em>q</em>, <em>S</em>      </sub> is correct.</p>    <div class="theorem" id="enc9">     <Label>Theorem 4.4.</Label>     <p> Identity <span class="inline-equation"><span class="tex">${\sigma _{q, S}^2 = E_{q \cup \rho (q), S} - E_{q, S}^2}$</span>      </span> holds, where <em>&#x03C1;</em> is a substitution mapping each variable in <span class="inline-equation"><span class="tex">$\mathsf {var}(q)$</span>      </span> to a fresh variable.</p>    </div>     <div class="proof" id="proof9">      <Label>Proof.</Label>      <p> Let <em>&#x03C1;</em> be a substitution mapping each variable in <span class="inline-equation"><span class="tex">$\mathsf {var}(q)$</span>       </span> to a fresh variable, and let <em>q</em>&#x2032; = <em>&#x03C1;</em>(<em>q</em>). We first show that equation (<a class="eqn" href="#eq9">9</a>) holds for each RDF graph <em>G</em> &#x2208; <em>R<sub>S</sub>       </em>. <div class="table-responsive" id="eq9">       <div class="display-equation">        <span class="tex mytex">\begin{equation} |[[ q ]] _{G}|^2 = |[[ q \cup q^{\prime } ]] _{G}| \end{equation} </span>        <br/>        <span class="equation-number">(9)</span>       </div>       </div> To this end, consider an arbitrary graph <em>G</em> &#x2208; <em>R<sub>S</sub>       </em>. Then, <span class="inline-equation"><span class="tex">$|[[ q ]] _{G}|^2$</span>       </span> is the cardinality of the set <em>Pairs</em> that contains each pair &#x27E8;<em>&#x03C0;</em>, <em>&#x03C0;</em>&#x2032;&#x27E9; of substitutions mapping the variables of <em>q</em> to <span class="inline-equation"><span class="tex">$\mathsf {dom}(\mu)$</span>       </span> such that {<em>&#x03C0;</em>(<em>q</em>), <em>&#x03C0;</em>&#x2032;(<em>q</em>)}&#x2286;<em>G</em>. But then, Equation (<a class="eqn" href="#eq9">9</a>) holds because the set of answers to <em>q</em>&#x222A;<em>q</em>&#x2032; over <em>G</em> contains precisely, for each pair &#x27E8;<em>&#x03C0;</em>, <em>&#x03C0;</em>&#x2032;&#x27E9; &#x2208; <em>Pairs</em>, one distinct substitution <span class="inline-equation"><span class="tex">${\kappa _{\pi , \pi ^{\prime }}}$</span>       </span> from <span class="inline-equation"><span class="tex">${\mathsf {var}(q)\cup \mathsf {var}(q^{\prime })}$</span>       </span> to <span class="inline-equation"><span class="tex">$\mathsf {dom}(\mu)$</span>       </span>. Such <span class="inline-equation"><span class="tex">$\kappa _{\pi ,\pi ^{\prime }}$</span>       </span> can be obtained from <em>&#x03C0;</em> and <em>&#x03C0;</em>&#x2032; by setting, for each <span class="inline-equation"><span class="tex">${x \in \mathsf {var}(q)}$</span>       </span>, <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} \kappa _{\pi ,\pi ^{\prime }}(x) = \pi (x) \text{ and } \kappa _{\pi ,\pi ^{\prime }}(\rho (x)) = \pi ^{\prime }(x).\end{eqnarray*} </span>        <br/>       </div>       </div>      </p>      <p>We are now ready to prove the theorem. By Definition <a class="enc" href="#enc4">3.4</a> of variance, we have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} \sigma _{q, S}^2 = \sum _{G\in R_S} \frac{|[[ q ]] _{G}|^2 - 2 \cdot |[[ q ]] _{G}| \cdot E_{q, S} + E_{q, S})^2}{|R_S|}.\end{eqnarray*} </span>        <br/>       </div>       </div> By using Equation (<a class="eqn" href="#eq9">9</a>) and by manipulating summations in the usual way, we can express <span class="inline-equation"><span class="tex">$\sigma _{q, S}^2$</span>       </span> as follows. <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} \sum _{G\in R_S} \left[\frac{|[[ q \cup q^{\prime } ]] _{G}|}{|R_S|}\right] - 2 \cdot E_{q, S}\cdot \sum _{G\in R_S} \left[\frac{|[[ q ]] _{G}|}{|R_S|}\right] + E_{q, S}^2\end{eqnarray*} </span>        <br/>       </div>       </div> By Definition <a class="enc" href="#enc4">3.4</a> of expectation, we then have that <div class="table-responsive">       <div class="display-equation">        <span class="tex mytex">\begin{eqnarray*} \sigma _{q, S}^2 \ \ = \ \ E_{q\cup q^{\prime }, S} - 2 \cdot E_{q, S}^2 + E_{q, S}^2 \ \ = \ \ E_{q\cup q^{\prime }, S} - (E_{q, S})^2,\end{eqnarray*} </span>        <br/>       </div>       </div> and so the theorem holds.</p>     </div>    </section>    </section>   </Appendix>   <section id="ref-001">    <header>    <div class="title-info">     <h2 class="page-brake-head">REFERENCES</h2>    </div>    </header>    <ul class="bibUl">    <li id="BibPLXBIB0001" label="[1]">Ashraf Aboulnaga and Surajit Chaudhuri. 1999. Self-tuning Histograms: Building Histograms Without Looking at Data. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 1999)</em>     </em>. ACM, Philadelphia, PA, USA, 181&#x2013;192.</li>    <li id="BibPLXBIB0002" label="[2]">Swarup Acharya, Phillip&#x00A0;B. Gibbons, Viswanath Poosala, and Sridhar Ramaswamy. 1999. Join Synopses for Approximate Query Answering. <em>      <em>SIGMOD Record</em>     </em>28, 2 (1999), 275&#x2013;286.</li>    <li id="BibPLXBIB0003" label="[3]">G&#x00FC;nes Alu&#x00E7;, Olaf Hartig, M.&#x00A0;Tamer &#x00D6;zsu, and Khuzaima Daudjee. 2014. Diversified Stress Testing of RDF Data Management Systems. In <em>      <em>Proc. of the 13th Int. Semantic Web Conference (ISWC 2014)</em>     </em>(<em>LNCS</em>), Vol.&#x00A0;8796. Springer, Riva del Garda, Italy, 197&#x2013;212.</li>    <li id="BibPLXBIB0004" label="[4]">Nicolas Bruno. 2003. <em>Statistics on Query Expressions in Relational Database Management Systems</em>. Ph.D. Dissertation. Columbia University.</li>    <li id="BibPLXBIB0005" label="[5]">Nicolas Bruno and Surajit Chaudhuri. 2004. Conditional Selectivity for Statistics on Query Expressions. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 2004)</em>     </em>. ACM, Paris, France, 311&#x2013;322.</li>    <li id="BibPLXBIB0006" label="[6]">Nicolas Bruno, Surajit Chaudhuri, and Luis Gravano. 2001. STHoles: A Multidimensional Workload-aware Histogram. <em>      <em>SIGMOD Record</em>     </em>30, 2 (2001), 211&#x2013;222.</li>    <li id="BibPLXBIB0007" label="[7]">&#x0160;ejla &#x010C;ebiri&#x0107;, Fran&#x00E7;ois Goasdou&#x00E9;, and Ioana Manolescu. 2015. Query-oriented Summarization of RDF Graphs. <em>      <em>P-VLDB</em>     </em>8, 12 (2015), 2012&#x2013;2015.</li>    <li id="BibPLXBIB0008" label="[8]">Kaushik Chakrabarti, Minos Garofalakis, Rajeev Rastogi, and Kyuseok Shim. 2001. Approximate query processing using wavelets. <em>      <em>VLDB Journal</em>     </em>10, 2 (2001), 199&#x2013;223.</li>    <li id="BibPLXBIB0009" label="[9]">Julian Dolby, Achille Fokoue, Aditya Kalyanpur, Aaron Kershenbaum, Edith Schonberg, Kavitha Srinivas, and Li Ma. 2007. Scalable Semantic Retrieval through Summarization and Refinement. In <em>      <em>Proc. of the 22nd AAAI Conf. on Artificial Intelligence (AAAI 2007)</em>     </em>. AAAI Press, Vancouver, BC, Canada, 299&#x2013;304.</li>    <li id="BibPLXBIB0010" label="[10]">David Freedman and Persi Diaconis. 1981. On the Histogram as a Density Estimator: <em>L</em>     <sub>2</sub> theory. <em>      <em>Zeitschrift f&#x00FC;r Wahrscheinlichkeitstheorie und Verwandte Gebiete</em>     </em>57, 4 (1981), 453&#x2013;476.</li>    <li id="BibPLXBIB0011" label="[11]">C&#x00E9;sar&#x00A0;A. Galindo-Legaria, Milind Joshi, Florian Waas, and Ming-Chuan Wu. 2003. Statistics on Views. In <em>      <em>Proc. of the 29th Int. Conf. on Very Large Databases (VLDB 2003)</em>     </em>. Morgan Kaufmann, Berlin, Germany, 952&#x2013;962.</li>    <li id="BibPLXBIB0012" label="[12]">Hector Garcia-Molina, Jeffrey&#x00A0;D. Ullman, and Jennifer Widom. 2000. <em>      <em>Database System Implementation</em>     </em>. Prentice-Hall, Upper Saddle River, NJ, USA.</li>    <li id="BibPLXBIB0013" label="[13]">Minos Garofalakis and Phillip&#x00A0;B. Gibbons. 2002. Wavelet Synopses with Error Guarantees. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 2002)</em>     </em>. ACM, Madison, WI, USA, 476&#x2013;487.</li>    <li id="BibPLXBIB0014" label="[14]">Lise Getoor, Benjamin Taskar, and Daphne Koller. 2001. Selectivity Estimation Using Probabilistic Models. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 2001)</em>     </em>. ACM, Santa Barbara, CA, USA, 461&#x2013;472.</li>    <li id="BibPLXBIB0015" label="[15]">Dimitrios Gunopulos, George Kollios, Vassilis&#x00A0;J. Tsotras, and Carlotta Domeniconi. 2000. Approximating Multi-dimensional Aggregate Range Queries over Real Attributes. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 2000)</em>     </em>. ACM, Dallas, TX, USA, 463&#x2013;474.</li>    <li id="BibPLXBIB0016" label="[16]">Dimitrios Gunopulos, George Kollios, Vassilis&#x00A0;J. Tsotras, and Carlotta Domeniconi. 2005. Selectivity estimators for multidimensional range queries over real attributes. <em>      <em>VLDB Journal</em>     </em>14, 2 (2005), 137&#x2013;154.</li>    <li id="BibPLXBIB0017" label="[17]">Y. Guo, Z. Pan, and J. Heflin. 2005. LUBM: A benchmark for OWL knowledge base systems. <em>      <em>Journal of Web Semantics</em>     </em>3, 2&#x2013;3 (2005), 158&#x2013;182.</li>    <li id="BibPLXBIB0018" label="[18]">Steve Harris and Andy Seaborne. 2013. SPARQL 1.1 Query Language, W3C Recommendation. (March 21 2013).</li>    <li id="BibPLXBIB0019" label="[19]">Hai Huang and Chengfei Liu. 2011. Estimating Selectivity for Joined RDF Triple Patterns. In <em>      <em>Proc. of the 20th ACM Conf. on Information and Knowledge Management (CIKM 2011)</em>     </em>. ACM, Glasgow, United Kingdom, 1435&#x2013;1444.</li>    <li id="BibPLXBIB0020" label="[20]">Yannis Ioannidis. 2003. The History of Histograms (Abridged). In <em>      <em>Proc. of the 29th Int. Conf. on Very Large Databases (VLDB 2003)</em>     </em>. Morgan Kaufmann, Berlin, Germany, 19&#x2013;30.</li>    <li id="BibPLXBIB0021" label="[21]">Yannis&#x00A0;E. Ioannidis and Stavros Christodoulakis. 1991. On the Propagation of Errors in the Size of Join Results. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 1991)</em>     </em>. ACM, Denver, CO, USA, 268&#x2013;277.</li>    <li id="BibPLXBIB0022" label="[22]">George Karypis and Vipin Kumar. 1998. A Fast and High Quality Multilevel Scheme for Partitioning Irregular Graphs. <em>      <em>SIAM Journal on Scientific Computing</em>     </em>20, 1 (1998), 359&#x2013;392.</li>    <li id="BibPLXBIB0023" label="[23]">Graham Klyne, Jeremy&#x00A0;J. Carroll, and Brian McBride. 2014. RDF 1.1: Concepts and Abstract Syntax. <a href="https://www.w3.org/TR/rdf11-concepts/" target="_blank">https://www.w3.org/TR/rdf11-concepts/</a>. (February 25 2014).</li>    <li id="BibPLXBIB0024" label="[24]">Ju-Hong Lee, Deok-Hwan Kim, and Chin-Wan Chung. 1999. Multi-dimensional Selectivity Estimation Using Compressed Histogram Information. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 1999)</em>     </em>. ACM, Philadelphia, PA, USA, 205&#x2013;214.</li>    <li id="BibPLXBIB0025" label="[25]">Kristen LeFevre and Evimaria Terzi. 2010. GraSS: Graph Structure Summarization. In <em>      <em>Proc. of the SIAM Int. Conf. on Data Mining (SDM 2010)</em>     </em>. SIAM, Columbus, OH, USA, 454&#x2013;465.</li>    <li id="BibPLXBIB0026" label="[26]">Viktor Leis, Andrey Gubichev, Atanas Mirchev, Peter Boncz, Alfons Kemper, and Thomas Neumann. 2015. How Good Are Query Optimizers, Really?<em>      <em>P-VLDB</em>     </em>9, 3 (2015), 204&#x2013;215.</li>    <li id="BibPLXBIB0027" label="[27]">Jure Leskovec, Anand Rajaraman, and Jeffrey&#x00A0;D. Ullman. 2014. <em>      <em>Mining of Massive Datasets, 2nd Ed</em>     </em>. Cambridge University Press, New York, NY, USA.</li>    <li id="BibPLXBIB0028" label="[28]">Yossi Matias, Jeffrey&#x00A0;Scott Vitter, and Min Wang. 1998. Wavelet-based Histograms for Selectivity Estimation. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 1998)</em>     </em>. ACM, Seattle, WA, USA, 448&#x2013;459.</li>    <li id="BibPLXBIB0029" label="[29]">Saket Navlakha, Rajeev Rastogi, and Nisheeth Shrivastava. 2008. Graph Summarization with Bounded Error. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 2008)</em>     </em>. ACM, Vancouver, BC, Canada, 419&#x2013;432.</li>    <li id="BibPLXBIB0030" label="[30]">Thomas Neumann and Guido Moerkotte. 2011. Characteristic Sets: Accurate Cardinality Estimation for RDF Queries with Multiple Joins. In <em>      <em>Proc. of the 27th IEEE Int. Conf. on Data Engineering (ICDE 2011)</em>     </em>. IEEE Computer Society, Hannover, Germany, 984&#x2013;994.</li>    <li id="BibPLXBIB0031" label="[31]">Thomas Neumann and Gerhard Weikum. 2010. The RDF-3X engine for scalable management of RDF data. <em>      <em>VLDB Journal</em>     </em>19, 1 (2010), 91&#x2013;113.</li>    <li id="BibPLXBIB0032" label="[32]">J. P&#x00E9;rez, M. Arenas, and C. Gutierrez. 2009. Semantics and complexity of SPARQL. <em>      <em>ACM Transactions on Database Systems</em>     </em>34, 3 (2009), 1&#x2013;45.</li>    <li id="BibPLXBIB0033" label="[33]">Viswanath Poosala, Peter&#x00A0;J. Haas, Yannis&#x00A0;E. Ioannidis, and Eugene&#x00A0;J. Shekita. 1996. Improved Histograms for Selectivity Estimation of Range Predicates. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 1996)</em>     </em>. ACM, Montreal, QC, Canada, 294&#x2013;305.</li>    <li id="BibPLXBIB0034" label="[34]">Viswanath Poosala and Yannis&#x00A0;E. Ioannidis. 1997. Selectivity Estimation Without the Attribute Value Independence Assumption. In <em>      <em>Proc. of the 23rd Int. Conf. on Very Large Databases (VLDB 1997)</em>     </em>. Morgan Kaufmann, Athens, Greece, 486&#x2013;495.</li>    <li id="BibPLXBIB0035" label="[35]">Matteo Riondato, David Garc&#x00ED;a-Soriano, and Francesco Bonchi. 2017. Graph summarization with quality guarantees. <em>      <em>Data Mining and Knowledge Discovery</em>     </em>31, 2 (2017), 314&#x2013;349.</li>    <li id="BibPLXBIB0036" label="[36]">Joshua Spiegel and Neoklis Polyzotis. 2009. TuG Synopses for Approximate Query Answering. <em>      <em>ACM Transactions on Database Systems</em>     </em>34, 1 (2009), 3:1&#x2013;3:56.</li>    <li id="BibPLXBIB0037" label="[37]">Markus Stocker, Andy Seaborne, Abraham Bernstein, Christoph Kiefer, and Dave Reynolds. 2008. SPARQL Basic Graph Pattern Optimization Using Selectivity Estimation. In <em>      <em>Proc. of the 17th Int. Conf. on World Wide Web (WWW 2008)</em>     </em>. ACM, Beijing, China, 595&#x2013;604.</li>    <li id="BibPLXBIB0038" label="[38]">Pawel Terlecki, Hardik Bati, C&#x00E9;sar&#x00A0;A. Galindo-Legaria, and Peter Zabback. 2009. Filtered statistics. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 2009)</em>     </em>. ACM, Providence, RI, USA, 897&#x2013;904.</li>    <li id="BibPLXBIB0039" label="[39]">Yuanyuan Tian, Richard&#x00A0;A. Hankins, and Jignesh&#x00A0;M. Patel. 2008. Efficient Aggregation for Graph Summarization. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 2008)</em>     </em>. ACM, Vancouver, BC, Canada, 567&#x2013;580.</li>    <li id="BibPLXBIB0040" label="[40]">Kostas Tzoumas, Amol Deshpande, and Christian&#x00A0;S. Jensen. 2013. Efficiently Adapting Graphical Models for Selectivity Estimation. <em>      <em>VLDB Journal</em>     </em>22, 1 (2013), 3&#x2013;27.</li>    <li id="BibPLXBIB0041" label="[41]">Feng Yu, Wen-Chi Hou, Cheng Luo, Dunren Che, and Mengxia Zhu. 2013. CS2: A New Database Synopsis for Query Estimation. In <em>      <em>Proc. of the ACM SIGMOD Int. Conf. on Management of Data (SIGMOD 2013)</em>     </em>. ACM, New York, NY, USA, 469&#x2013;480.</li>    <li id="BibPLXBIB0042" label="[42]">Lei Zou, M.&#x00A0;Tamer &#x00D6;zsu, Lei Chen, Xuchuan Shen, Ruizhe Huang, and Dongyan Zhao. 2014. gStore: A Graph-based SPARQL Query Engine. <em>      <em>VLDB Journal</em>     </em>23, 4 (2014), 565&#x2013;590.</li>    </ul>   </section>  </section>  <section id="foot-001" class="footnote">   <header>    <div class="title-info">    <h2>FOOTNOTE</h2>    </div>   </header>   <p id="fn1"><a href="#foot-fn1"><sup>1</sup></a><a class="link-inline force-break" href="http://www.cs.ox.ac.uk/isg/tools/SumRDF/">http://www.cs.ox.ac.uk/isg/tools/SumRDF/</a>   </p>   <p id="fn2"><a href="#foot-fn2"><sup>2</sup></a>Publishing benchmarks with the system named is prohibited by the system&#x0027;s license.</p>   <div class="bibStrip">    <p>This paper is published under the Creative Commons Attribution 4.0 International (CC-BY&#x00A0;4.0) license. Authors reserve their rights to disseminate the work on their personal and corporate Web sites with the appropriate attribution.</p>    <p>    <em>WWW '18, April 23-27, 2018, Lyon, France</em>    </p>    <p>&#x00A9; 2018; IW3C2 (International World Wide Web Conference Committee), published under Creative Commons CC-BY&#x00A0;4.0 License. ACM ISBN 978-1-4503-5640-4/18/04.<br/>DOI: <a class="link-inline force-break" target="_blank"     href="https://doi.org/10.1145/3178876.3186003">https://doi.org/10.1145/3178876.3186003</a>    </p>   </div>  </section>  <div class="pubHistory">   <p/>  </div> </body> </html> 
